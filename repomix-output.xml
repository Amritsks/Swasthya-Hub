This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
backend/.gitignore
backend/config/db.js
backend/index.html
backend/middleware/adminAuth.js
backend/middleware/auth.js
backend/middleware/pharmacistAuth.js
backend/migrateAddAchievements.js
backend/models/Admin.js
backend/models/BloodRequest.js
backend/models/Donation.js
backend/models/pharmacist.js
backend/models/prescription.js
backend/models/User.js
backend/models/UserProfile.js
backend/package.json
backend/README.md
backend/routes/adminAuth.js
backend/routes/adminPanel.js
backend/routes/auth.js
backend/routes/bloodRoutes.js
backend/routes/pharmacistAuth.js
backend/routes/pharmacistDashboard.js
backend/routes/prescriptions.js
backend/routes/profile.js
backend/routes/users.js
backend/scripts/createadmin.js
backend/scripts/createPharmacists.js
backend/server.js
frontend/.git/config
frontend/.git/description
frontend/.git/HEAD
frontend/.git/hooks/applypatch-msg.sample
frontend/.git/hooks/commit-msg.sample
frontend/.git/hooks/fsmonitor-watchman.sample
frontend/.git/hooks/post-update.sample
frontend/.git/hooks/pre-applypatch.sample
frontend/.git/hooks/pre-commit.sample
frontend/.git/hooks/pre-merge-commit.sample
frontend/.git/hooks/pre-push.sample
frontend/.git/hooks/pre-rebase.sample
frontend/.git/hooks/pre-receive.sample
frontend/.git/hooks/prepare-commit-msg.sample
frontend/.git/hooks/push-to-checkout.sample
frontend/.git/hooks/sendemail-validate.sample
frontend/.git/hooks/update.sample
frontend/.git/info/exclude
frontend/.gitignore
frontend/eslint.config.js
frontend/index.html
frontend/package.json
frontend/postcss.config.cjs
frontend/public/robots.txt
frontend/public/vite.svg
frontend/repomix-output.xml
frontend/src/App.jsx
frontend/src/assets/react.svg
frontend/src/components/Navbar.jsx
frontend/src/components/phoneMockup.jsx
frontend/src/context/AuthContext.jsx
frontend/src/hooks/useSocket.js
frontend/src/index.css
frontend/src/layout/Layout.jsx
frontend/src/main.jsx
frontend/src/screens/AdminDashboard.jsx
frontend/src/screens/AdminLogin.jsx
frontend/src/screens/AI.jsx
frontend/src/screens/Aushadhi.jsx
frontend/src/screens/Auth.jsx
frontend/src/screens/Cart.jsx
frontend/src/screens/Checkout.jsx
frontend/src/screens/Dashboard.jsx
frontend/src/screens/Doctor.jsx
frontend/src/screens/Lab.jsx
frontend/src/screens/Login.jsx
frontend/src/screens/PharmacistLogin.jsx
frontend/src/screens/PharmacyAdmin.jsx
frontend/src/screens/Profile.jsx
frontend/src/screens/Raksha.jsx
frontend/src/screens/Suraksha.jsx
frontend/src/screens/UserDashboard.jsx
frontend/src/services/api.js
frontend/tailwind.config.js
frontend/vercel.json
frontend/vite.config.js
package.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="frontend/.git/config">
[core]
	repositoryformatversion = 0
	filemode = false
	bare = false
	logallrefupdates = true
	symlinks = false
	ignorecase = true
</file>

<file path="frontend/.git/description">
Unnamed repository; edit this file 'description' to name the repository.
</file>

<file path="frontend/.git/HEAD">
ref: refs/heads/master
</file>

<file path="frontend/.git/hooks/applypatch-msg.sample">
#!/bin/sh
#
# An example hook script to check the commit log message taken by
# applypatch from an e-mail message.
#
# The hook should exit with non-zero status after issuing an
# appropriate message if it wants to stop the commit.  The hook is
# allowed to edit the commit message file.
#
# To enable this hook, rename this file to "applypatch-msg".

. git-sh-setup
commitmsg="$(git rev-parse --git-path hooks/commit-msg)"
test -x "$commitmsg" && exec "$commitmsg" ${1+"$@"}
:
</file>

<file path="frontend/.git/hooks/commit-msg.sample">
#!/bin/sh
#
# An example hook script to check the commit log message.
# Called by "git commit" with one argument, the name of the file
# that has the commit message.  The hook should exit with non-zero
# status after issuing an appropriate message if it wants to stop the
# commit.  The hook is allowed to edit the commit message file.
#
# To enable this hook, rename this file to "commit-msg".

# Uncomment the below to add a Signed-off-by line to the message.
# Doing this in a hook is a bad idea in general, but the prepare-commit-msg
# hook is more suited to it.
#
# SOB=$(git var GIT_AUTHOR_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
# grep -qs "^$SOB" "$1" || echo "$SOB" >> "$1"

# This example catches duplicate Signed-off-by lines.

test "" = "$(grep '^Signed-off-by: ' "$1" |
	 sort | uniq -c | sed -e '/^[ 	]*1[ 	]/d')" || {
	echo >&2 Duplicate Signed-off-by lines.
	exit 1
}
</file>

<file path="frontend/.git/hooks/fsmonitor-watchman.sample">
#!/usr/bin/perl

use strict;
use warnings;
use IPC::Open2;

# An example hook script to integrate Watchman
# (https://facebook.github.io/watchman/) with git to speed up detecting
# new and modified files.
#
# The hook is passed a version (currently 2) and last update token
# formatted as a string and outputs to stdout a new update token and
# all files that have been modified since the update token. Paths must
# be relative to the root of the working tree and separated by a single NUL.
#
# To enable this hook, rename this file to "query-watchman" and set
# 'git config core.fsmonitor .git/hooks/query-watchman'
#
my ($version, $last_update_token) = @ARGV;

# Uncomment for debugging
# print STDERR "$0 $version $last_update_token\n";

# Check the hook interface version
if ($version ne 2) {
	die "Unsupported query-fsmonitor hook version '$version'.\n" .
	    "Falling back to scanning...\n";
}

my $git_work_tree = get_working_dir();

my $retry = 1;

my $json_pkg;
eval {
	require JSON::XS;
	$json_pkg = "JSON::XS";
	1;
} or do {
	require JSON::PP;
	$json_pkg = "JSON::PP";
};

launch_watchman();

sub launch_watchman {
	my $o = watchman_query();
	if (is_work_tree_watched($o)) {
		output_result($o->{clock}, @{$o->{files}});
	}
}

sub output_result {
	my ($clockid, @files) = @_;

	# Uncomment for debugging watchman output
	# open (my $fh, ">", ".git/watchman-output.out");
	# binmode $fh, ":utf8";
	# print $fh "$clockid\n@files\n";
	# close $fh;

	binmode STDOUT, ":utf8";
	print $clockid;
	print "\0";
	local $, = "\0";
	print @files;
}

sub watchman_clock {
	my $response = qx/watchman clock "$git_work_tree"/;
	die "Failed to get clock id on '$git_work_tree'.\n" .
		"Falling back to scanning...\n" if $? != 0;

	return $json_pkg->new->utf8->decode($response);
}

sub watchman_query {
	my $pid = open2(\*CHLD_OUT, \*CHLD_IN, 'watchman -j --no-pretty')
	or die "open2() failed: $!\n" .
	"Falling back to scanning...\n";

	# In the query expression below we're asking for names of files that
	# changed since $last_update_token but not from the .git folder.
	#
	# To accomplish this, we're using the "since" generator to use the
	# recency index to select candidate nodes and "fields" to limit the
	# output to file names only. Then we're using the "expression" term to
	# further constrain the results.
	my $last_update_line = "";
	if (substr($last_update_token, 0, 1) eq "c") {
		$last_update_token = "\"$last_update_token\"";
		$last_update_line = qq[\n"since": $last_update_token,];
	}
	my $query = <<"	END";
		["query", "$git_work_tree", {$last_update_line
			"fields": ["name"],
			"expression": ["not", ["dirname", ".git"]]
		}]
	END

	# Uncomment for debugging the watchman query
	# open (my $fh, ">", ".git/watchman-query.json");
	# print $fh $query;
	# close $fh;

	print CHLD_IN $query;
	close CHLD_IN;
	my $response = do {local $/; <CHLD_OUT>};

	# Uncomment for debugging the watch response
	# open ($fh, ">", ".git/watchman-response.json");
	# print $fh $response;
	# close $fh;

	die "Watchman: command returned no output.\n" .
	"Falling back to scanning...\n" if $response eq "";
	die "Watchman: command returned invalid output: $response\n" .
	"Falling back to scanning...\n" unless $response =~ /^\{/;

	return $json_pkg->new->utf8->decode($response);
}

sub is_work_tree_watched {
	my ($output) = @_;
	my $error = $output->{error};
	if ($retry > 0 and $error and $error =~ m/unable to resolve root .* directory (.*) is not watched/) {
		$retry--;
		my $response = qx/watchman watch "$git_work_tree"/;
		die "Failed to make watchman watch '$git_work_tree'.\n" .
		    "Falling back to scanning...\n" if $? != 0;
		$output = $json_pkg->new->utf8->decode($response);
		$error = $output->{error};
		die "Watchman: $error.\n" .
		"Falling back to scanning...\n" if $error;

		# Uncomment for debugging watchman output
		# open (my $fh, ">", ".git/watchman-output.out");
		# close $fh;

		# Watchman will always return all files on the first query so
		# return the fast "everything is dirty" flag to git and do the
		# Watchman query just to get it over with now so we won't pay
		# the cost in git to look up each individual file.
		my $o = watchman_clock();
		$error = $output->{error};

		die "Watchman: $error.\n" .
		"Falling back to scanning...\n" if $error;

		output_result($o->{clock}, ("/"));
		$last_update_token = $o->{clock};

		eval { launch_watchman() };
		return 0;
	}

	die "Watchman: $error.\n" .
	"Falling back to scanning...\n" if $error;

	return 1;
}

sub get_working_dir {
	my $working_dir;
	if ($^O =~ 'msys' || $^O =~ 'cygwin') {
		$working_dir = Win32::GetCwd();
		$working_dir =~ tr/\\/\//;
	} else {
		require Cwd;
		$working_dir = Cwd::cwd();
	}

	return $working_dir;
}
</file>

<file path="frontend/.git/hooks/post-update.sample">
#!/bin/sh
#
# An example hook script to prepare a packed repository for use over
# dumb transports.
#
# To enable this hook, rename this file to "post-update".

exec git update-server-info
</file>

<file path="frontend/.git/hooks/pre-applypatch.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed
# by applypatch from an e-mail message.
#
# The hook should exit with non-zero status after issuing an
# appropriate message if it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-applypatch".

. git-sh-setup
precommit="$(git rev-parse --git-path hooks/pre-commit)"
test -x "$precommit" && exec "$precommit" ${1+"$@"}
:
</file>

<file path="frontend/.git/hooks/pre-commit.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by "git commit" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message if
# it wants to stop the commit.
#
# To enable this hook, rename this file to "pre-commit".

if git rev-parse --verify HEAD >/dev/null 2>&1
then
	against=HEAD
else
	# Initial commit: diff against an empty tree object
	against=$(git hash-object -t tree /dev/null)
fi

# If you want to allow non-ASCII filenames set this variable to true.
allownonascii=$(git config --type=bool hooks.allownonascii)

# Redirect output to stderr.
exec 1>&2

# Cross platform projects tend to avoid non-ASCII filenames; prevent
# them from being added to the repository. We exploit the fact that the
# printable range starts at the space character and ends with tilde.
if [ "$allownonascii" != "true" ] &&
	# Note that the use of brackets around a tr range is ok here, (it's
	# even required, for portability to Solaris 10's /usr/bin/tr), since
	# the square bracket bytes happen to fall in the designated range.
	test $(git diff-index --cached --name-only --diff-filter=A -z $against |
	  LC_ALL=C tr -d '[ -~]\0' | wc -c) != 0
then
	cat <<\EOF
Error: Attempt to add a non-ASCII file name.

This can cause problems if you want to work with people on other platforms.

To be portable it is advisable to rename the file.

If you know what you are doing you can disable this check using:

  git config hooks.allownonascii true
EOF
	exit 1
fi

# If there are whitespace errors, print the offending file names and fail.
exec git diff-index --check --cached $against --
</file>

<file path="frontend/.git/hooks/pre-merge-commit.sample">
#!/bin/sh
#
# An example hook script to verify what is about to be committed.
# Called by "git merge" with no arguments.  The hook should
# exit with non-zero status after issuing an appropriate message to
# stderr if it wants to stop the merge commit.
#
# To enable this hook, rename this file to "pre-merge-commit".

. git-sh-setup
test -x "$GIT_DIR/hooks/pre-commit" &&
        exec "$GIT_DIR/hooks/pre-commit"
:
</file>

<file path="frontend/.git/hooks/pre-push.sample">
#!/bin/sh

# An example hook script to verify what is about to be pushed.  Called by "git
# push" after it has checked the remote status, but before anything has been
# pushed.  If this script exits with a non-zero status nothing will be pushed.
#
# This hook is called with the following parameters:
#
# $1 -- Name of the remote to which the push is being done
# $2 -- URL to which the push is being done
#
# If pushing without using a named remote those arguments will be equal.
#
# Information about the commits which are being pushed is supplied as lines to
# the standard input in the form:
#
#   <local ref> <local oid> <remote ref> <remote oid>
#
# This sample shows how to prevent push of commits where the log message starts
# with "WIP" (work in progress).

remote="$1"
url="$2"

zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')

while read local_ref local_oid remote_ref remote_oid
do
	if test "$local_oid" = "$zero"
	then
		# Handle delete
		:
	else
		if test "$remote_oid" = "$zero"
		then
			# New branch, examine all commits
			range="$local_oid"
		else
			# Update to existing branch, examine new commits
			range="$remote_oid..$local_oid"
		fi

		# Check for WIP commit
		commit=$(git rev-list -n 1 --grep '^WIP' "$range")
		if test -n "$commit"
		then
			echo >&2 "Found WIP commit in $local_ref, not pushing"
			exit 1
		fi
	fi
done

exit 0
</file>

<file path="frontend/.git/hooks/pre-rebase.sample">
#!/bin/sh
#
# Copyright (c) 2006, 2008 Junio C Hamano
#
# The "pre-rebase" hook is run just before "git rebase" starts doing
# its job, and can prevent the command from running by exiting with
# non-zero status.
#
# The hook is called with the following parameters:
#
# $1 -- the upstream the series was forked from.
# $2 -- the branch being rebased (or empty when rebasing the current branch).
#
# This sample shows how to prevent topic branches that are already
# merged to 'next' branch from getting rebased, because allowing it
# would result in rebasing already published history.

publish=next
basebranch="$1"
if test "$#" = 2
then
	topic="refs/heads/$2"
else
	topic=`git symbolic-ref HEAD` ||
	exit 0 ;# we do not interrupt rebasing detached HEAD
fi

case "$topic" in
refs/heads/??/*)
	;;
*)
	exit 0 ;# we do not interrupt others.
	;;
esac

# Now we are dealing with a topic branch being rebased
# on top of master.  Is it OK to rebase it?

# Does the topic really exist?
git show-ref -q "$topic" || {
	echo >&2 "No such branch $topic"
	exit 1
}

# Is topic fully merged to master?
not_in_master=`git rev-list --pretty=oneline ^master "$topic"`
if test -z "$not_in_master"
then
	echo >&2 "$topic is fully merged to master; better remove it."
	exit 1 ;# we could allow it, but there is no point.
fi

# Is topic ever merged to next?  If so you should not be rebasing it.
only_next_1=`git rev-list ^master "^$topic" ${publish} | sort`
only_next_2=`git rev-list ^master           ${publish} | sort`
if test "$only_next_1" = "$only_next_2"
then
	not_in_topic=`git rev-list "^$topic" master`
	if test -z "$not_in_topic"
	then
		echo >&2 "$topic is already up to date with master"
		exit 1 ;# we could allow it, but there is no point.
	else
		exit 0
	fi
else
	not_in_next=`git rev-list --pretty=oneline ^${publish} "$topic"`
	/usr/bin/perl -e '
		my $topic = $ARGV[0];
		my $msg = "* $topic has commits already merged to public branch:\n";
		my (%not_in_next) = map {
			/^([0-9a-f]+) /;
			($1 => 1);
		} split(/\n/, $ARGV[1]);
		for my $elem (map {
				/^([0-9a-f]+) (.*)$/;
				[$1 => $2];
			} split(/\n/, $ARGV[2])) {
			if (!exists $not_in_next{$elem->[0]}) {
				if ($msg) {
					print STDERR $msg;
					undef $msg;
				}
				print STDERR " $elem->[1]\n";
			}
		}
	' "$topic" "$not_in_next" "$not_in_master"
	exit 1
fi

<<\DOC_END

This sample hook safeguards topic branches that have been
published from being rewound.

The workflow assumed here is:

 * Once a topic branch forks from "master", "master" is never
   merged into it again (either directly or indirectly).

 * Once a topic branch is fully cooked and merged into "master",
   it is deleted.  If you need to build on top of it to correct
   earlier mistakes, a new topic branch is created by forking at
   the tip of the "master".  This is not strictly necessary, but
   it makes it easier to keep your history simple.

 * Whenever you need to test or publish your changes to topic
   branches, merge them into "next" branch.

The script, being an example, hardcodes the publish branch name
to be "next", but it is trivial to make it configurable via
$GIT_DIR/config mechanism.

With this workflow, you would want to know:

(1) ... if a topic branch has ever been merged to "next".  Young
    topic branches can have stupid mistakes you would rather
    clean up before publishing, and things that have not been
    merged into other branches can be easily rebased without
    affecting other people.  But once it is published, you would
    not want to rewind it.

(2) ... if a topic branch has been fully merged to "master".
    Then you can delete it.  More importantly, you should not
    build on top of it -- other people may already want to
    change things related to the topic as patches against your
    "master", so if you need further changes, it is better to
    fork the topic (perhaps with the same name) afresh from the
    tip of "master".

Let's look at this example:

		   o---o---o---o---o---o---o---o---o---o "next"
		  /       /           /           /
		 /   a---a---b A     /           /
		/   /               /           /
	       /   /   c---c---c---c B         /
	      /   /   /             \         /
	     /   /   /   b---b C     \       /
	    /   /   /   /             \     /
    ---o---o---o---o---o---o---o---o---o---o---o "master"


A, B and C are topic branches.

 * A has one fix since it was merged up to "next".

 * B has finished.  It has been fully merged up to "master" and "next",
   and is ready to be deleted.

 * C has not merged to "next" at all.

We would want to allow C to be rebased, refuse A, and encourage
B to be deleted.

To compute (1):

	git rev-list ^master ^topic next
	git rev-list ^master        next

	if these match, topic has not merged in next at all.

To compute (2):

	git rev-list master..topic

	if this is empty, it is fully merged to "master".

DOC_END
</file>

<file path="frontend/.git/hooks/pre-receive.sample">
#!/bin/sh
#
# An example hook script to make use of push options.
# The example simply echoes all push options that start with 'echoback='
# and rejects all pushes when the "reject" push option is used.
#
# To enable this hook, rename this file to "pre-receive".

if test -n "$GIT_PUSH_OPTION_COUNT"
then
	i=0
	while test "$i" -lt "$GIT_PUSH_OPTION_COUNT"
	do
		eval "value=\$GIT_PUSH_OPTION_$i"
		case "$value" in
		echoback=*)
			echo "echo from the pre-receive-hook: ${value#*=}" >&2
			;;
		reject)
			exit 1
		esac
		i=$((i + 1))
	done
fi
</file>

<file path="frontend/.git/hooks/prepare-commit-msg.sample">
#!/bin/sh
#
# An example hook script to prepare the commit log message.
# Called by "git commit" with the name of the file that has the
# commit message, followed by the description of the commit
# message's source.  The hook's purpose is to edit the commit
# message file.  If the hook fails with a non-zero status,
# the commit is aborted.
#
# To enable this hook, rename this file to "prepare-commit-msg".

# This hook includes three examples. The first one removes the
# "# Please enter the commit message..." help message.
#
# The second includes the output of "git diff --name-status -r"
# into the message, just before the "git status" output.  It is
# commented because it doesn't cope with --amend or with squashed
# commits.
#
# The third example adds a Signed-off-by line to the message, that can
# still be edited.  This is rarely a good idea.

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2
SHA1=$3

/usr/bin/perl -i.bak -ne 'print unless(m/^. Please enter the commit message/..m/^#$/)' "$COMMIT_MSG_FILE"

# case "$COMMIT_SOURCE,$SHA1" in
#  ,|template,)
#    /usr/bin/perl -i.bak -pe '
#       print "\n" . `git diff --cached --name-status -r`
# 	 if /^#/ && $first++ == 0' "$COMMIT_MSG_FILE" ;;
#  *) ;;
# esac

# SOB=$(git var GIT_COMMITTER_IDENT | sed -n 's/^\(.*>\).*$/Signed-off-by: \1/p')
# git interpret-trailers --in-place --trailer "$SOB" "$COMMIT_MSG_FILE"
# if test -z "$COMMIT_SOURCE"
# then
#   /usr/bin/perl -i.bak -pe 'print "\n" if !$first_line++' "$COMMIT_MSG_FILE"
# fi
</file>

<file path="frontend/.git/hooks/push-to-checkout.sample">
#!/bin/sh

# An example hook script to update a checked-out tree on a git push.
#
# This hook is invoked by git-receive-pack(1) when it reacts to git
# push and updates reference(s) in its repository, and when the push
# tries to update the branch that is currently checked out and the
# receive.denyCurrentBranch configuration variable is set to
# updateInstead.
#
# By default, such a push is refused if the working tree and the index
# of the remote repository has any difference from the currently
# checked out commit; when both the working tree and the index match
# the current commit, they are updated to match the newly pushed tip
# of the branch. This hook is to be used to override the default
# behaviour; however the code below reimplements the default behaviour
# as a starting point for convenient modification.
#
# The hook receives the commit with which the tip of the current
# branch is going to be updated:
commit=$1

# It can exit with a non-zero status to refuse the push (when it does
# so, it must not modify the index or the working tree).
die () {
	echo >&2 "$*"
	exit 1
}

# Or it can make any necessary changes to the working tree and to the
# index to bring them to the desired state when the tip of the current
# branch is updated to the new commit, and exit with a zero status.
#
# For example, the hook can simply run git read-tree -u -m HEAD "$1"
# in order to emulate git fetch that is run in the reverse direction
# with git push, as the two-tree form of git read-tree -u -m is
# essentially the same as git switch or git checkout that switches
# branches while keeping the local changes in the working tree that do
# not interfere with the difference between the branches.

# The below is a more-or-less exact translation to shell of the C code
# for the default behaviour for git's push-to-checkout hook defined in
# the push_to_deploy() function in builtin/receive-pack.c.
#
# Note that the hook will be executed from the repository directory,
# not from the working tree, so if you want to perform operations on
# the working tree, you will have to adapt your code accordingly, e.g.
# by adding "cd .." or using relative paths.

if ! git update-index -q --ignore-submodules --refresh
then
	die "Up-to-date check failed"
fi

if ! git diff-files --quiet --ignore-submodules --
then
	die "Working directory has unstaged changes"
fi

# This is a rough translation of:
#
#   head_has_history() ? "HEAD" : EMPTY_TREE_SHA1_HEX
if git cat-file -e HEAD 2>/dev/null
then
	head=HEAD
else
	head=$(git hash-object -t tree --stdin </dev/null)
fi

if ! git diff-index --quiet --cached --ignore-submodules $head --
then
	die "Working directory has staged changes"
fi

if ! git read-tree -u -m "$commit"
then
	die "Could not update working tree to new HEAD"
fi
</file>

<file path="frontend/.git/hooks/sendemail-validate.sample">
#!/bin/sh

# An example hook script to validate a patch (and/or patch series) before
# sending it via email.
#
# The hook should exit with non-zero status after issuing an appropriate
# message if it wants to prevent the email(s) from being sent.
#
# To enable this hook, rename this file to "sendemail-validate".
#
# By default, it will only check that the patch(es) can be applied on top of
# the default upstream branch without conflicts in a secondary worktree. After
# validation (successful or not) of the last patch of a series, the worktree
# will be deleted.
#
# The following config variables can be set to change the default remote and
# remote ref that are used to apply the patches against:
#
#   sendemail.validateRemote (default: origin)
#   sendemail.validateRemoteRef (default: HEAD)
#
# Replace the TODO placeholders with appropriate checks according to your
# needs.

validate_cover_letter () {
	file="$1"
	# TODO: Replace with appropriate checks (e.g. spell checking).
	true
}

validate_patch () {
	file="$1"
	# Ensure that the patch applies without conflicts.
	git am -3 "$file" || return
	# TODO: Replace with appropriate checks for this patch
	# (e.g. checkpatch.pl).
	true
}

validate_series () {
	# TODO: Replace with appropriate checks for the whole series
	# (e.g. quick build, coding style checks, etc.).
	true
}

# main -------------------------------------------------------------------------

if test "$GIT_SENDEMAIL_FILE_COUNTER" = 1
then
	remote=$(git config --default origin --get sendemail.validateRemote) &&
	ref=$(git config --default HEAD --get sendemail.validateRemoteRef) &&
	worktree=$(mktemp --tmpdir -d sendemail-validate.XXXXXXX) &&
	git worktree add -fd --checkout "$worktree" "refs/remotes/$remote/$ref" &&
	git config --replace-all sendemail.validateWorktree "$worktree"
else
	worktree=$(git config --get sendemail.validateWorktree)
fi || {
	echo "sendemail-validate: error: failed to prepare worktree" >&2
	exit 1
}

unset GIT_DIR GIT_WORK_TREE
cd "$worktree" &&

if grep -q "^diff --git " "$1"
then
	validate_patch "$1"
else
	validate_cover_letter "$1"
fi &&

if test "$GIT_SENDEMAIL_FILE_COUNTER" = "$GIT_SENDEMAIL_FILE_TOTAL"
then
	git config --unset-all sendemail.validateWorktree &&
	trap 'git worktree remove -ff "$worktree"' EXIT &&
	validate_series
fi
</file>

<file path="frontend/.git/hooks/update.sample">
#!/bin/sh
#
# An example hook script to block unannotated tags from entering.
# Called by "git receive-pack" with arguments: refname sha1-old sha1-new
#
# To enable this hook, rename this file to "update".
#
# Config
# ------
# hooks.allowunannotated
#   This boolean sets whether unannotated tags will be allowed into the
#   repository.  By default they won't be.
# hooks.allowdeletetag
#   This boolean sets whether deleting tags will be allowed in the
#   repository.  By default they won't be.
# hooks.allowmodifytag
#   This boolean sets whether a tag may be modified after creation. By default
#   it won't be.
# hooks.allowdeletebranch
#   This boolean sets whether deleting branches will be allowed in the
#   repository.  By default they won't be.
# hooks.denycreatebranch
#   This boolean sets whether remotely creating branches will be denied
#   in the repository.  By default this is allowed.
#

# --- Command line
refname="$1"
oldrev="$2"
newrev="$3"

# --- Safety check
if [ -z "$GIT_DIR" ]; then
	echo "Don't run this script from the command line." >&2
	echo " (if you want, you could supply GIT_DIR then run" >&2
	echo "  $0 <ref> <oldrev> <newrev>)" >&2
	exit 1
fi

if [ -z "$refname" -o -z "$oldrev" -o -z "$newrev" ]; then
	echo "usage: $0 <ref> <oldrev> <newrev>" >&2
	exit 1
fi

# --- Config
allowunannotated=$(git config --type=bool hooks.allowunannotated)
allowdeletebranch=$(git config --type=bool hooks.allowdeletebranch)
denycreatebranch=$(git config --type=bool hooks.denycreatebranch)
allowdeletetag=$(git config --type=bool hooks.allowdeletetag)
allowmodifytag=$(git config --type=bool hooks.allowmodifytag)

# check for no description
projectdesc=$(sed -e '1q' "$GIT_DIR/description")
case "$projectdesc" in
"Unnamed repository"* | "")
	echo "*** Project description file hasn't been set" >&2
	exit 1
	;;
esac

# --- Check types
# if $newrev is 0000...0000, it's a commit to delete a ref.
zero=$(git hash-object --stdin </dev/null | tr '[0-9a-f]' '0')
if [ "$newrev" = "$zero" ]; then
	newrev_type=delete
else
	newrev_type=$(git cat-file -t $newrev)
fi

case "$refname","$newrev_type" in
	refs/tags/*,commit)
		# un-annotated tag
		short_refname=${refname##refs/tags/}
		if [ "$allowunannotated" != "true" ]; then
			echo "*** The un-annotated tag, $short_refname, is not allowed in this repository" >&2
			echo "*** Use 'git tag [ -a | -s ]' for tags you want to propagate." >&2
			exit 1
		fi
		;;
	refs/tags/*,delete)
		# delete tag
		if [ "$allowdeletetag" != "true" ]; then
			echo "*** Deleting a tag is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/tags/*,tag)
		# annotated tag
		if [ "$allowmodifytag" != "true" ] && git rev-parse $refname > /dev/null 2>&1
		then
			echo "*** Tag '$refname' already exists." >&2
			echo "*** Modifying a tag is not allowed in this repository." >&2
			exit 1
		fi
		;;
	refs/heads/*,commit)
		# branch
		if [ "$oldrev" = "$zero" -a "$denycreatebranch" = "true" ]; then
			echo "*** Creating a branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/heads/*,delete)
		# delete branch
		if [ "$allowdeletebranch" != "true" ]; then
			echo "*** Deleting a branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	refs/remotes/*,commit)
		# tracking branch
		;;
	refs/remotes/*,delete)
		# delete tracking branch
		if [ "$allowdeletebranch" != "true" ]; then
			echo "*** Deleting a tracking branch is not allowed in this repository" >&2
			exit 1
		fi
		;;
	*)
		# Anything else (is there anything else?)
		echo "*** Update hook: unknown type of update to ref $refname of type $newrev_type" >&2
		exit 1
		;;
esac

# --- Finished
exit 0
</file>

<file path="frontend/.git/info/exclude">
# git ls-files --others --exclude-from=.git/info/exclude
# Lines that start with '#' are comments.
# For a project mostly in C, the following would be a good set of
# exclude patterns (uncomment them if you want to use them):
# *.[oa]
# *~
</file>

<file path=".gitignore">
# ENV FILES
.env
frontend/.env
backend/.env

# NODE
node_modules/
frontend/node_modules/
backend/node_modules/

# BUILDS
frontend/dist
backend/dist

# LOGS
npm-debug.log*
yarn-error.log*

# OS
.DS_Store
</file>

<file path="backend/.gitignore">
# Environment variables
.env
.env.local
.env.production
.env.development

# Node modules
node_modules/

# Build output
dist/
build/

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# OS files
.DS_Store
Thumbs.db
</file>

<file path="backend/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Swasthya Hub</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="backend/middleware/pharmacistAuth.js">
const jwt = require("jsonwebtoken");
const Pharmacist = require("../models/pharmacist");

module.exports = async (req, res, next) => {
  const authHeader = req.headers.authorization;
  if (!authHeader) return res.status(401).json({ message: "No token" });

  try {
    const token = authHeader.split(" ")[1];
    const decoded = jwt.verify(token, process.env.JWT_SECRET);

    const pharmacist = await Pharmacist.findById(decoded.id);
    if (!pharmacist) {
      return res.status(401).json({ message: "Unauthorized" });
    }

    req.pharmacist = pharmacist;
    next();
  } catch (err) {
    res.status(401).json({ message: "Invalid token" });
  }
};
</file>

<file path="backend/models/Admin.js">
// backend/models/Admin.js
const mongoose = require("mongoose");
const bcrypt = require("bcryptjs");

const adminSchema = new mongoose.Schema({
  email: { type: String, unique: true, required: true },
  password: { type: String, required: true },
});

adminSchema.pre("save", async function (next) {
  if (!this.isModified("password")) return next();
  const salt = await bcrypt.genSalt(10);
  this.password = await bcrypt.hash(this.password, salt);
  next();
});

adminSchema.methods.comparePassword = function (candidate) {
  return bcrypt.compare(candidate, this.password);
};

module.exports = mongoose.model("Admin", adminSchema);
</file>

<file path="backend/models/BloodRequest.js">
// backend/models/BloodRequest.js
const mongoose = require("mongoose");

const BloodRequestSchema = new mongoose.Schema(
  {
    group: {
      type: String,
      required: true,
    },
    units: {
      type: Number,
      required: true,
    },
    location: {
      name: { type: String, required: true },
      lat: { type: Number, required: false },
      lng: { type: Number, required: false },
    },
    requester: {
      type: String,
      required: true,
    },
    donor: {
      type: String,
      default: null,
    },
    donorName: {
      type: String,
      default: null,
    },
    donorPhone: {
      type: String,
      default: null,
    },
    donorCode: {
      type: String,
      default: null,
    },
    status: {
      type: String,
      enum: ["open", "accepted", "completed"],
      default: "open",
    },
    meetingTime: {
      type: String,
      default: null,
    },
  },
  { timestamps: true }
);

// TTL index: automatically delete document 24 hours after creation
BloodRequestSchema.index({ createdAt: 1 }, { expireAfterSeconds: 24 * 60 * 60 });

module.exports = mongoose.model("BloodRequest", BloodRequestSchema);
</file>

<file path="backend/models/Donation.js">
// backend/models/Donation.js
const mongoose = require('mongoose');

const donationSchema = new mongoose.Schema({
  request: { type: mongoose.Schema.Types.ObjectId, ref: 'BloodRequest', required: true },
  donor: { type: String, required: true }, // Changed to String (email)
  receiver: { type: String, required: true }, // Changed to String (email)
  status: { type: String, enum: ['pending','completed'], default: 'pending' },
  confirmationCode: { type: String },
}, { timestamps: true });

module.exports = mongoose.model('Donation', donationSchema);
</file>

<file path="backend/models/User.js">
// backend/models/User.js
const mongoose = require("mongoose");

const userSchema = new mongoose.Schema(
  {
    name: { type: String, required: true },
    email: { type: String, unique: true, sparse: true },
    phone: { type: String, unique: true, sparse: true },
    password: { type: String, required: true },
    age: { type: Number },
    gender: { type: String },
    bloodGroup: { type: String },
    height: { type: String },
    weight: { type: String },
    allergies: { type: String },
    medicalConditions: { type: String },
    medications: { type: String },
    fathername: { type: String },
    mothername: { type: String },
    emergencyContact: {
      name: { type: String },
      phone: { type: String },
      relation: { type: String },
    },

    // ✅ New field: Blood Donation Achievements
    achievements: [
      {
        title: { type: String, default: "Blood Donation" },
        date: { type: Date, default: Date.now },
        donorCode: { type: String },
        location: { type: String },
      },
    ],
  },
  { timestamps: true }
);

module.exports = mongoose.model("User", userSchema);
</file>

<file path="backend/models/UserProfile.js">
// backend/models/UserProfile.js
const mongoose = require("mongoose");

const userProfileSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  name: String,
  age: Number,
  gender: String,
  bloodGroup: String,
  height: String,
  weight: String,
  allergies: String,
  medicalConditions: String,
  medications: String,
  fathername: String,
  mothername: String,
  emergencyContact: {
    name: String,
    phone: String,
    relation: String,
  },

  // ✅ NEW: Track user's donation achievements
  achievements: [
    {
      title: { type: String, default: "Blood Donation" },
      date: { type: Date, default: Date.now },
      donorCode: { type: String },
      location: { type: String },
    },
  ],
});

module.exports = mongoose.model("UserProfile", userProfileSchema);
</file>

<file path="backend/package.json">
{
  "name": "backend",
  "version": "1.0.0",
  "description": "This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.",
  "main": "server.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "start": "node server.js",
    "dev": "node scripts/createPharmacists.js && nodemon server.js",
    "create-pharmacists": "node scripts/createPharmacists.js"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "bcryptjs": "^3.0.2",
    "body-parser": "^2.2.0",
    "cors": "^2.8.5",
    "dotenv": "^17.2.2",
    "express": "^5.1.0",
    "gridfs-stream": "^1.1.1",
    "jsonwebtoken": "^9.0.2",
    "mime": "^4.1.0",
    "mime-types": "^3.0.1",
    "mongoose": "^8.18.2",
    "multer": "^2.0.2",
    "socket.io": "^4.8.1"
  },
  "devDependencies": {
    "nodemon": "^3.1.10"
  }
}
</file>

<file path="backend/README.md">
# React + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend using TypeScript with type-aware lint rules enabled. Check out the [TS template](https://github.com/vitejs/vite/tree/main/packages/create-vite/template-react-ts) for information on how to integrate TypeScript and [`typescript-eslint`](https://typescript-eslint.io) in your project.
</file>

<file path="backend/routes/adminAuth.js">
// backend/routes/adminAuth.js
const express = require("express");
const jwt = require("jsonwebtoken");
const Admin = require("../models/Admin");
const router = express.Router();

// Register admin (run once manually or via script)
router.post("/register", async (req, res) => {
  try {
    const { email, password } = req.body;
    const existing = await Admin.findOne({ email });
    if (existing) return res.status(400).json({ message: "Admin exists" });
    const admin = new Admin({ email, password });
    await admin.save();
    res.status(201).json({ message: "Admin created" });
  } catch (e) {
    res.status(500).json({ error: e.message });
  }
});

// Login admin
router.post("/login", async (req, res) => {
  try {
    const { email, password } = req.body;
    const admin = await Admin.findOne({ email });
    if (!admin) return res.status(400).json({ message: "Invalid credentials" });
    const isMatch = await admin.comparePassword(password);
    if (!isMatch) return res.status(400).json({ message: "Invalid credentials" });

    const token = jwt.sign({ id: admin._id, role: "admin" }, process.env.JWT_SECRET, { expiresIn: "1d" });
    res.json({ token });
  } catch (err) {
    res.status(500).json({ message: "Server error" });
  }
});

module.exports = router;
</file>

<file path="backend/routes/bloodRoutes.js">
// backend/routes/bloodRoutes.js
const express = require("express");
const BloodRequest = require("../models/BloodRequest.js");
const Donation = require("../models/Donation.js");
const UserProfile = require("../models/UserProfile.js");

const router = express.Router();

// --------------------- GET all blood requests ---------------------
router.get("/", async (req, res) => {
  try {
    const requests = await BloodRequest.find();
    res.status(200).json(requests);
  } catch (err) {
    console.error("Fetch error:", err);
    res.status(500).json({ message: "Server error while fetching requests" });
  }
});

// --------------------- POST create a new blood request ---------------------
router.post("/request", async (req, res) => {
  try {
    const { group, units, locationName, lat, lng, requesterEmail } = req.body;

    if (!group || !units || !locationName || !requesterEmail) {
      return res.status(400).json({ message: "Missing required fields" });
    }

    const newRequest = new BloodRequest({
      group,
      units,
      location: {
        name: locationName,
        lat: lat || null,
        lng: lng || null,
      },
      requester: requesterEmail,
    });

    const savedRequest = await newRequest.save();
    res.status(201).json(savedRequest);
  } catch (err) {
    console.error("Create request error:", err);
    res.status(500).json({ message: "Server error while creating request" });
  }
});

// --------------------- PUT accept a blood request ---------------------
router.put("/:requestId/accept", async (req, res) => {
  try {
    const { requestId } = req.params;
    const { donorEmail, donorCode, donorName, donorPhone } = req.body;

    if (!donorEmail || !donorCode) {
      return res.status(400).json({ message: "Donor email and code are required" });
    }

    const request = await BloodRequest.findById(requestId);
    if (!request) return res.status(404).json({ message: "Request not found" });

    if (request.status !== "open") {
      return res.status(400).json({ message: "Request already accepted or completed" });
    }

    // Update blood request info
    request.status = "accepted";
    request.donor = donorEmail;
    request.donorName = donorName;
    request.donorPhone = donorPhone;
    request.donorCode = donorCode;
    const updatedRequest = await request.save();

    // Create a donation record
    const donation = new Donation({
      request: requestId,
      donor: donorEmail,
      receiver: request.requester,
      status: "pending",
      confirmationCode: donorCode,
    });
    await donation.save();

    res.json({
      message: "Request accepted successfully",
      updatedRequest,
      donation,
    });
  } catch (err) {
    console.error("Accept error:", err);
    res.status(500).json({ message: "Server error while accepting request" });
  }
});

// --------------------- ✅ POST confirm donation (by requester) ---------------------
router.post("/confirmDonation/:requestId", async (req, res) => {
  try {
    const { requestId } = req.params;
    const request = await BloodRequest.findById(requestId);

    if (!request) return res.status(404).json({ message: "Request not found" });

    // Prevent re-confirmation
    if (request.status === "completed") {
      return res.status(400).json({ message: "Donation already confirmed" });
    }
    if (request.status !== "accepted") {
      return res.status(400).json({ message: "Request not yet accepted" });
    }

    // Generate donor code if missing
    const donorCode =
      request.donorCode ||
      "DONOR-" + Math.random().toString(36).substr(2, 8).toUpperCase();

    // Update request status
    request.status = "completed";
    request.donationConfirmed = true;
    request.donorCode = donorCode;
    await request.save();

    // Update matching donation record
    const donation = await Donation.findOne({ request: requestId });
    if (donation) {
      donation.status = "completed";
      donation.completedAt = new Date();
      await donation.save();
    }

    // ✅ Update donor's UserProfile with achievement
    let donorProfile = await UserProfile.findOne({ email: request.donor });
    if (!donorProfile) {
      donorProfile = new UserProfile({
        email: request.donor,
        achievements: [],
      });
    }

    const achievement = {
      title: "Blood Donation",
      date: new Date(),
      donorCode,
      location: request.location?.name || "Unknown Location",
    };

    donorProfile.achievements.push(achievement);
    await donorProfile.save();

    return res.status(200).json({
      message: "Donation confirmed and achievement added successfully!",
      donorCode,
      achievement,
    });
  } catch (err) {
    console.error("Donation confirmation error:", err);
    res.status(500).json({ message: "Server error while confirming donation" });
  }
});

module.exports = router;
</file>

<file path="backend/routes/profile.js">
// backend/routes/profile.js
const express = require("express");
const UserProfile = require("../models/UserProfile.js");

const router = express.Router();

/**
 * GET /api/profile/:email
 * Fetch user profile by email
 */
router.get("/:email", async (req, res) => {
  try {
    const { email } = req.params;
    if (!email) return res.status(400).json({ msg: "Email is required" });

    const profile = await UserProfile.findOne({ email });

    if (!profile) {
      // Return default empty profile structure if not found
      return res.json({
        email,
        name: "",
        age: "",
        gender: "",
        bloodGroup: "",
        height: "",
        weight: "",
        allergies: "",
        medicalConditions: "",
        medications: "",
        fathername: "",
        mothername: "",
        emergencyContact: {
          name: "",
          phone: "",
          relation: "",
        },
        achievements: [], // ✅ fixed (no undefined variable)
      });
    }

    // ✅ Ensure achievements always exist
    if (!profile.achievements) profile.achievements = [];

    res.status(200).json(profile);
  } catch (err) {
    console.error("Profile fetch error:", err);
    res.status(500).json({ msg: "Server error" });
  }
});

/**
 * POST /api/profile/:email
 * Update or create profile by email
 */
router.post("/:email", async (req, res) => {
  try {
    const { email } = req.params;
    if (!email) return res.status(400).json({ msg: "Email is required" });

    const profileData = req.body;
    profileData.email = email;

    const updatedProfile = await UserProfile.findOneAndUpdate(
      { email },
      { $set: profileData },
      {
        new: true,
        upsert: true,
        runValidators: true,
      }
    );

    res.status(200).json(updatedProfile);
  } catch (err) {
    console.error("Profile update error:", err);
    res.status(500).json({ msg: "Server error" });
  }
});

/**
 * POST /api/profile
 * Alternative endpoint using email in body
 */
router.post("/", async (req, res) => {
  try {
    const { email, ...profileData } = req.body;
    if (!email) return res.status(400).json({ msg: "Email is required" });

    const updatedProfile = await UserProfile.findOneAndUpdate(
      { email },
      { $set: { ...profileData, email } },
      {
        new: true,
        upsert: true,
        runValidators: true,
      }
    );

    res.status(200).json(updatedProfile);
  } catch (err) {
    console.error("Profile save error:", err);
    res.status(500).json({ msg: "Server error" });
  }
});

module.exports = router;
</file>

<file path="backend/routes/users.js">
import mongoose from "mongoose";

const userSchema = new mongoose.Schema({
  name: String,
  email: { type: String, unique: true },
  password: String,
  location: {
    lat: Number,
    lng: Number,
  },
});

export default mongoose.model("User", userSchema);
</file>

<file path="frontend/.gitignore">
# Environment variables
.env
.env.local
.env.production
.env.development

# Node modules
node_modules/

# Build output
dist/
build/

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# OS files
.DS_Store
Thumbs.db
</file>

<file path="frontend/eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="frontend/postcss.config.cjs">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
</file>

<file path="frontend/public/robots.txt">
User-agent: *
Disallow:
</file>

<file path="frontend/public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="frontend/src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="frontend/src/components/phoneMockup.jsx">
import React from "react";

const PhoneMockup = ({ children }) => {
  return (
    <div className="relative w-full max-w-sm h-[800px] mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
      {children}
    </div>
  );
};

export default PhoneMockup;
</file>

<file path="frontend/src/hooks/useSocket.js">
import { useEffect, useRef } from "react";
import { io } from "socket.io-client";


export default function useSocket(userId) {
  const socketRef = useRef(null);

  useEffect(() => {
    if (!userId) return;

    // Use VITE_API_URL environment variable or fallback to localhost
    const SOCKET_URL = import.meta.env.VITE_BACKEND_URL || "http://localhost:5000";
    const socket = io(SOCKET_URL, { autoConnect: false });

    socketRef.current = socket;

    // Manually connect after initialization
    socket.connect();

    socket.on('connect', () => {
      socket.emit('identify', { userId });
      console.log(`Socket connected with id ${socket.id}`);
    });

    // Optional: handle reconnect attempts
    socket.io.on('reconnect_attempt', () => {
      console.log('Attempting to reconnect to socket server...');
    });

    return () => {
      if (socketRef.current) {
        socketRef.current.disconnect();
        socketRef.current = null;
      }
    };
  }, [userId]);

  return socketRef;
}
</file>

<file path="frontend/src/layout/Layout.jsx">
// import { Outlet } from "react-router-dom";
// import Navbar from "../components/Navbar";

// const Layout = () => {
//   return (
//     <div className="flex">
//       {/* Sidebar */}
//       <Navbar />

//       {/* Page Content */}
//       <main className="ml-16 hover:ml-64 transition-all duration-300 w-full p-4">
//         <Outlet />
//       </main>
//     </div>
//   );
// };

// export default Layout;
</file>

<file path="frontend/src/main.jsx">
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";
import "./index.css";
import { AuthProvider } from "./context/AuthContext";


ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <AuthProvider>
      <App />
    </AuthProvider>
  </React.StrictMode>
);
</file>

<file path="frontend/src/screens/AI.jsx">
// src/screens/AIHealthAssist.jsx
import React, { useState } from "react";

const AIHealthAssist = () => {
  // Sample AI health assist data
  const assists = [
    { name: "Fever Diagnosis", category: "Symptom Checker", description: "Get AI-based suggestions for fever causes." },
    { name: "Diabetes Risk", category: "Health Risk", description: "AI analysis of diabetes risk based on symptoms." },
    { name: "Heart Health", category: "Cardiology", description: "AI insights for heart disease risk and prevention." },
    { name: "Skin Check", category: "Dermatology", description: "Upload symptoms to get AI skin health analysis." },
    { name: "Mental Wellness", category: "Psychology", description: "AI chatbot for stress, anxiety & depression support." },
    { name: "Diet Planner", category: "Nutrition", description: "Personalized AI diet recommendations." },
  ];

  const [searchTerm, setSearchTerm] = useState("");

  // Filter by name or category
  const filteredAssists = assists.filter(
    (assist) =>
      assist.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      assist.category.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-gray-50 p-6">
      <h1 className="text-4xl font-extrabold text-gray-900 mb-8 text-center">
        AI <span className="text-green-600">Health Assist</span>
      </h1>

      {/* Search Bar */}
      <div className="mb-10 max-w-lg mx-auto">
        <input
          type="text"
          placeholder="🔍 Search by assist name or category..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* AI Assists Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
        {filteredAssists.length > 0 ? (
          filteredAssists.map((assist, index) => (
            <div
              key={index}
              className="bg-white shadow-md rounded-xl p-6 hover:shadow-2xl hover:scale-105 transform transition duration-200 cursor-pointer"
            >
              <h2 className="text-xl font-bold text-green-700">{assist.name}</h2>
              <p className="text-sm text-gray-600 mt-1">Category: {assist.category}</p>
              <p className="text-sm text-gray-600 mt-2">{assist.description}</p>
              <button className="mt-4 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                Try Now
              </button>
            </div>
          ))
        ) : (
          <p className="text-gray-500 text-center text-lg col-span-full">
            ❌ No AI assists found.
          </p>
        )}
      </div>
    </div>
  );
};

export default AIHealthAssist;
</file>

<file path="frontend/src/screens/Auth.jsx">
import React, { useState } from "react";
import api from "../services/api";
import { useAuth } from "../context/AuthContext";

const Auth = () => {
  const [mode, setMode] = useState("login"); // 'login' or 'register'
  const [form, setForm] = useState({
    email: "",
    phone: "",
    password: "",
    name: "",
    bloodGroup: "",
    age: "",
  });
  const { login } = useAuth();

  const submit = async () => {
    try {
      // validation
      if ((!form.email && !form.phone) || !form.password) {
        alert("Please provide either Email or Phone and Password!");
        return;
      }

      if (
        mode === "register" &&
        (!form.name || !form.bloodGroup || !form.age)
      ) {
        alert("Please fill all required registration fields!");
        return;
      }

      // ✅ Payload banate waqt sirf filled fields bhejo
      let payload = { password: form.password };

      if (form.email) payload.email = form.email;
      if (form.phone) payload.phone = form.phone;

      if (mode === "register") {
        payload.name = form.name;
        payload.bloodGroup = form.bloodGroup;
        payload.age = form.age;
      }

      const { data } = await api.post(
        mode === "login" ? "/auth/login" : "/auth/register",
        payload
      );

      login(data.user, data.token);

      if (mode === "register") {
        alert("Registration successful! You are now logged in.");
      }
    } catch (err) {
      alert(err.response?.data?.error || "Error");
    }
  };

  return (
    <div className="max-w-md mx-auto p-6 bg-white rounded shadow">
      <h2 className="text-2xl font-bold mb-4 text-center">
        {mode === "login" ? "Login" : "Register"}
      </h2>

      {/* Email & Phone (optional, but at least one required) */}
        <input
        placeholder="Email (optional if using phone)"
        onChange={e => setForm({ ...form, email: e.target.value })}
        className="w-full p-2 border mb-2"
      />
      <input
        placeholder="Phone (optional if using email)"
        onChange={e => setForm({ ...form, phone: e.target.value })}
        className="w-full p-2 border mb-2"
/>

      {/* Password */}
      <input
        placeholder="Password"
        type="password"
        value={form.password}
        onChange={(e) => setForm({ ...form, password: e.target.value })}
        className="w-full p-2 border mb-2 rounded"
      />

      {/* Extra fields for registration */}
      {mode === "register" && (
        <>
          <input
            placeholder="Full Name"
            value={form.name}
            onChange={(e) => setForm({ ...form, name: e.target.value })}
            className="w-full p-2 border mb-2 rounded"
          />
          <input
            placeholder="Blood Group"
            value={form.bloodGroup}
            onChange={(e) =>
              setForm({ ...form, bloodGroup: e.target.value })
            }
            className="w-full p-2 border mb-2 rounded"
          />
          <input
            placeholder="Age"
            type="number"
            value={form.age}
            onChange={(e) => setForm({ ...form, age: e.target.value })}
            className="w-full p-2 border mb-2 rounded"
          />
        </>
      )}

      {/* Submit button */}
      <button
        onClick={submit}
        className="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
      >
        {mode === "login" ? "Login" : "Register"}
      </button>

      {/* Switch mode */}
      <div className="mt-3 text-center">
        <button
          onClick={() =>
            setMode(mode === "login" ? "register" : "login")
          }
          className="text-sm text-blue-600 underline"
        >
          {mode === "login"
            ? "Don't have an account? Register"
            : "Already have an account? Login"}
        </button>
      </div>
    </div>
  );
};

export default Auth;
</file>

<file path="frontend/src/screens/Cart.jsx">
import React from "react";

const Cart = ({ onBack, onCheckout }) => {
  return (
    <div className="absolute inset-0 bg-gray-50 overflow-y-auto">
      <div className="p-4 bg-gray-800 text-white flex justify-between items-center sticky top-0">
        <button onClick={onBack}>←</button>
        <h1 className="font-bold">My Cart</h1>
        <div className="w-10" />
      </div>
      <div className="p-4">
        <div className="bg-white p-3 rounded-lg">Dolo 650mg - ₹30.90</div>
        <div className="bg-white p-3 rounded-lg mt-2">Vicks Vaporub - ₹140</div>
        <button
          onClick={onCheckout}
          className="mt-6 w-full bg-teal-600 text-white py-3 rounded-lg"
        >
          Proceed to Checkout
        </button>
      </div>
    </div>
  );
};

export default Cart;
</file>

<file path="frontend/src/screens/Checkout.jsx">
import React from "react";

const Checkout = ({ onBack, onSuccess }) => {
  return (
    <div className="absolute inset-0 bg-gray-50 overflow-y-auto">
      <div className="p-4 bg-gray-800 text-white flex justify-between items-center sticky top-0">
        <button onClick={onBack}>←</button>
        <h1 className="font-bold">Checkout</h1>
        <div className="w-10" />
      </div>

      <div className="p-4">
        <div className="bg-white p-4 rounded-lg shadow mb-4">
          <h2 className="font-semibold text-gray-700">Shipping Address</h2>
          <p className="text-sm text-gray-600">123, MG Road, Bangalore</p>
        </div>

        <div className="bg-white p-4 rounded-lg shadow mb-4">
          <h2 className="font-semibold text-gray-700">Payment Method</h2>
          <p className="text-sm text-gray-600">UPI (PhonePe)</p>
        </div>

        <div className="bg-white p-4 rounded-lg shadow">
          <h2 className="font-semibold text-gray-700">Order Summary</h2>
          <p className="text-sm text-gray-600">2 items</p>
          <p className="font-bold mt-2">₹170.90</p>
        </div>

        <button
          onClick={onSuccess}
          className="mt-6 w-full bg-teal-600 text-white py-3 rounded-lg hover:bg-teal-700 transition"
        >
          Place Order
        </button>
      </div>
    </div>
  );
};

export default Checkout;
</file>

<file path="frontend/src/screens/Doctor.jsx">
// src/screens/Doctor.jsx
import React, { useState } from "react";

const Doctor = () => {
  // Sample doctors data
  const doctors = [
    { name: "Dr. Ramesh Kumar", specialization: "Cardiologist", experience: "10 years" },
    { name: "Dr. Priya Sharma", specialization: "Dermatologist", experience: "7 years" },
    { name: "Dr. Anil Verma", specialization: "Pediatrician", experience: "12 years" },
    { name: "Dr. Kavita Singh", specialization: "Gynecologist", experience: "9 years" },
    { name: "Dr. Arjun Mehta", specialization: "Orthopedic", experience: "8 years" },
    { name: "Dr. Neha Gupta", specialization: "Neurologist", experience: "6 years" },
  ];

  const [searchTerm, setSearchTerm] = useState("");

  // Filter by name or specialization
  const filteredDoctors = doctors.filter(
    (doctor) =>
      doctor.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      doctor.specialization.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-gray-50 p-6">
      <h1 className="text-4xl font-extrabold text-gray-900 mb-8 text-center">
        Find Your <span className="text-indigo-600">Doctor</span>
      </h1>

      {/* Search Bar */}
      <div className="mb-10 max-w-lg mx-auto">
        <input
          type="text"
          placeholder="🔍 Search by name or specialization..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* Doctors Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
        {filteredDoctors.length > 0 ? (
          filteredDoctors.map((doctor, index) => (
            <div
              key={index}
              className="bg-white shadow-md rounded-xl p-6 hover:shadow-2xl hover:scale-105 transform transition duration-200 cursor-pointer"
            >
              <h2 className="text-xl font-bold text-indigo-700">{doctor.name}</h2>
              <p className="text-sm text-gray-600 mt-1">Specialization: {doctor.specialization}</p>
              <p className="text-sm text-gray-600 mt-1">Experience: {doctor.experience}</p>
            </div>
          ))
        ) : (
          <p className="text-gray-500 text-center text-lg col-span-full">
            ❌ No doctors found.
          </p>
        )}
      </div>
    </div>
  );
};

export default Doctor;
</file>

<file path="frontend/src/screens/Lab.jsx">
// src/screens/Labtest.jsx
import React, { useState } from "react";

const Labtest = () => {
  // Sample lab tests data
  const labTests = [
    { name: "Blood Sugar Test", category: "Pathology", price: "₹300" },
    { name: "Lipid Profile", category: "Biochemistry", price: "₹800" },
    { name: "Complete Blood Count (CBC)", category: "Hematology", price: "₹500" },
    { name: "Thyroid Profile", category: "Endocrinology", price: "₹700" },
    { name: "X-Ray Chest", category: "Radiology", price: "₹1000" },
    { name: "MRI Brain", category: "Radiology", price: "₹5000" },
  ];

  const [searchTerm, setSearchTerm] = useState("");

  // Filter by name or category
  const filteredTests = labTests.filter(
    (test) =>
      test.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      test.category.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-50 to-gray-50 p-6">
      <h1 className="text-4xl font-extrabold text-gray-900 mb-8 text-center">
        Book Your <span className="text-pink-600">Lab Test</span>
      </h1>

      {/* Search Bar */}
      <div className="mb-10 max-w-lg mx-auto">
        <input
          type="text"
          placeholder="🔍 Search by test name or category..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* Lab Tests Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
        {filteredTests.length > 0 ? (
          filteredTests.map((test, index) => (
            <div
              key={index}
              className="bg-white shadow-md rounded-xl p-6 hover:shadow-2xl hover:scale-105 transform transition duration-200 cursor-pointer"
            >
              <h2 className="text-xl font-bold text-pink-700">{test.name}</h2>
              <p className="text-sm text-gray-600 mt-1">Category: {test.category}</p>
              <p className="text-sm text-gray-600 mt-1">Price: {test.price}</p>
            </div>
          ))
        ) : (
          <p className="text-gray-500 text-center text-lg col-span-full">
            ❌ No lab tests found.
          </p>
        )}
      </div>
    </div>
  );
};

export default Labtest;
</file>

<file path="frontend/src/screens/Profile.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import bgImage from "../assets/pbgc.avif";
import { useAuth } from "../context/AuthContext";

const Profile = () => {
  const { user } = useAuth();
  const userEmail = user?.email;

  const [userData, setUserData] = useState({
    name: "",
    age: "",
    gender: "",
    bloodGroup: "",
    height: "",
    weight: "",
    allergies: "",
    medicalConditions: "",
    medications: "",
    fathername: "",
    mothername: "",
    emergencyContact: { name: "", phone: "", relation: "" },
    achievements: [],
  });

  const [editMode, setEditMode] = useState(false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [userName, setUserName] = useState("");
  

  // Fetch profile data
  useEffect(() => {
    if (!userEmail) {
      setError("User not logged in. Please log in again.");
      return;
    }
    fetchProfile();
  }, [userEmail]);

   useEffect(() => {
      if (user && user.name) {
        setUserName(user.name); // Use user from parent state if available
      } else {
        const storedUser = localStorage.getItem("user");
        if (storedUser) {
          const parsedUser = JSON.parse(storedUser);
          setUserName(parsedUser.name);
        }
      }
    }, [user]);

  const fetchProfile = async () => {
    setLoading(true);
    setError("");
    try {
      const res = await axios.get(
        `${import.meta.env.VITE_BACKEND_URL}/api/profile/${encodeURIComponent(userEmail)}`
      );
      const data = res.data || {};

      // Ensure emergencyContact is always an object
      setUserData({
        ...userData,
        ...data,
        emergencyContact: data.emergencyContact || {
          name: "",
          phone: "",
          relation: "",
        },
        achievements: data.achievements || [],
      });
    } catch (err) {
      console.error("Profile fetch error:", err);
      setError("Error fetching profile: " + (err.response?.data?.msg || err.message));
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    if (name.startsWith("emergencyContact.")) {
      const field = name.split(".")[1];
      setUserData((prev) => ({
        ...prev,
        emergencyContact: {
          ...prev.emergencyContact,
          [field]: value,
        },
      }));
    } else {
      setUserData((prev) => ({ ...prev, [name]: value }));
    }
  };

  const handleSave = async () => {
    if (!userEmail) {
      setError("User email unavailable.");
      return;
    }
    setLoading(true);
    setError("");
    try {
      const res = await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/profile/${encodeURIComponent(userEmail)}`,
        userData
      );
      setUserData(res.data);
      setEditMode(false);
      alert("Profile updated successfully!");
    } catch (err) {
      console.error("Profile save error:", err);
      setError("Failed to save profile. " + (err.response?.data?.msg || err.message));
    } finally {
      setLoading(false);
    }
  };

  const renderInput = (field, label, type = "text") => (
    <div key={field}>
      <p className="text-gray-500 font-medium">{label}</p>
      {editMode ? (
        <input
          type={type}
          name={field}
          value={userData[field] || ""}
          onChange={handleChange}
          className="border rounded p-2 w-full mt-1 placeholder:text-gray-400"
          placeholder={`Enter ${label.toLowerCase()}`}
        />
      ) : (
        <p className="text-gray-900 font-semibold">
          {userData[field] || "Not provided"}
        </p>
      )}
    </div>
  );

  const renderEmergencyInput = (field, label) => (
    <div key={field}>
      <p className="text-gray-500 font-medium">{label}</p>
      {editMode ? (
        <input
          type="text"
          name={`emergencyContact.${field}`}
          value={userData?.emergencyContact?.[field] || ""}
          onChange={handleChange}
          className="border rounded p-2 w-full mt-1 placeholder:text-gray-400"
          placeholder={`Enter ${label.toLowerCase()}`}
        />
      ) : (
        <p className="text-gray-900 font-semibold">
          {userData?.emergencyContact?.[field] || "Not provided"}
        </p>
      )}
    </div>
  );

  if (loading && !editMode)
    return (
      <div className="min-h-screen bg-gray-100 flex items-center justify-center">
        <p className="text-xl text-gray-700">Loading profile...</p>
      </div>
    );

  return (
    <div
      className="min-h-screen bg-gray-100 p-6 bg-cover bg-center"
      style={{ backgroundImage: `url(${bgImage})` }}
    >
      <h1 className="text-4xl font-bold text-gray-800 mb-8 text-center"> Hello, <span className="text-teal-600">{userName || "Guest"}</span></h1>

      {error && (
        <div className="max-w-4xl mx-auto mb-4 p-4 bg-red-100 border border-red-400 rounded">
          <p className="text-red-700">{error}</p>
        </div>
      )}

      <div className="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-8 space-y-8">
        {/* Toggle Edit */}
        <h1 className="text-2xl font-bold text-gray-800 mb-8 text-center"><u>MEDICAL REPORT</u></h1>
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-2xl font-semibold text-gray-700">Profile Information</h2>
          <button
            onClick={() => setEditMode(!editMode)}
            disabled={loading}
            className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400"
          >
            {editMode ? "Cancel Edit" : "Edit Profile"}
          </button>
        </div>

        {/* Personal Info */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {renderInput("name", "Full Name")}
          {renderInput("age", "Age", "number")}
          {renderInput("gender", "Gender")}
          {renderInput("bloodGroup", "Blood Group")}
          {renderInput("height", "Height")}
          {renderInput("weight", "Weight")}
          {renderInput("allergies", "Allergies")}
          {renderInput("medicalConditions", "Medical Conditions")}
          {renderInput("medications", "Medications")}
        </div>

        {/* Emergency Contact */}
        <div>
          <h2 className="text-2xl font-semibold text-gray-700 mb-4">Emergency Contact</h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {renderEmergencyInput("name", "Contact Name")}
            {renderEmergencyInput("relation", "Relation")}
            {renderEmergencyInput("phone", "Phone")}
          </div>
        </div>

        {/* Achievements */}
        <div>
          <h2 className="text-2xl font-bold text-gray-800 text-center mb-4"><u>Achievements</u></h2>
          <ul className="space-y-2">
            {userData.achievements?.length > 0 ? (
              userData.achievements.map((ach, idx) => (
                <li
                  key={idx}
                  className="bg-gradient-to-br from-red-50 to-pink-100 border border-red-200 rounded-xl p-4 shadow-sm"
                >
                  <p className="font-semibold text-gray-800">{ach.title}</p>
                  <p className="text-sm text-gray-600">
                    {new Date(ach.date).toLocaleDateString()} –{" "}
                    {ach.location || "Unknown location"}
                  </p>
                  {ach.donorCode && (
                    <p className="text-sm text-green-700 font-medium mt-1">
                      Donor Code: {ach.donorCode}
                    </p>
                  )}
                </li>
              ))
            ) : (
              <p className="text-gray-600">No achievements yet.</p>
            )}
          </ul>
        </div>

        {/* Save Button */}
        {editMode && (
          <div className="flex justify-center mt-6">
            <button
              onClick={handleSave}
              disabled={loading}
              className="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 disabled:bg-gray-400"
            >
              {loading ? "Saving..." : "Save Profile"}
            </button>
          </div>
        )}
      </div>
    </div>
  );
};

export default Profile;
</file>

<file path="frontend/src/screens/Raksha.jsx">
// src/screens/Raksha.jsx
import React, { useState, useEffect } from "react";
import axios from "axios";
import Confetti from "react-confetti";
import { useAuth } from "../context/AuthContext";

const Raksha = () => {
  const { user } = useAuth();
  const [requests, setRequests] = useState([]);
  const [formData, setFormData] = useState({ group: "", units: "", locationName: "" });
  const [loading, setLoading] = useState(false);
  const [showDonorCode, setShowDonorCode] = useState(false);
  const [donorCode, setDonorCode] = useState("");
  const [error, setError] = useState("");
  const [serverStatus, setServerStatus] = useState("checking");
  const [thankYou, setThankYou] = useState(false);
  const [showConfetti, setShowConfetti] = useState(false);
  const [windowSize, setWindowSize] = useState({ width: window.innerWidth, height: window.innerHeight });

  // Check backend status
  const checkServerStatus = async () => {
    try {
      await axios.get(`${import.meta.env.VITE_BACKEND_URL}`);
      setServerStatus("online");
      setError("");
    } catch {
      setServerStatus("offline");
      setError("Backend server is not running. Please start it.");
    }
  };

  // Fetch all requests
  const fetchRequests = async () => {
    if (serverStatus !== "online") return;
    try {
      const res = await axios.get(`${import.meta.env.VITE_BACKEND_URL}/api/requests`);
      const filtered = res.data.filter(req => req.status === "open" || req.status === "accepted");
      setRequests(filtered);
      setError("");
    } catch (err) {
      console.error("Fetch error:", err);
      if (err.code === "ERR_NETWORK") {
        setServerStatus("offline");
        setError("Cannot connect to backend server.");
      } else setError("Error fetching requests: " + (err.response?.data?.message || err.message));
    }
  };

  useEffect(() => {
    checkServerStatus();
    const handleResize = () => setWindowSize({ width: window.innerWidth, height: window.innerHeight });
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);

  useEffect(() => {
    if (serverStatus === "online") fetchRequests();
  }, [serverStatus]);

  const handleChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });

  // 🩸 Submit new request
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!user || !user.email) return alert("User not logged in!");
    if (!formData.group || !formData.units || !formData.locationName) return alert("Fill all fields!");
    setLoading(true);
    try {
      const res = await axios.post(`${import.meta.env.VITE_BACKEND_URL}/api/requests/request`, {
        ...formData,
        units: Number(formData.units),
        requesterEmail: user.email,
        lat: null,
        lng: null,
      });
      setRequests([...requests, res.data]);
      setFormData({ group: "", units: "", locationName: "" });
      alert("Request submitted successfully!");
    } catch (err) {
      console.error("Request error:", err);
      alert("Error: " + (err.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  // 🩸 Donor accepts request
  const handleAccept = async (requestId) => {
    if (serverStatus !== "online") return setError("Backend server is offline.");
    if (!user || !user.email) return alert("User not logged in!");
    setLoading(true);
    try {
      const randomCode = Math.floor(100000 + Math.random() * 900000).toString();
      await axios.put(`${import.meta.env.VITE_BACKEND_URL}/api/requests/${requestId}/accept`, {
        donorEmail: user.email,
        donorCode: randomCode,
        donorName: user.name,
        donorPhone: user.phone,
      });
      setDonorCode(randomCode);
      setShowDonorCode(true);
      fetchRequests();
    } catch (err) {
      console.error("Accept error:", err);
      alert("Error: " + (err.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  // 🩸 Requester confirms donation
  const handleConfirmDonation = async (requestId) => {
    try {
      const res = await axios.post(`${import.meta.env.VITE_BACKEND_URL}/api/requests/confirmDonation/${requestId}`);
      setDonorCode(res.data.donorCode);
      setThankYou(true);
      setShowConfetti(true);
      setTimeout(() => setShowConfetti(false), 5000);
      fetchRequests();
    } catch (err) {
      console.error("Confirm donation error:", err);
      alert("Error confirming donation.");
    }
  };

  const closeDonorPopup = () => {
    setShowDonorCode(false);
    setDonorCode("");
  };

  const retryConnection = () => {
    setServerStatus("checking");
    checkServerStatus();
  };

  return (
    <div className="min-h-screen p-6 bg-gray-100 relative">
      <h1 className="text-3xl font-bold mb-6 text-center">🩸 Blood Requests</h1>

      {showConfetti && <Confetti width={windowSize.width} height={windowSize.height} />}

      {/* Backend offline */}
      {serverStatus === "offline" && (
        <div className="max-w-4xl mx-auto mb-4 p-4 bg-red-100 border border-red-400 rounded">
          <p className="text-red-700 font-semibold">⚠️ Backend Server Offline</p>
          <p className="text-red-600 mb-2">{error}</p>
          <button onClick={retryConnection} className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
            Retry
          </button>
        </div>
      )}

      {/* Form for requester */}
      {serverStatus === "online" && (
        <div className="max-w-md mx-auto bg-white p-6 rounded shadow mb-8">
          <h2 className="text-xl font-semibold mb-4">Create a Request</h2>
          <form onSubmit={handleSubmit} className="space-y-4">
            <input type="text" name="group" placeholder="Blood Group (e.g., A+)" className="border p-2 w-full rounded"
              value={formData.group} onChange={handleChange} />
            <input type="number" name="units" placeholder="Units" className="border p-2 w-full rounded"
              value={formData.units} onChange={handleChange} />
            <input type="text" name="locationName" placeholder="Location (e.g., City Hospital)"
              className="border p-2 w-full rounded" value={formData.locationName} onChange={handleChange} />
            <button type="submit" disabled={loading}
              className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 disabled:bg-gray-400">
              {loading ? "Submitting..." : "Submit Request"}
            </button>
          </form>
        </div>
      )}

      {/* Donor Thank You Popup */}
      {showDonorCode && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fadeIn">
          <div className="bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto animate-bounceIn text-center">
            <h2 className="text-2xl font-bold text-green-600 mb-4">Thank You! 🙏</h2>
            <p className="text-lg mb-2">You’ve accepted this request.</p>
            <div className="bg-yellow-100 p-4 rounded mb-4">
              <p className="font-semibold">Your Donor Code:</p>
              <p className="text-2xl font-bold text-red-600 my-2">{donorCode}</p>
              <p className="text-sm text-gray-600">Please share this code after donating.</p>
            </div>
            <button onClick={closeDonorPopup} className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full">
              OK
            </button>
          </div>
        </div>
      )}

      {/* Thank You Confirmation Modal (Requester side) */}
      {thankYou && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 animate-fadeIn">
          <div className="bg-white rounded-2xl p-8 shadow-xl text-center w-80 animate-bounceIn">
            <h2 className="text-2xl font-bold text-green-700 mb-2">Donation Confirmed! 🎉</h2>
            <p className="mb-2">The donor successfully donated blood.</p>
            <p className="font-semibold text-red-600 text-lg mb-2">Code: {donorCode}</p>
            <p className="text-gray-600 text-sm mb-4">A new achievement has been added to donor’s profile 🏅</p>
            <button onClick={() => setThankYou(false)} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
              Close
            </button>
          </div>
        </div>
      )}

      {/* Requests */}
      {serverStatus === "online" && (
        <div className="max-w-4xl mx-auto">
          <h2 className="text-2xl font-semibold mb-4">Existing Requests</h2>
          {requests.length === 0 ? (
            <p className="text-center text-gray-500">No active blood requests.</p>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {requests.map((req) => (
                <div key={req._id} className="bg-white p-4 rounded shadow relative">
                  <div className={`absolute top-0 left-0 w-2 h-full ${req.status === "accepted" ? "bg-green-500" : "bg-red-500"}`}></div>
                  <div className="ml-3">
                    <p><strong>Blood Group:</strong> {req.group}</p>
                    <p><strong>Units:</strong> {req.units}</p>
                    <p><strong>Location:</strong> {req.location.name}</p>
                    <p><strong>Requester:</strong> {req.requester}</p>
                    <p><strong>Status:</strong>
                      <span className={`font-semibold ${req.status === "accepted" ? "text-green-600" : "text-red-600"}`}>
                        {req.status.toUpperCase()}
                      </span>
                    </p>

                    {req.status === "accepted" && req.donor && (
                      <div className="mt-2 p-2 bg-green-50 rounded">
                        <p><strong>Accepted by:</strong> {req.donorName || req.donor}</p>
                        {req.donorPhone && <p><strong>Donor Phone:</strong> {req.donorPhone}</p>}
                        {req.donorCode && <p><strong>Donor Code:</strong> {req.donorCode}</p>}
                      </div>
                    )}

                    {/* Donor buttons */}
                    {req.status === "open" && req.requester !== user?.email && (
                      <div className="flex space-x-2 mt-3">
                        <button onClick={() => handleAccept(req._id)} disabled={loading}
                          className="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 disabled:bg-gray-400">
                          Accept
                        </button>
                        <button onClick={() => setRequests(requests.filter(r => r._id !== req._id))}
                          className="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600">
                          Reject
                        </button>
                      </div>
                    )}

                    {/* Requester: Confirm Donation */}
                    {req.status === "accepted" && req.requester === user?.email && !req.donationConfirmed && (
                      <div className="mt-3">
                        <p className="text-sm text-gray-700 mb-1">Has the donor successfully donated blood?</p>
                        <button onClick={() => handleConfirmDonation(req._id)}
                          className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                          ✅ Yes, Donated
                        </button>
                      </div>
                    )}

                    {req.requester === user?.email && (
                      <p className="text-sm text-blue-600 mt-2">
                        This is your request {req.status === "accepted" && "- It has been accepted!"}
                      </p>
                    )}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      )}

      <style>
        {`
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-in-out; }
        @keyframes bounceIn {
          0% { transform: scale(0.8); opacity: 0; }
          50% { transform: scale(1.05); opacity: 1; }
          100% { transform: scale(1); }
        }
        .animate-bounceIn { animation: bounceIn 0.5s ease-in-out; }
        `}
      </style>
    </div>
  );
};

export default Raksha;
</file>

<file path="frontend/src/services/api.js">
import axios from 'axios';
const api = axios.create({ baseURL: import.meta.env.VITE_API_URL || 'http://localhost:5000/api' });
export default api;
</file>

<file path="frontend/tailwind.config.js">
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{js,jsx,ts,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
</file>

<file path="frontend/vercel.json">
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
</file>

<file path="backend/config/db.js">
// backend/db.js
const mongoose = require("mongoose");

const connectDB = async () => {
  try {
    await mongoose.connect("mongodb://127.0.0.1:27017/swasthya_hub" || `${process.env.MONGO_URI}/swasthya_hub`, {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    });
    console.log("MongoDB connected");
  } catch (err) {
    console.error("MongoDB connection failed:", err.message);
    process.exit(1);
  }
};

module.exports = connectDB;
</file>

<file path="backend/middleware/adminAuth.js">
const jwt = require("jsonwebtoken");

module.exports = (req, res, next) => {
  const authHeader = req.headers.authorization;

  if (!authHeader) {
    return res.status(401).json({ message: "No token" });
  }

  if (!authHeader.startsWith("Bearer ")) {
    return res.status(401).json({ message: "Invalid token format" });
  }

  const token = authHeader.split(" ")[1];

  if (!token) {
    return res.status(401).json({ message: "No token" });
  }

  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);

    if (decoded.role !== "admin") {
      return res.status(403).json({ message: "Access denied" });
    }

    req.admin = decoded;
    next();
  } catch (err) {
    return res.status(401).json({ message: "Invalid or expired token" });
  }
};
</file>

<file path="backend/migrateAddAchievements.js">
// migrateAddAchievements.js
const mongoose = require("mongoose");
const User = require("./models/User");

// 🔁 Replace with your MongoDB connection string
const MONGO_URI = `${process.env.MONGO_URI}swasthya`;

const migrateAchievements = async () => {
  try {
    await mongoose.connect(MONGO_URI);
    console.log("✅ Connected to MongoDB");

    // Find users without achievements field
    const users = await User.find({ achievements: { $exists: false } });

    if (users.length === 0) {
      console.log("🎉 All users already have the 'achievements' field!");
      return process.exit(0);
    }

    // Add empty achievements array for all users missing it
    const updateResult = await User.updateMany(
      { achievements: { $exists: false } },
      { $set: { achievements: [] } }
    );

    console.log(
      `✅ Migration complete! Updated ${updateResult.modifiedCount} users.`
    );

    process.exit(0);
  } catch (err) {
    console.error("❌ Migration failed:", err);
    process.exit(1);
  }
};

migrateAchievements();
</file>

<file path="backend/models/pharmacist.js">
const mongoose = require("mongoose");
const bcrypt = require("bcryptjs");

const pharmacistSchema = new mongoose.Schema(
  {
    name: {
      type: String,
      required: true,
    },
    email: {
      type: String,
      required: true,
      unique: true,
    },
    password: {
      type: String,
      required: true,
    },
  },
  { timestamps: true }
);

// 🔐 Hash password before save
pharmacistSchema.pre("save", async function (next) {
  if (!this.isModified("password")) return next();
  this.password = await bcrypt.hash(this.password, 10);
  next();
});

// 🔑 Compare password method
pharmacistSchema.methods.comparePassword = async function (enteredPassword) {
  return await bcrypt.compare(enteredPassword, this.password);
};

module.exports =
  mongoose.models.Pharmacist ||
  mongoose.model("Pharmacist", pharmacistSchema);
</file>

<file path="backend/models/prescription.js">
const mongoose = require("mongoose");

const prescriptionSchema = new mongoose.Schema({
   userId: {
  type: mongoose.Schema.Types.ObjectId,
  ref: "User",
  required: false,
  },
  userName: { type: String, required: true },
  userEmail: { type: String, required: true },

  // 🧾 For uploaded prescriptions
  filename: { type: String, default: null },
  originalname: { type: String, default: null },

  // 💊 For manual selections
  medicines: {
    type: [String], // array of medicine names
    default: [],    // empty array if it's an uploaded file
  },

  // 🔖 Common fields
  type: {
    type: String,
    enum: ["upload", "manual"],
    default: "upload",
  },
  status: {
    type: String,
    enum: ["pending", "confirmed", "rejected"],
    default: "pending",
  },
  date: {
    type: Date,
    default: Date.now,
  },

  // 🧠 Pharmacist confirmation info
  confirmation: {
    allPresent: { type: Boolean, default: false },
    medicines: { type: [String], default: [] }, // confirmed/available medicines
  },
});

module.exports = mongoose.model("Prescription", prescriptionSchema);
</file>

<file path="backend/routes/adminPanel.js">
console.log("✅ adminPanelRoutes loaded");

const express = require("express");
const User = require("../models/User");
const BloodRequest = require("../models/BloodRequest");
const Donation = require("../models/Donation");
const Pharmacist = require("../models/pharmacist"); // ✅ FIXED
const adminAuth = require("../middleware/adminAuth");

const router = express.Router();

// ================= USERS =================
router.get("/users", adminAuth, async (req, res) => {
  const users = await User.find().select("-password");
  res.json(users);
});

// ================= REQUESTS =================
router.get("/requests", adminAuth, async (req, res) => {
  const requests = await BloodRequest.find();
  res.json(requests);
});

// ================= DONATIONS =================
router.get("/donations", adminAuth, async (req, res) => {
  const donations = await Donation.find().populate("request");
  res.json(donations);
});

// ================= PHARMACISTS (GET) =================
router.get("/pharmacists", adminAuth, async (req, res) => {
  const pharmacists = await Pharmacist.find().select("-password");
  res.json(pharmacists);
});

// ================= PHARMACISTS (CREATE) =================
router.post("/pharmacist", adminAuth, async (req, res) => {
  try {
    const { name, email, password } = req.body;

    // ✅ Validation
    if (!name || !email || !password) {
      return res.status(400).json({ message: "All fields are required" });
    }

    // ✅ Check by EMAIL (not userId)
    const exists = await Pharmacist.findOne({ email });
    if (exists) {
      return res.status(400).json({ message: "Pharmacist already exists" });
    }

    // ✅ Create pharmacist
    const pharmacist = new Pharmacist({
      name,
      email,
      password, // assuming password hashing middleware already exists
    });

    await pharmacist.save();

    res.status(201).json({
      message: "Pharmacist created successfully",
      pharmacist,
    });
  } catch (err) {
    console.error("Create pharmacist error:", err);
    res.status(500).json({ message: "Server error" });
  }
});


module.exports = router;
</file>

<file path="backend/routes/auth.js">
// backend/routes/auth.js
const express = require("express");
const bcrypt = require("bcryptjs");
const jwt = require("jsonwebtoken");
const User = require("../models/User.js");

const router = express.Router();

// =========================
// REGISTER ROUTE
// =========================
router.post("/register", async (req, res) => {
  try {
    const { name, email, phone, password, bloodGroup, age } = req.body;

    // Trim values
    if (name) req.body.name = name.trim();
    if (email) req.body.email = email.trim();
    if (phone) req.body.phone = phone.trim();
    if (bloodGroup) req.body.bloodGroup = bloodGroup.trim();

    // Validation
    if (!name || !password || !bloodGroup || !age || (!email && !phone)) {
      return res
        .status(400)
        .json({ error: "Name, password, blood group, age and either email or phone are required" });
    }

    // Check if user exists (by email OR phone)
    const existingUser = await User.findOne({
      $or: [{ email }, { phone }],
    });
    if (existingUser) {
      return res.status(400).json({ error: "User already exists with this email or phone" });
    }

    // Hash password
    const hashedPassword = await bcrypt.hash(password, 10);

    const user = new User({
      name,
      email: email || null,
      phone: phone || null,
      password: hashedPassword,
      bloodGroup,
      age,
    });

    await user.save();

    return res.status(201).json({ message: "User registered successfully" });
  } catch (err) {
    console.error("Register error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
});

// =========================
// LOGIN ROUTE
// =========================
router.post("/login", async (req, res) => {
  try {
    const { email, phone, password } = req.body;

    // Trim values
    if (email) req.body.email = email.trim();
    if (phone) req.body.phone = phone.trim();

    // Validation
    if ((!email && !phone) || !password) {
      return res.status(400).json({ error: "Provide email or phone and password" });
    }

    // Check user existence (by email OR phone)
    const user = await User.findOne({
      $or: [{ email }, { phone }],
    });
    if (!user) return res.status(400).json({ error: "Invalid credentials" });

    // Compare password
    const isMatch = await bcrypt.compare(password, user.password);
    if (!isMatch) return res.status(400).json({ error: "Invalid credentials" });

    // Sign JWT
   const token = jwt.sign(
  {
    _id: user._id,
    role: "user",
    email: user.email,
  },
  process.env.JWT_SECRET,
  { expiresIn: "7d" }
);


    // Send only safe user info
    const { password: _, ...userData } = user._doc;

    return res.json({ token, user: userData });
  } catch (err) {
    console.error("Login error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
});

module.exports = router;
</file>

<file path="backend/scripts/createPharmacists.js">
const mongoose = require('mongoose');
const Pharmacist = require('../models/pharmacist'); // adjust path as needed

mongoose.connect(`${process.env.MONGO_URI}/swasthya`);

const pharmacists = [
  { userId: "Amrit", password: "Amrit@123" },
  { userId: "Nishant", password: "Nishant@123" },
  { userId: "Dipu", password: "Dalla@123" }
];

(async () => {
  for (const user of pharmacists) {
    const exists = await Pharmacist.findOne({ userId: user.userId });
    if (!exists) {
      const pharmacist = new Pharmacist(user);
      await pharmacist.save();
      console.log(`Created pharmacist ${user.userId}`);
    } else {
      console.log(`UserId ${user.userId} already exists, skipping.`);
    }
  }
  console.log("All pharmacist creation attempts complete!");
  mongoose.disconnect();
})();
</file>

<file path="backend/server.js">
const express = require("express");
const mongoose = require("mongoose");
const cors = require("cors");
const dotenv = require("dotenv");
const path = require("path");
const mime = require("mime-types");
const Grid = require("gridfs-stream");
const http = require("http");
const { Server } = require("socket.io");

// Importing routes
const authRoutes = require("./routes/auth.js");
const bloodRequestRoutes = require("./routes/bloodRoutes.js");
const profileRoutes = require("./routes/profile.js");
const prescriptionRoutes = require("./routes/prescriptions");
const pharmacistAuthRoutes = require("./routes/pharmacistAuth.js");
const pharmacistDashboardRoutes = require("./routes/pharmacistDashboard");

// ✅ Newly added admin routes
const adminAuthRoutes = require("./routes/adminAuth.js");
const adminPanelRoutes = require("./routes/adminPanel.js");

dotenv.config();

const app = express();
const server = http.createServer(app);

// Setup socket.io with proper CORS
const io = new Server(server, {
  cors: {
    origin: ["http://localhost:3000", process.env.FRONTEND_URL],
    credentials: true,
  },
});

app.set("io", io);

io.on("connection", (socket) => {
  console.log("✅ User connected:", socket.id);
  socket.on("identify", ({ userId }) => {
    socket.join(userId);
    console.log(`User ${userId} joined their personal room`);
  });
});

// Middleware
app.use(express.json());

// Global CORS config
app.use(
  cors({
    origin: ["http://localhost:3000", process.env.FRONTEND_URL],
    credentials: true,
    allowedHeaders: ["Content-Type", "Authorization"],
  })
);

// MongoDB connection and GridFS initialization
let gfs;
const MONGO_URI = process.env.MONGO_URI || "mongodb://localhost:27017/swasthya";

mongoose
  .connect(MONGO_URI, { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => {
    const conn = mongoose.connection;
    gfs = Grid(conn.db, mongoose.mongo);
    gfs.collection("prescriptions");
    console.log("✅ MongoDB connected and GridFS initialized");
  })
  .catch((err) => {
    console.error("❌ MongoDB connection error:", err);
    process.exit(1);
  });

// ==========================
// 🔗 ROUTE MIDDLEWARES
// ==========================
app.use("/api/auth", authRoutes); // user auth
app.use("/api/requests", bloodRequestRoutes); // blood requests
app.use("/api/profile", profileRoutes); // user profiles
app.use("/api/prescriptions", prescriptionRoutes); // prescriptions upload/view
app.use("/api/pharmacist", pharmacistDashboardRoutes); // pharmacist dashboard
app.use("/api/pharmacist-auth", pharmacistAuthRoutes); // pharmacist login

// ✅ Admin routes
app.use("/api/admin", adminAuthRoutes); // /api/admin/login & /api/admin/register
app.use("/api/admin-panel", adminPanelRoutes); // protected admin operations

// ==========================
// 🗂️ STATIC + FILE STREAMING
// ==========================
app.use("/uploads", express.static(path.join(__dirname, "uploads")));

// Stream prescription images from GridFS
app.get("/api/prescriptions/image/:filename", (req, res) => {
  if (!gfs) {
    return res.status(500).send("GridFS not initialized");
  }

  const filename = req.params.filename;

  gfs.files.findOne({ filename }, (err, file) => {
    if (err) {
      console.error("Error finding file:", err);
      return res.status(500).send("Server error");
    }

    if (!file || file.length === 0) {
      return res.status(404).send("File not found");
    }

    const contentType =
      file.contentType || mime.lookup(file.filename) || "application/octet-stream";
    res.set("Content-Type", contentType);

    const readstream = gfs.createReadStream(file.filename);

    readstream.on("error", (err) => {
      console.error("Readstream error:", err);
      res.status(500).end("Error while streaming file");
    });

    readstream.pipe(res);
  });
});

// ==========================
// 🩺 HEALTH CHECK
// ==========================
app.get("/", (req, res) => {
  res.send("✅ Swasthya Hub Backend is running successfully!");
});

// ==========================
// ⚠️ GLOBAL ERROR HANDLER
// ==========================
app.use((err, req, res, next) => {
  console.error("Server Error:", err.stack);
  res.status(500).json({ message: err.message || "Internal Server Error" });
});

// ==========================
// 🚀 SERVER START
// ==========================
const PORT = process.env.PORT || 5000;
server.listen(PORT, () => console.log(`🚀 Server running on port ${PORT}`));
</file>

<file path="frontend/index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SvasthyaHub</title>
    <meta name="robots" content="noindex, nofollow" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="frontend/package.json">
{
  "name": "swasthyahub",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.12.2",
    "dotenv": "^17.2.3",
    "lucide-react": "^0.544.0",
    "react": "^18.3.1",
    "react-confetti": "^6.4.0",
    "react-dom": "^18.3.1",
    "react-router-dom": "^7.9.1",
    "socket.io-client": "^4.8.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.33.0",
    "@types/react": "^19.1.10",
    "@types/react-dom": "^19.1.7",
    "@vitejs/plugin-react": "^5.0.0",
    "autoprefixer": "^10.4.21",
    "baseline-browser-mapping": "^2.9.11",
    "eslint": "^9.33.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "globals": "^16.3.0",
    "postcss": "^8.5.6",
    "repomix": "^1.5.0",
    "tailwindcss": "^3.4.17",
    "vite": "^7.1.2"
  }
}
</file>

<file path="frontend/src/context/AuthContext.jsx">
import { createContext, useContext, useEffect, useState } from "react";

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [role, setRole] = useState("guest"); // guest | user | pharmacist | admin

  // 🔄 Restore auth on refresh
  useEffect(() => {
    if (localStorage.getItem("adminToken")) {
      setRole("admin");
    } else if (localStorage.getItem("pharmacistToken")) {
      setRole("pharmacist");
    } else {
      const storedUser = JSON.parse(localStorage.getItem("user"));
      const token = localStorage.getItem("token");
      if (storedUser && token) {
        setUser({ ...storedUser, token });
        setRole("user");
      }
    }
  }, []);

  const loginUser = (userData, token) => {
    localStorage.setItem("user", JSON.stringify(userData));
    localStorage.setItem("token", token);
    setUser({ ...userData, token });
    setRole("user");
  };

  const loginPharmacist = (token) => {
    localStorage.setItem("pharmacistToken", token);
    setRole("pharmacist");
  };

  const loginAdmin = (token) => {
    localStorage.setItem("adminToken", token);
    setRole("admin");
  };

  const logout = () => {
    localStorage.clear();
    setUser(null);
    setRole("guest");
  };

  return (
    <AuthContext.Provider
      value={{
        user,
        role,
        loginUser,
        loginPharmacist,
        loginAdmin,
        logout,
      }}
    >
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
</file>

<file path="frontend/src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

/* .nav-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.6rem 0.75rem;
  border-radius: 0.75rem;
  font-weight: 600;
  color: #374151;
  transition: all 0.2s ease;
}

.nav-item span {
  display: none;
}

.group:hover .nav-item span {
  display: inline;
}

.nav-item:hover {
  background-color: rgba(13, 148, 136, 0.2);
} */
</file>

<file path="frontend/src/screens/Suraksha.jsx">
import React, { useState } from "react";

const paymentOptions = [
  { id: "upi", label: "UPI / QR Code" },
  { id: "card", label: "Credit/Debit Card" },
  { id: "netbanking", label: "Net Banking" },
  { id: "wallet", label: "Wallets" }
];

const Suraksha = () => {
  const plans = [
    {
      name: "Free / Always",
      price: 0,
      duration: "per Year",
      features: [
        "Digital Health Locker",
        "Medication Reminder",
        "Standarad 10% Pharmacy Discount",
        "Standarad Discount on Lab test"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-xl hover:-translate-y-1",
      popular: false,
    },
    {
      name: "Basic",
      price: 999,
      duration: "per Year",
      features: [
        "Digital Health Locker",
        "Medication Reminder",
        "Standarad 10% Pharmacy Discount",
        "Standarad Discount on Lab test"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-xl hover:-translate-y-1",
      popular: false,
    },
    {
      name: "Standard",
      price: 1999,
      duration: "per Year",
      features: [
        "Basic coverage",
        "Priority support",
        "Discounted medicines"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-2xl hover:-translate-y-2",
      popular: true,
    },
    {
      name: "Premium",
      price: 3599,
      duration: "per Year",
      features: [
        "All Standard features",
        "Full coverage",
        "Dedicated health advisor"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-xl hover:-translate-y-1",
      popular: false,
    },
  ];

  const [showPaymentModal, setShowPaymentModal] = useState(false);
  const [selectedPlan, setSelectedPlan] = useState(null);

  const handleSubscribe = (plan) => {
    setSelectedPlan(plan);
    setShowPaymentModal(true);
  };

  const closeModal = () => {
    setShowPaymentModal(false);
    setSelectedPlan(null);
  };

  return (
    <div className="min-h-screen bg-slate-50 p-6 sm:p-8 md:p-12 overflow-y-auto bg-cover bg-center">
      <h1 className="text-6xl font-bold text-gray-700 mt-2 mb-4 text-center">
        Donors Who Deserves Care.
      </h1>
      <h1 className="text-4xl font-extrabold text-gray-900 mb-12 text-center">
        Svasthya <span className="text-teal-600">Suraksha</span>
      </h1>

      <div className="flex flex-row flex-wrap justify-center max-w-6xl mx-auto gap-16">
        {plans.map((plan, index) => (
          <div
            key={index}
            className={`relative rounded-3xl p-8 flex flex-col items-center justify-between transform transition duration-300 ${plan.color} ${plan.hover} shadow-md w-72`}
          >
            {/* Popular Badge */}
            {plan.popular && (
              <span className="absolute top-2.5 right-3 bg-teal-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                Most Popular
              </span>
            )}

            <h2 className="text-2xl font-bold text-gray-800 mb-4">{plan.name}</h2>

            <p className="text-5xl font-extrabold text-teal-700 mb-1">₹{plan.price}</p>
            <p className="text-gray-600 mb-6">{plan.duration}</p>

            <ul className="text-gray-700 mb-6 list-disc list-inside space-y-2 self-start">
              {plan.features.map((feature, i) => (
                <li key={i} className="leading-relaxed">{feature}</li>
              ))}
            </ul>

            <button
              className={`w-full py-4 rounded-xl font-semibold text-white transition ${
                plan.popular ? "bg-teal-600 hover:bg-teal-700" : "bg-teal-600 hover:bg-teal-700"
              }`}
              onClick={() => handleSubscribe(plan)}
            >
              Subscribe
            </button>
          </div>
        ))}
      </div>
      <h1 className="text-5xl font-bold text-gray-700 mt-6 text-center">
        The Gift of Health is the Greatest Reward.
      </h1>

      {/* Payment Modal */}
      {showPaymentModal && (
        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-50 animate-fadeIn">
          <div className="bg-white rounded-xl p-8 shadow-xl w-[90vw] max-w-md relative">
            <button
              className="absolute top-2 right-2 text-lg text-gray-500 hover:text-gray-800"
              onClick={closeModal}
              aria-label="Close payment options"
            >&times;</button>
            <h2 className="text-2xl font-bold mb-4 text-center">Choose Payment Method</h2>
            <ul className="space-y-4 my-6">
              {paymentOptions.map(opt => (
                <li key={opt.id}>
                  <button
                    className="w-full bg-teal-100 hover:bg-teal-200 text-teal-800 py-3 px-4 rounded-lg font-semibold transition"
                    onClick={() => alert(`You selected: ${opt.label}`)}
                  >
                    {opt.label}
                  </button>
                </li>
              ))}
            </ul>
            <button className="w-full mt-2 text-gray-600 underline" onClick={closeModal}>Cancel</button>
          </div>
        </div>
      )}
    </div>
  );
};

export default Suraksha;
</file>

<file path="frontend/vite.config.js">
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [react()],
  build: {
    target: "es2015" // 🔥 REQUIRED for Safari
  }
});
</file>

<file path="package.json">
{
  "name": "swasthyahub",
  "private": true,
  "scripts": {
    "dev": "concurrently \"npm run backend\" \"npm run frontend\"",
    "backend": "cd backend && node server.js",
    "frontend": "cd frontend && npm run dev"
  },
  "devDependencies": {
    "concurrently": "^8.2.0"
  }
}
</file>

<file path="backend/routes/pharmacistAuth.js">
console.log("✅ Pharmacist auth routes loaded");

const express = require("express");
const jwt = require("jsonwebtoken");
const bcrypt = require("bcryptjs");
const Pharmacist = require("../models/pharmacist");

const router = express.Router();

router.post("/login", async (req, res) => {
  try {
    const { email, password } = req.body;

    if (!email || !password) {
      return res.status(400).json({ message: "Email and password required" });
    }

    // 🔍 find by EMAIL (NOT userId)
    const pharmacist = await Pharmacist.findOne({ email });
    if (!pharmacist) {
      return res.status(401).json({ message: "Invalid credentials" });
    }

    // 🔑 password check (IMPORTANT)
    const isMatch = await pharmacist.comparePassword(password);
    if (!isMatch) {
      return res.status(401).json({ message: "Invalid credentials" });
    }

    // 🎟️ JWT token
    const token = jwt.sign(
      {
        id: pharmacist._id,
        role: "pharmacist",
      },
      process.env.JWT_SECRET,
      { expiresIn: "1d" }
    );

    res.json({
      token,
      pharmacist: {
        id: pharmacist._id,
        name: pharmacist.name,
        email: pharmacist.email,
      },
    });
  } catch (err) {
    console.error("Pharmacist login error:", err);
    res.status(500).json({ message: "Server error" });
  }
});


module.exports = router;
</file>

<file path="backend/scripts/createadmin.js">
const mongoose = require("mongoose");
const bcrypt = require("bcryptjs");
const Admin = require("../models/Admin");

mongoose.connect(`${process.env.MONGO_URI}/swasthya`)
  .then(async () => {
    const hashedPassword = await bcrypt.hash("Admin@1234", 10);

    const admin = new Admin({
      email: "admin1@gmail.com",
      password: hashedPassword
    });

    await admin.save();
    console.log("✅ Admin created successfully!");
    mongoose.disconnect();
  })
  .catch(err => console.error("❌ Error:", err));
</file>

<file path="frontend/src/screens/AdminDashboard.jsx">
import { useEffect, useState } from "react";
import axios from "axios";

export default function AdminDashboard() {
  const [users, setUsers] = useState([]);
  const [requests, setRequests] = useState([]);
  const [pharmacists, setPharmacists] = useState([]);

  const [newAdmin, setNewAdmin] = useState({ email: "", password: "" });
  const [newPharmacist, setNewPharmacist] = useState({
    name: "",
    email: "",
    password: "",
  });

  useEffect(() => {
    fetchAll();
  }, []);

  const fetchAll = async () => {
    const token = localStorage.getItem("adminToken");
    if (!token) {
      window.location.href = "/admin/login";
      return;
    }

    const headers = { Authorization: `Bearer ${token}` };

    try {
      const [u, r, p] = await Promise.all([
        axios.get(`${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/users`, {
          headers,
        }),
        axios.get(
          `${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/requests`,
          { headers }
        ),
        axios.get(
          `${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/pharmacists`,
          { headers }
        ),
      ]);

      setUsers(u.data);
      setRequests(r.data);
      setPharmacists(p.data);
    } catch (err) {
      console.error(err);
      localStorage.removeItem("adminToken");
      window.location.href = "/admin/login";
    }
  };

 
  // 🔐 Create Admin (NO TOKEN REQUIRED)
  const createAdmin = async (e) => {
    e.preventDefault();
    try {
      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/admin/register`,
        {
          email: newAdmin.email,
          password: newAdmin.password,
        }
      );

      alert("Admin created");
      setNewAdmin({ email: "", password: "" });
    } catch (err) {
      console.error("Create admin error:", err.response?.data || err.message);
      alert(err.response?.data?.message || "Failed to create admin");
    }
  };

  // 💊 Create Pharmacist
  const createPharmacist = async (e) => {
    e.preventDefault();
    const token = localStorage.getItem("adminToken");

    try {
      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/pharmacist`,
        newPharmacist,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );

      alert("Pharmacist created");
      setNewPharmacist({ name: "", email: "", password: "" });
      fetchAll();
    } catch (err) {
      alert(err.response?.data?.message || "Failed to create pharmacist");
    }
  };

  return (
  <div className="p-4 sm:p-6 lg:p-8 bg-gray-100 min-h-screen">
    <h1 className="text-2xl sm:text-3xl font-bold mb-6 sm:mb-8">
      Admin Dashboard
    </h1>

    {/* 📊 Summary */}
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-8 sm:mb-10">
      <StatCard title="Users" count={users.length} />
      <StatCard title="Blood Requests" count={requests.length} />
      <StatCard title="Pharmacists" count={pharmacists.length} />
    </div>

    {/* ➕ Create Section */}
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 mb-10 sm:mb-12">
      <FormCard title="Create Admin" onSubmit={createAdmin}>
        <Input
          placeholder="Email"
          value={newAdmin.email}
          onChange={(e) =>
            setNewAdmin({ ...newAdmin, email: e.target.value })
          }
        />
        <Input
          placeholder="Password"
          type="password"
          value={newAdmin.password}
          onChange={(e) =>
            setNewAdmin({ ...newAdmin, password: e.target.value })
          }
        />
      </FormCard>

      <FormCard title="Create Pharmacist" onSubmit={createPharmacist}>
        <Input
          placeholder="Name"
          value={newPharmacist.name}
          onChange={(e) =>
            setNewPharmacist({ ...newPharmacist, name: e.target.value })
          }
        />
        <Input
          placeholder="Email"
          value={newPharmacist.email}
          onChange={(e) =>
            setNewPharmacist({ ...newPharmacist, email: e.target.value })
          }
        />
        <Input
          placeholder="Password"
          type="password"
          value={newPharmacist.password}
          onChange={(e) =>
            setNewPharmacist({ ...newPharmacist, password: e.target.value })
          }
        />
      </FormCard>
    </div>

    {/* 📋 Tables */}
    <ResponsiveTable title="Registered Users" headers={["Name", "Email"]}>
      {users.map((u) => (
        <tr key={u._id}>
          <td className="p-3">{u.name}</td>
          <td className="p-3">{u.email}</td>
        </tr>
      ))}
    </ResponsiveTable>

    <ResponsiveTable title="Blood Requests" headers={["Blood Group", "Status"]}>
      {requests.map((r) => (
        <tr key={r._id}>
          <td className="p-3">{r.group}</td>
          <td className="p-3">{r.status}</td>
        </tr>
      ))}
    </ResponsiveTable>

    <ResponsiveTable title="Pharmacists" headers={["Name", "Email"]}>
      {pharmacists.map((p) => (
        <tr key={p._id}>
          <td className="p-3">{p.name}</td>
          <td className="p-3">{p.email}</td>
        </tr>
      ))}
    </ResponsiveTable>
  </div>
  );
}

/* ------------------ UI Components ------------------ */
const StatCard = ({ title, count }) => (
  <div className="bg-white p-4 sm:p-6 rounded-xl shadow">
    <h3 className="text-gray-500 text-sm sm:text-base">{title}</h3>
    <p className="text-2xl sm:text-3xl font-bold">{count}</p>
  </div>
);

const FormCard = ({ title, children, onSubmit }) => (
  <form
    onSubmit={onSubmit}
    className="bg-white p-4 sm:p-6 rounded-xl shadow space-y-4"
  >
    <h2 className="text-lg sm:text-xl font-semibold">{title}</h2>
    {children}
    <button className="w-full sm:w-auto bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition">
      Create
    </button>
  </form>
);

const Input = (props) => (
  <input
    {...props}
    className="border w-full p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
    required
  />
);

const ResponsiveTable = ({ title, headers, children }) => (
  <div className="bg-white rounded-xl shadow mb-8 sm:mb-10">
    <h2 className="text-lg sm:text-xl font-semibold p-4">{title}</h2>
    <div className="overflow-x-auto">
      <table className="min-w-full border-t">
        <thead className="bg-gray-200">
          <tr>
            {headers.map((h) => (
              <th key={h} className="text-left p-3 text-sm sm:text-base">
                {h}
              </th>
            ))}
          </tr>
        </thead>
        <tbody className="divide-y text-sm sm:text-base">
          {children}
        </tbody>
      </table>
    </div>
  </div>
);
</file>

<file path="backend/middleware/auth.js">
const jwt = require("jsonwebtoken");
const User = require("../models/User");
const Pharmacist = require("../models/pharmacist");

module.exports = async (req, res, next) => {
  const auth = req.headers.authorization;
  if (!auth) return res.status(401).json({ error: "No token" });

  const token = auth.split(" ")[1];

  try {
    const payload = jwt.verify(token, process.env.JWT_SECRET);

    // ✅ PHARMACIST FIRST
    if (payload.role === "pharmacist") {
      const pharmacist = await Pharmacist.findById(payload._id);
      if (!pharmacist)
        return res.status(401).json({ error: "Pharmacist not found" });

      req.pharmacist = pharmacist;
      return next();
    }

    // ✅ USER
    if (payload.role === "user") {
      const user = await User.findById(payload._id);
      if (!user)
        return res.status(401).json({ error: "User not found" });

      req.user = user;
      return next();
    }

    return res.status(401).json({ error: "Invalid token role" });
  } catch (err) {
    return res.status(401).json({ error: "Auth failed" });
  }
};
</file>

<file path="backend/routes/pharmacistDashboard.js">
const express = require('express');
const router = express.Router();
const Prescription = require('../models/prescription');
const Pharmacist = require("../models/pharmacist");
const pharmacistAuth = require("../middleware/pharmacistAuth");

// Get logged-in pharmacist info
router.get("/me", pharmacistAuth, async (req, res) => {
  const pharmacist = await Pharmacist.findById(req.pharmacist.id).select("-password");
  res.json(pharmacist);
});

// Get prescriptions assigned to logged-in pharmacist
router.get('/prescriptions', pharmacistAuth, async (req, res) => {
  try {
    const prescriptions = await Prescription.find({ pharmacistUserId: req.pharmacist.userId });
    res.json(prescriptions);
  } catch (err) {
    res.status(500).json({ error: 'Server error' });
  }
});

// Accept a prescription
router.put('/prescriptions/:id/accept', pharmacistAuth, async (req, res) => {
  try {
    const prescription = await Prescription.findById(req.params.id);
    if (!prescription) return res.status(404).json({ error: 'Prescription not found' });

    prescription.status = 'accepted';
    await prescription.save();
    res.json({ message: 'Prescription accepted' });
  } catch (err) {
    res.status(500).json({ error: 'Server error' });
  }
});

// Reject a prescription
router.put('/prescriptions/:id/reject', pharmacistAuth, async (req, res) => {
  try {
    const prescription = await Prescription.findById(req.params.id);
    if (!prescription) return res.status(404).json({ error: 'Prescription not found' });

    prescription.status = 'rejected';
    await prescription.save();
    res.json({ message: 'Prescription rejected' });
  } catch (err) {
    res.status(500).json({ error: 'Server error' });
  }
});

module.exports = router;
</file>

<file path="backend/routes/prescriptions.js">
const express = require("express");
const multer = require("multer");
const Prescription = require("../models/prescription");
const auth = require("../middleware/auth");
const pharmacistAuth = require("../middleware/pharmacistAuth");
const mongoose = require("mongoose");

const router = express.Router();
const upload = multer({ storage: multer.memoryStorage() });

/* =============================
   📤 Upload Prescription (User)
   ============================= */
router.post("/", auth, upload.single("file"), async (req, res) => {
  try {
    if (!req.file) {
      return res.status(400).json({ message: "No file uploaded" });
    }

    const bucket = new mongoose.mongo.GridFSBucket(
      mongoose.connection.db,
      { bucketName: "prescriptions" }
    );

    const uploadStream = bucket.openUploadStream(req.file.originalname, {
      contentType: req.file.mimetype,
    });

    uploadStream.end(req.file.buffer);

    uploadStream.on("finish", async () => {
      const prescription = new Prescription({
        userId: req.user._id,
        userName: req.user.name,
        userEmail: req.user.email,
        filename: req.file.originalname,
        originalname: req.file.originalname,
        type: "upload",
        status: "pending",
        date: new Date(),
      });

      await prescription.save();
      res.json({ message: "Prescription uploaded successfully" });
    });
  } catch (err) {
    console.error(err);
    res.status(500).json({ message: "Upload failed" });
  }
});

/* =============================
   🧾 Get User Prescriptions
   ============================= */
router.get("/", auth, async (req, res) => {
  const prescriptions = await Prescription.find({
    userId: req.user._id,
  }).sort({ date: -1 });

  res.json(prescriptions);
});

/* =============================
   🏥 Get All Prescriptions (Pharmacist)
   ============================= */
router.get("/all", pharmacistAuth, async (req, res) => {
  const prescriptions = await Prescription.find().sort({ date: -1 });
  res.json(prescriptions);
});

/* =============================
   🖼️ Serve Prescription Image
   ============================= */
router.get("/image/:filename", async (req, res) => {
  try {
    const bucket = new mongoose.mongo.GridFSBucket(
      mongoose.connection.db,
      { bucketName: "prescriptions" }
    );

    const stream = bucket.openDownloadStreamByName(req.params.filename);
    stream.on("error", () => res.status(404).send("File not found"));
    stream.pipe(res);
  } catch (err) {
    res.status(500).send("Server error");
  }
});

/* =============================
   ✅ Confirm Prescription (Pharmacist)
   ============================= */
router.put("/:id/confirm", pharmacistAuth, async (req, res) => {
  try {
    const { allPresent, medicines } = req.body;

    const prescription = await Prescription.findById(req.params.id);
    if (!prescription) {
      return res.status(404).json({ message: "Prescription not found" });
    }

    prescription.status = "confirmed";
    prescription.confirmation = {
      allPresent,
      medicines,
      confirmedBy: req.pharmacist._id,
      confirmedAt: new Date(),
    };

    await prescription.save();
    res.json({ message: "Confirmed successfully" });
  } catch (err) {
    console.error(err);
    res.status(500).json({ message: "Server error" });
  }
});

/* =============================
   💊 Manual Medicine Request (User)
   ============================= */
router.post("/manual", auth, async (req, res) => {
  const { medicines } = req.body;

  if (!medicines || medicines.length === 0) {
    return res.status(400).json({ message: "Medicines required" });
  }

  const prescription = new Prescription({
    userId: req.user._id,
    userName: req.user.name,
    userEmail: req.user.email,
    medicines,
    type: "manual",
    status: "pending",
    date: new Date(),
  });

  await prescription.save();
  res.json({ message: "Manual request submitted" });
});

module.exports = router;
</file>

<file path="frontend/repomix-output.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
postcss.config.cjs
public/vite.svg
src/App.jsx
src/assets/react.svg
src/components/Navbar.jsx
src/components/phoneMockup.jsx
src/context/AuthContext.jsx
src/hooks/useSocket.js
src/index.css
src/layout/Layout.jsx
src/main.jsx
src/screens/AdminDashboard.jsx
src/screens/AdminLogin.jsx
src/screens/AI.jsx
src/screens/Aushadhi.jsx
src/screens/Auth.jsx
src/screens/Cart.jsx
src/screens/Checkout.jsx
src/screens/Dashboard.jsx
src/screens/Doctor.jsx
src/screens/Lab.jsx
src/screens/Login.jsx
src/screens/PharmacistLogin.jsx
src/screens/PharmacyAdmin.jsx
src/screens/Profile.jsx
src/screens/Raksha.jsx
src/screens/Suraksha.jsx
src/screens/UserDashboard.jsx
src/services/api.js
tailwind.config.js
vercel.json
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Environment variables
.env
.env.local
.env.production
.env.development

# Node modules
node_modules/

# Build output
dist/
build/

# Logs
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# OS files
.DS_Store
Thumbs.db
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs['recommended-latest'],
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SvasthyaHub</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "swasthyahub",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.12.2",
    "dotenv": "^17.2.3",
    "lucide-react": "^0.544.0",
    "react": "^18.3.1",
    "react-confetti": "^6.4.0",
    "react-dom": "^18.3.1",
    "react-router-dom": "^7.9.1",
    "socket.io-client": "^4.8.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.33.0",
    "@types/react": "^19.1.10",
    "@types/react-dom": "^19.1.7",
    "@vitejs/plugin-react": "^5.0.0",
    "autoprefixer": "^10.4.21",
    "baseline-browser-mapping": "^2.9.11",
    "eslint": "^9.33.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "globals": "^16.3.0",
    "postcss": "^8.5.6",
    "repomix": "^1.5.0",
    "tailwindcss": "^3.4.17",
    "vite": "^7.1.2"
  }
}
</file>

<file path="postcss.config.cjs">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="src/App.jsx">
import React from "react";
import {
  BrowserRouter as Router,
  Routes,
  Route,
  Navigate,
} from "react-router-dom";

import Navbar from "./components/Navbar";

import Dashboard from "./screens/Dashboard";
import UserDashboard from "./screens/UserDashboard";
import Suraksha from "./screens/Suraksha";
import Aushadhi from "./screens/Aushadhi";
import Raksha from "./screens/Raksha";
import Profile from "./screens/Profile";
import Doctor from "./screens/Doctor";
import Labtest from "./screens/Lab";
import Healthassist from "./screens/AI";
import Login from "./screens/Login";
import PharmacyAdmin from "./screens/PharmacyAdmin";
import PharmacistLogin from "./screens/PharmacistLogin";
import AdminLogin from "./screens/AdminLogin";
import AdminDashboard from "./screens/AdminDashboard";

import { useAuth } from "./context/AuthContext";

const App = () => {
  const { user, role } = useAuth(); // ✅ single source of truth

  return (
    <Router>
      <div className="min-h-screen bg-slate-50">
        {/* Navbar always visible */}
        <Navbar />

        <Routes>
          {/* ---------- HOME ---------- */}
          <Route
            path="/"
            element={
              role === "admin" ? (
                <Navigate to="/admin/dashboard" replace />
              ) : role === "pharmacist" ? (
                <Navigate to="/pharmacy-admin" replace />
              ) : role === "user" ? (
                <Navigate to="/userdashboard" replace />
              ) : (
                <Dashboard />
              )
            }
          />

          {/* ---------- PUBLIC ---------- */}
          <Route
            path="/login"
            element={role === "guest" ? <Login /> : <Navigate to="/" replace />}
          />

          {/* ---------- USER ---------- */}
          <Route
            path="/userdashboard"
            element={role === "user" ? <UserDashboard /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/profile"
            element={role === "user" ? <Profile /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/suraksha"
            element={role === "user" ? <Suraksha /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/raksha"
            element={role === "user" ? <Raksha /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/aushadhi"
            element={role === "user" ? <Aushadhi /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/doctor"
            element={role === "user" ? <Doctor /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/labtest"
            element={role === "user" ? <Labtest /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/healthassist"
            element={role === "user" ? <Healthassist /> : <Navigate to="/login" replace />}
          />

          {/* ---------- PHARMACIST ---------- */}
          <Route
            path="/pharmacist-login"
            element={role === "guest" ? <PharmacistLogin /> : <Navigate to="/" replace />}
          />
          <Route
            path="/pharmacy-admin"
            element={role === "pharmacist" ? <PharmacyAdmin /> : <Navigate to="/pharmacist-login" replace />}
          />

          {/* ---------- ADMIN ---------- */}
          <Route
            path="/admin/login"
            element={role === "guest" ? <AdminLogin /> : <Navigate to="/" replace />}
          />
          <Route
            path="/admin/dashboard"
            element={role === "admin" ? <AdminDashboard /> : <Navigate to="/admin/login" replace />}
          />

          {/* ---------- FALLBACK ---------- */}
          <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>
      </div>
    </Router>
  );
};

export default App;
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/Navbar.jsx">
import React, { useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { Menu, X } from "lucide-react";
import { useAuth } from "../context/AuthContext";
import { useEffect} from "react";


const Navbar = () => {
  const [isOpen, setIsOpen] = useState(false);
  const navigate = useNavigate();
  const { user, pharmacist, admin,logout } = useAuth();
  const [isDesktop, setIsDesktop] = useState(false);

  const isAdmin = !!localStorage.getItem("adminToken");
  const isPharmacist = !!localStorage.getItem("pharmacistToken");

  const handleLogout = () => {
    logout?.();

    navigate("/", { replace: true }); 
  };
  useEffect(() => {
  const checkScreen = () => {
    setIsDesktop(window.innerWidth >= 768); 
  };

  checkScreen();
  window.addEventListener("resize", checkScreen);
  return () => window.removeEventListener("resize", checkScreen);
}, []);

  // Common links based on role
  const guestLinks = (
    <Link to="/login" className="font-semibold block py-2">
      Login
    </Link>
  );

  const userLinks = (
    <>
      <Link to="/userdashboard" className="block py-2">
        Dashboard
      </Link>
      <Link to="/profile" className="block py-2">
        Profile
      </Link>
      <Link to="/aushadhi" className="block py-2">
        Aushadhi
      </Link>
      <Link to="/suraksha" className="block py-2">
        Suraksha
      </Link>
      <Link to="/raksha" className="block py-2">
        Raksha
      </Link>
      <button onClick={handleLogout} className="block py-2 text-left">
        Logout
      </button>
    </>
  );

  const pharmacistLinks = (
    <>
      {pharmacist && <Link to="/pharmacy-admin">Pharmacy Dashboard</Link>}

      <button onClick={handleLogout} className="block py-2 text-left">
        Logout
      </button>
    </>
  );

  const adminLinks = (
    <>
      {admin && <Link to="/admin/dashboard">Admin Dashboard</Link>}
      <button onClick={handleLogout} className="block py-2 text-left">
        Logout
      </button>
    </>
  );

  return (
    <nav className="bg-gray-300 p-4 shadow-md">
  <div className="max-w-7xl mx-auto flex justify-between items-center">
    <Link to="/" className="text-xl font-bold">
      Svasthya Hub
    </Link>

    {/* Menu Icon */}
    <div
      className="relative"
      onMouseEnter={isDesktop ? () => setIsOpen(true) : undefined}
      onMouseLeave={isDesktop ? () => setIsOpen(false) : undefined}
    >
      <button
        onClick={!isDesktop ? () => setIsOpen(!isOpen) : undefined}
      >
        {isOpen ? <X /> : <Menu />}
      </button>

      {/* Dropdown Menu */}
      {isOpen && (
        <div className="absolute right-0 mt-2 w-48 bg-teal-100 rounded shadow-lg p-4 z-50">
          {!user && !isAdmin && !isPharmacist && guestLinks}
          {user && userLinks}
          {isPharmacist && pharmacistLinks}
          {isAdmin && adminLinks}
        </div>
      )}
    </div>
  </div>
</nav>

  );
};

export default Navbar;
</file>

<file path="src/components/phoneMockup.jsx">
import React from "react";

const PhoneMockup = ({ children }) => {
  return (
    <div className="relative w-full max-w-sm h-[800px] mx-auto bg-white rounded-3xl shadow-2xl overflow-hidden">
      {children}
    </div>
  );
};

export default PhoneMockup;
</file>

<file path="src/context/AuthContext.jsx">
import { createContext, useContext, useEffect, useState } from "react";

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [role, setRole] = useState("guest"); // guest | user | pharmacist | admin

  // 🔄 Restore auth on refresh
  useEffect(() => {
    if (localStorage.getItem("adminToken")) {
      setRole("admin");
    } else if (localStorage.getItem("pharmacistToken")) {
      setRole("pharmacist");
    } else {
      const storedUser = JSON.parse(localStorage.getItem("user"));
      const token = localStorage.getItem("token");
      if (storedUser && token) {
        setUser({ ...storedUser, token });
        setRole("user");
      }
    }
  }, []);

  const loginUser = (userData, token) => {
    localStorage.setItem("user", JSON.stringify(userData));
    localStorage.setItem("token", token);
    setUser({ ...userData, token });
    setRole("user");
  };

  const loginPharmacist = (token) => {
    localStorage.setItem("pharmacistToken", token);
    setRole("pharmacist");
  };

  const loginAdmin = (token) => {
    localStorage.setItem("adminToken", token);
    setRole("admin");
  };

  const logout = () => {
    localStorage.clear();
    setUser(null);
    setRole("guest");
  };

  return (
    <AuthContext.Provider
      value={{
        user,
        role,
        loginUser,
        loginPharmacist,
        loginAdmin,
        logout,
      }}
    >
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
</file>

<file path="src/hooks/useSocket.js">
import { useEffect, useRef } from "react";
import { io } from "socket.io-client";


export default function useSocket(userId) {
  const socketRef = useRef(null);

  useEffect(() => {
    if (!userId) return;

    // Use VITE_API_URL environment variable or fallback to localhost
    const SOCKET_URL = import.meta.env.VITE_BACKEND_URL || "http://localhost:5000";
    const socket = io(SOCKET_URL, { autoConnect: false });

    socketRef.current = socket;

    // Manually connect after initialization
    socket.connect();

    socket.on('connect', () => {
      socket.emit('identify', { userId });
      console.log(`Socket connected with id ${socket.id}`);
    });

    // Optional: handle reconnect attempts
    socket.io.on('reconnect_attempt', () => {
      console.log('Attempting to reconnect to socket server...');
    });

    return () => {
      if (socketRef.current) {
        socketRef.current.disconnect();
        socketRef.current = null;
      }
    };
  }, [userId]);

  return socketRef;
}
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

/* .nav-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.6rem 0.75rem;
  border-radius: 0.75rem;
  font-weight: 600;
  color: #374151;
  transition: all 0.2s ease;
}

.nav-item span {
  display: none;
}

.group:hover .nav-item span {
  display: inline;
}

.nav-item:hover {
  background-color: rgba(13, 148, 136, 0.2);
} */
</file>

<file path="src/layout/Layout.jsx">
// import { Outlet } from "react-router-dom";
// import Navbar from "../components/Navbar";

// const Layout = () => {
//   return (
//     <div className="flex">
//       {/* Sidebar */}
//       <Navbar />

//       {/* Page Content */}
//       <main className="ml-16 hover:ml-64 transition-all duration-300 w-full p-4">
//         <Outlet />
//       </main>
//     </div>
//   );
// };

// export default Layout;
</file>

<file path="src/main.jsx">
import React from "react";
import ReactDOM from "react-dom/client";
import App from "./App";
import "./index.css";
import { AuthProvider } from "./context/AuthContext";


ReactDOM.createRoot(document.getElementById("root")).render(
  <React.StrictMode>
    <AuthProvider>
      <App />
    </AuthProvider>
  </React.StrictMode>
);
</file>

<file path="src/screens/AdminDashboard.jsx">
import { useEffect, useState } from "react";
import axios from "axios";

export default function AdminDashboard() {
  const [users, setUsers] = useState([]);
  const [requests, setRequests] = useState([]);
  const [pharmacists, setPharmacists] = useState([]);

  const [newAdmin, setNewAdmin] = useState({ email: "", password: "" });
  const [newPharmacist, setNewPharmacist] = useState({
    name: "",
    email: "",
    password: "",
  });

  useEffect(() => {
    fetchAll();
  }, []);

  const fetchAll = async () => {
    const token = localStorage.getItem("adminToken");
    if (!token) {
      window.location.href = "/admin/login";
      return;
    }

    const headers = { Authorization: `Bearer ${token}` };

    try {
      const [u, r, p] = await Promise.all([
        axios.get(`${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/users`, {
          headers,
        }),
        axios.get(
          `${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/requests`,
          { headers }
        ),
        axios.get(
          `${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/pharmacists`,
          { headers }
        ),
      ]);

      setUsers(u.data);
      setRequests(r.data);
      setPharmacists(p.data);
    } catch (err) {
      console.error(err);
      localStorage.removeItem("adminToken");
      window.location.href = "/admin/login";
    }
  };

 
  // 🔐 Create Admin (NO TOKEN REQUIRED)
  const createAdmin = async (e) => {
    e.preventDefault();
    try {
      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/admin/register`,
        {
          email: newAdmin.email,
          password: newAdmin.password,
        }
      );

      alert("Admin created");
      setNewAdmin({ email: "", password: "" });
    } catch (err) {
      console.error("Create admin error:", err.response?.data || err.message);
      alert(err.response?.data?.message || "Failed to create admin");
    }
  };

  // 💊 Create Pharmacist
  const createPharmacist = async (e) => {
    e.preventDefault();
    const token = localStorage.getItem("adminToken");

    try {
      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/admin-panel/pharmacist`,
        newPharmacist,
        {
          headers: { Authorization: `Bearer ${token}` },
        }
      );

      alert("Pharmacist created");
      setNewPharmacist({ name: "", email: "", password: "" });
      fetchAll();
    } catch (err) {
      alert(err.response?.data?.message || "Failed to create pharmacist");
    }
  };

  return (
  <div className="p-4 sm:p-6 lg:p-8 bg-gray-100 min-h-screen">
    <h1 className="text-2xl sm:text-3xl font-bold mb-6 sm:mb-8">
      Admin Dashboard
    </h1>

    {/* 📊 Summary */}
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-8 sm:mb-10">
      <StatCard title="Users" count={users.length} />
      <StatCard title="Blood Requests" count={requests.length} />
      <StatCard title="Pharmacists" count={pharmacists.length} />
    </div>

    {/* ➕ Create Section */}
    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 mb-10 sm:mb-12">
      <FormCard title="Create Admin" onSubmit={createAdmin}>
        <Input
          placeholder="Email"
          value={newAdmin.email}
          onChange={(e) =>
            setNewAdmin({ ...newAdmin, email: e.target.value })
          }
        />
        <Input
          placeholder="Password"
          type="password"
          value={newAdmin.password}
          onChange={(e) =>
            setNewAdmin({ ...newAdmin, password: e.target.value })
          }
        />
      </FormCard>

      <FormCard title="Create Pharmacist" onSubmit={createPharmacist}>
        <Input
          placeholder="Name"
          value={newPharmacist.name}
          onChange={(e) =>
            setNewPharmacist({ ...newPharmacist, name: e.target.value })
          }
        />
        <Input
          placeholder="Email"
          value={newPharmacist.email}
          onChange={(e) =>
            setNewPharmacist({ ...newPharmacist, email: e.target.value })
          }
        />
        <Input
          placeholder="Password"
          type="password"
          value={newPharmacist.password}
          onChange={(e) =>
            setNewPharmacist({ ...newPharmacist, password: e.target.value })
          }
        />
      </FormCard>
    </div>

    {/* 📋 Tables */}
    <ResponsiveTable title="Registered Users" headers={["Name", "Email"]}>
      {users.map((u) => (
        <tr key={u._id}>
          <td className="p-3">{u.name}</td>
          <td className="p-3">{u.email}</td>
        </tr>
      ))}
    </ResponsiveTable>

    <ResponsiveTable title="Blood Requests" headers={["Blood Group", "Status"]}>
      {requests.map((r) => (
        <tr key={r._id}>
          <td className="p-3">{r.group}</td>
          <td className="p-3">{r.status}</td>
        </tr>
      ))}
    </ResponsiveTable>

    <ResponsiveTable title="Pharmacists" headers={["Name", "Email"]}>
      {pharmacists.map((p) => (
        <tr key={p._id}>
          <td className="p-3">{p.name}</td>
          <td className="p-3">{p.email}</td>
        </tr>
      ))}
    </ResponsiveTable>
  </div>
  );
}

/* ------------------ UI Components ------------------ */
const StatCard = ({ title, count }) => (
  <div className="bg-white p-4 sm:p-6 rounded-xl shadow">
    <h3 className="text-gray-500 text-sm sm:text-base">{title}</h3>
    <p className="text-2xl sm:text-3xl font-bold">{count}</p>
  </div>
);

const FormCard = ({ title, children, onSubmit }) => (
  <form
    onSubmit={onSubmit}
    className="bg-white p-4 sm:p-6 rounded-xl shadow space-y-4"
  >
    <h2 className="text-lg sm:text-xl font-semibold">{title}</h2>
    {children}
    <button className="w-full sm:w-auto bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition">
      Create
    </button>
  </form>
);

const Input = (props) => (
  <input
    {...props}
    className="border w-full p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
    required
  />
);

const ResponsiveTable = ({ title, headers, children }) => (
  <div className="bg-white rounded-xl shadow mb-8 sm:mb-10">
    <h2 className="text-lg sm:text-xl font-semibold p-4">{title}</h2>
    <div className="overflow-x-auto">
      <table className="min-w-full border-t">
        <thead className="bg-gray-200">
          <tr>
            {headers.map((h) => (
              <th key={h} className="text-left p-3 text-sm sm:text-base">
                {h}
              </th>
            ))}
          </tr>
        </thead>
        <tbody className="divide-y text-sm sm:text-base">
          {children}
        </tbody>
      </table>
    </div>
  </div>
);
</file>

<file path="src/screens/AdminLogin.jsx">
import { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../context/AuthContext";
import { Eye, EyeOff } from "lucide-react";

export default function AdminLogin() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [loading, setLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(true);

  const navigate = useNavigate();
  const { loginAdmin } = useAuth();

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      const res = await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/admin/login`,
        { email, password }
      );

      loginAdmin(res.data.token); // ✅ React state updated

      navigate("/admin/dashboard", { replace: true });
    } catch {
      alert("Invalid credentials");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex h-screen justify-center items-center bg-gray-100">
  <form
    onSubmit={handleLogin}
    className="bg-white p-8 rounded-2xl shadow-md w-96"
  >
    <h2 className="text-2xl font-bold mb-6 text-center">Admin Login</h2>

    <input
      type="email"
      className="border w-full p-2 mb-4 rounded"
      placeholder="Email"
      onChange={(e) => setEmail(e.target.value)}
      required
    />

    {/* ✅ PASSWORD + EYE WRAPPER */}
    <div className="relative mb-4">
      <input
        type={showPassword ? "password" : "text"}
        className="w-full p-2 pr-10 border rounded"
        placeholder="Password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        required
      />

      <button
        type="button"
        onClick={() => setShowPassword((p) => !p)}
        className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
      >
        {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
      </button>
    </div>

    <button
      type="submit"
      disabled={loading}
      className="bg-blue-500 text-white w-full py-2 rounded disabled:opacity-50"
    >
      {loading ? "Logging in..." : "Login"}
    </button>
  </form>
</div>

  );
}
</file>

<file path="src/screens/AI.jsx">
// src/screens/AIHealthAssist.jsx
import React, { useState } from "react";

const AIHealthAssist = () => {
  // Sample AI health assist data
  const assists = [
    { name: "Fever Diagnosis", category: "Symptom Checker", description: "Get AI-based suggestions for fever causes." },
    { name: "Diabetes Risk", category: "Health Risk", description: "AI analysis of diabetes risk based on symptoms." },
    { name: "Heart Health", category: "Cardiology", description: "AI insights for heart disease risk and prevention." },
    { name: "Skin Check", category: "Dermatology", description: "Upload symptoms to get AI skin health analysis." },
    { name: "Mental Wellness", category: "Psychology", description: "AI chatbot for stress, anxiety & depression support." },
    { name: "Diet Planner", category: "Nutrition", description: "Personalized AI diet recommendations." },
  ];

  const [searchTerm, setSearchTerm] = useState("");

  // Filter by name or category
  const filteredAssists = assists.filter(
    (assist) =>
      assist.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      assist.category.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-50 to-gray-50 p-6">
      <h1 className="text-4xl font-extrabold text-gray-900 mb-8 text-center">
        AI <span className="text-green-600">Health Assist</span>
      </h1>

      {/* Search Bar */}
      <div className="mb-10 max-w-lg mx-auto">
        <input
          type="text"
          placeholder="🔍 Search by assist name or category..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* AI Assists Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
        {filteredAssists.length > 0 ? (
          filteredAssists.map((assist, index) => (
            <div
              key={index}
              className="bg-white shadow-md rounded-xl p-6 hover:shadow-2xl hover:scale-105 transform transition duration-200 cursor-pointer"
            >
              <h2 className="text-xl font-bold text-green-700">{assist.name}</h2>
              <p className="text-sm text-gray-600 mt-1">Category: {assist.category}</p>
              <p className="text-sm text-gray-600 mt-2">{assist.description}</p>
              <button className="mt-4 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition">
                Try Now
              </button>
            </div>
          ))
        ) : (
          <p className="text-gray-500 text-center text-lg col-span-full">
            ❌ No AI assists found.
          </p>
        )}
      </div>
    </div>
  );
};

export default AIHealthAssist;
</file>

<file path="src/screens/Aushadhi.jsx">
import React, { useState, useEffect } from "react";
import axios from "axios";
import { useAuth } from "../context/AuthContext";
import useSocket from "../hooks/useSocket";

const Aushadhi = () => {
  const { user } = useAuth();
  const token = localStorage.getItem("token");

  const [prescription, setPrescription] = useState(null);
  const [uploadStatus, setUploadStatus] = useState("");
  const [searchTerm, setSearchTerm] = useState("");
  const [prescriptions, setPrescriptions] = useState([]);
  const [selectedMedicines, setSelectedMedicines] = useState([]); // ✅ new state
  const [isUploading, setIsUploading] = useState(false);

  // Setup real-time socket connection for user notifications
  const socket = useSocket(user?.email);

  // Fetch prescriptions on mount and whenever user changes
  useEffect(() => {
    if (!user || !user.token) return;
    axios
      .get(`${import.meta.env.VITE_BACKEND_URL}/api/prescriptions`, {
        headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
      })
      .then((res) => {
        setPrescriptions(res.data);
      })
      .catch((err) => {
        console.error(err);
      });
  }, [user]);

  useEffect(() => {
    if (!socket?.current) return;

    const currentSocket = socket.current;

    currentSocket.on("prescriptionConfirmed", (data) => {
      alert(data.message);
      setPrescriptions((prev) =>
        prev.map((p) =>
          p._id === data.prescriptionId
            ? {
                ...p,
                status: "confirmed",
                confirmation: {
                  allPresent: data.allPresent,
                  medicines: data.medicines || [],
                },
              }
            : p
        )
      );
    });

    return () => {
      if (currentSocket) {
        currentSocket.off("prescriptionConfirmed");
      }
    };
  }, [socket, user]);

  // Upload prescription file
  const handleFileChange = (e) => {
    setPrescription(e.target.files[0]);
    setUploadStatus("");
  };

  const handleUpload = async () => {
    if (!prescription) return alert("Please select a prescription.");
    if (!user) return alert("User not logged in.");

    const formData = new FormData();
    formData.append("file", prescription);
    formData.append("userName", user.name);
    formData.append("userEmail", user.email);

    try {
      setIsUploading(true); //  disable button
      setUploadStatus("Uploading...");

      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions`,
        formData,
        {
          headers: {
            Authorization: `Bearer ${user.token}`, //  important for prod
          },
        }
      );

      setUploadStatus("Uploaded successfully!");
      setPrescription(null);
    } catch (err) {
      console.error(err);
      setUploadStatus("Upload failed.");
    } finally {
      setIsUploading(false); // 🔓 enable button again
    }
  };

  // Static medicines (for now)
  const medicines = [
    {
      name: "Paracetamol",
      dosage: "500mg",
      steps: "Take 1 tablet every 6 hours after food",
    },
    {
      name: "Amoxicillin",
      dosage: "250mg",
      steps: "Take 1 capsule every 8 hours for 5 days",
    },
    {
      name: "Vitamin C",
      dosage: "500mg",
      steps: "Take 1 tablet daily after breakfast",
    },
    {
      name: "Vitamin D",
      dosage: "400mg",
      steps: "Take 1 tablet every 8 hours if pain persists",
    },
    {
      name: "Combiflame",
      dosage: "400mg",
      steps: "Take 1 tablet every 8 hours if pain persists",
    },
    {
      name: "Ciplox eye drops",
      dosage: "Apply 2 drops",
      steps: "Apply 2 drops twice daily",
    },
  ];

  const filteredMedicines = medicines.filter((medicine) =>
    medicine.name.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // ✅ Handle selecting medicine
  const toggleSelectMedicine = (medicineName) => {
    setSelectedMedicines((prev) =>
      prev.includes(medicineName)
        ? prev.filter((m) => m !== medicineName)
        : [...prev, medicineName]
    );
  };

  // ✅ Handle submitting selected medicines
  const handleManualSubmit = async () => {
    if (selectedMedicines.length === 0) {
      return alert("Please select at least one medicine.");
    }

    try {
      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/manual`,
        {
          medicines: selectedMedicines,
          userEmail: user.email,
          userName: user.name,
        },
        {
          headers: { Authorization: `Bearer ${user.token}` },
        }
      );
      console.log("🔑 Current user token:", user?.token);
      alert("✅ Medicine request submitted successfully!");
      setSelectedMedicines([]);
    } catch (err) {
      console.error(err);
      alert("❌ Failed to submit manual request.");
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-teal-50 to-gray-50 px-2 py-4 sm:px-6 md:px-10 lg:px-20 overflow-y-auto">
      {/* HEADER */}
      <div className="flex flex-col sm:flex-row justify-between items-center mb-5 gap-3 sm:gap-0">
        <h1 className="text-2xl sm:text-3xl md:text-4xl font-extrabold text-gray-900 text-center flex-1 break-words">
          Svasthya <span className="text-teal-600">Aushadhi</span>
        </h1>

        {/* Upload Section */}
        <div className="flex flex-col sm:flex-row items-center gap-2">
          <label
            htmlFor="prescription-upload"
            className="cursor-pointer bg-white border border-gray-300 rounded px-4 py-2 shadow-sm hover:bg-gray-100"
          >
            {prescription ? prescription.name : "Select Prescription"}
            <input
              id="prescription-upload"
              type="file"
              accept="image/*"
              onChange={handleFileChange}
              className="hidden"
            />
          </label>
          <button
            onClick={handleUpload}
            disabled={!prescription || isUploading}
            className={`bg-teal-500 text-white px-3 py-1 rounded 
    ${isUploading ? "opacity-50 cursor-not-allowed" : "hover:bg-teal-600"}
  `}
          >
            {isUploading ? "Uploading..." : "Upload"}
          </button>
        </div>
      </div>

      {/* Upload Status */}
      {uploadStatus && (
        <p
          className={`text-center mb-4 font-semibold ${
            uploadStatus.includes("success") ? "text-green-600" : "text-red-600"
          }`}
        >
          {uploadStatus}
        </p>
      )}

      {/* SEARCH BAR */}
      <div className="mb-6 max-w-lg mx-auto">
        <input
          type="text"
          aria-label="Search medicine"
          placeholder="Search medicine..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* MEDICINE LIST */}
      <div className="grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        {filteredMedicines.length > 0 ? (
          filteredMedicines.map((medicine, index) => {
            const selected = selectedMedicines.includes(medicine.name);
            return (
              <div
                key={index}
                onClick={() => toggleSelectMedicine(medicine.name)}
                className={`cursor-pointer bg-white shadow-md rounded-xl p-4 sm:p-6 flex flex-col justify-between hover:shadow-2xl h-full transition-all ${
                  selected ? "ring-4 ring-teal-500" : ""
                }`}
              >
                <h2 className="text-lg sm:text-xl md:text-2xl font-bold text-teal-700">
                  {medicine.name}
                </h2>
                <p className="text-xs sm:text-sm text-gray-500 mt-2">
                  {medicine.dosage}
                </p>
                <p className="text-xs sm:text-sm text-gray-700 mt-3">
                  {medicine.steps}
                </p>
              </div>
            );
          })
        ) : (
          <p className="col-span-full text-center text-gray-500">
            No medicines found.
          </p>
        )}
      </div>

      {/* ✅ Submit Selected Medicines */}
      {selectedMedicines.length > 0 && (
        <div className="mt-6 text-center">
          <p className="text-gray-700 mb-3">
            Selected Medicines:{" "}
            <span className="font-semibold text-teal-700">
              {selectedMedicines.join(", ")}
            </span>
          </p>
          <button
            onClick={handleManualSubmit}
            className="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700"
          >
            Submit Selected Medicines
          </button>
        </div>
      )}

      {/* CONFIRMATION SECTION */}
      <div className="mt-10 max-w-3xl mx-auto">
  <h2 className="text-xl font-semibold mb-3">
    Prescription Confirmations
  </h2>

  {prescriptions.length === 0 && <p>No prescriptions found.</p>}

  {prescriptions.map((p) =>
    p.confirmation ? (
      <div key={p._id} className="bg-green-100 p-4 rounded mb-4">
        <p>
          <strong>Status:</strong> Confirmed
        </p>

        {p.confirmation.allPresent ? (
          <p>
            <strong>All Medicines Present:</strong> Yes
          </p>
        ) : (
          <>
            <p>
              <strong>All Medicines Present:</strong> No
            </p>

            {p.confirmation.medicines &&
              p.confirmation.medicines.length > 0 && (
                <ul className="list-disc list-inside ml-4">
                  {p.confirmation.medicines.map((m, idx) => (
                    <li key={idx}>{m}</li>
                  ))}
                </ul>
              )}
          </>
        )}
      </div>
    ) : null
  )}
</div>

    </div>
  );
};

export default Aushadhi;
</file>

<file path="src/screens/Auth.jsx">
import React, { useState } from "react";
import api from "../services/api";
import { useAuth } from "../context/AuthContext";

const Auth = () => {
  const [mode, setMode] = useState("login"); // 'login' or 'register'
  const [form, setForm] = useState({
    email: "",
    phone: "",
    password: "",
    name: "",
    bloodGroup: "",
    age: "",
  });
  const { login } = useAuth();

  const submit = async () => {
    try {
      // validation
      if ((!form.email && !form.phone) || !form.password) {
        alert("Please provide either Email or Phone and Password!");
        return;
      }

      if (
        mode === "register" &&
        (!form.name || !form.bloodGroup || !form.age)
      ) {
        alert("Please fill all required registration fields!");
        return;
      }

      // ✅ Payload banate waqt sirf filled fields bhejo
      let payload = { password: form.password };

      if (form.email) payload.email = form.email;
      if (form.phone) payload.phone = form.phone;

      if (mode === "register") {
        payload.name = form.name;
        payload.bloodGroup = form.bloodGroup;
        payload.age = form.age;
      }

      const { data } = await api.post(
        mode === "login" ? "/auth/login" : "/auth/register",
        payload
      );

      login(data.user, data.token);

      if (mode === "register") {
        alert("Registration successful! You are now logged in.");
      }
    } catch (err) {
      alert(err.response?.data?.error || "Error");
    }
  };

  return (
    <div className="max-w-md mx-auto p-6 bg-white rounded shadow">
      <h2 className="text-2xl font-bold mb-4 text-center">
        {mode === "login" ? "Login" : "Register"}
      </h2>

      {/* Email & Phone (optional, but at least one required) */}
        <input
        placeholder="Email (optional if using phone)"
        onChange={e => setForm({ ...form, email: e.target.value })}
        className="w-full p-2 border mb-2"
      />
      <input
        placeholder="Phone (optional if using email)"
        onChange={e => setForm({ ...form, phone: e.target.value })}
        className="w-full p-2 border mb-2"
/>

      {/* Password */}
      <input
        placeholder="Password"
        type="password"
        value={form.password}
        onChange={(e) => setForm({ ...form, password: e.target.value })}
        className="w-full p-2 border mb-2 rounded"
      />

      {/* Extra fields for registration */}
      {mode === "register" && (
        <>
          <input
            placeholder="Full Name"
            value={form.name}
            onChange={(e) => setForm({ ...form, name: e.target.value })}
            className="w-full p-2 border mb-2 rounded"
          />
          <input
            placeholder="Blood Group"
            value={form.bloodGroup}
            onChange={(e) =>
              setForm({ ...form, bloodGroup: e.target.value })
            }
            className="w-full p-2 border mb-2 rounded"
          />
          <input
            placeholder="Age"
            type="number"
            value={form.age}
            onChange={(e) => setForm({ ...form, age: e.target.value })}
            className="w-full p-2 border mb-2 rounded"
          />
        </>
      )}

      {/* Submit button */}
      <button
        onClick={submit}
        className="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
      >
        {mode === "login" ? "Login" : "Register"}
      </button>

      {/* Switch mode */}
      <div className="mt-3 text-center">
        <button
          onClick={() =>
            setMode(mode === "login" ? "register" : "login")
          }
          className="text-sm text-blue-600 underline"
        >
          {mode === "login"
            ? "Don't have an account? Register"
            : "Already have an account? Login"}
        </button>
      </div>
    </div>
  );
};

export default Auth;
</file>

<file path="src/screens/Cart.jsx">
import React from "react";

const Cart = ({ onBack, onCheckout }) => {
  return (
    <div className="absolute inset-0 bg-gray-50 overflow-y-auto">
      <div className="p-4 bg-gray-800 text-white flex justify-between items-center sticky top-0">
        <button onClick={onBack}>←</button>
        <h1 className="font-bold">My Cart</h1>
        <div className="w-10" />
      </div>
      <div className="p-4">
        <div className="bg-white p-3 rounded-lg">Dolo 650mg - ₹30.90</div>
        <div className="bg-white p-3 rounded-lg mt-2">Vicks Vaporub - ₹140</div>
        <button
          onClick={onCheckout}
          className="mt-6 w-full bg-teal-600 text-white py-3 rounded-lg"
        >
          Proceed to Checkout
        </button>
      </div>
    </div>
  );
};

export default Cart;
</file>

<file path="src/screens/Checkout.jsx">
import React from "react";

const Checkout = ({ onBack, onSuccess }) => {
  return (
    <div className="absolute inset-0 bg-gray-50 overflow-y-auto">
      <div className="p-4 bg-gray-800 text-white flex justify-between items-center sticky top-0">
        <button onClick={onBack}>←</button>
        <h1 className="font-bold">Checkout</h1>
        <div className="w-10" />
      </div>

      <div className="p-4">
        <div className="bg-white p-4 rounded-lg shadow mb-4">
          <h2 className="font-semibold text-gray-700">Shipping Address</h2>
          <p className="text-sm text-gray-600">123, MG Road, Bangalore</p>
        </div>

        <div className="bg-white p-4 rounded-lg shadow mb-4">
          <h2 className="font-semibold text-gray-700">Payment Method</h2>
          <p className="text-sm text-gray-600">UPI (PhonePe)</p>
        </div>

        <div className="bg-white p-4 rounded-lg shadow">
          <h2 className="font-semibold text-gray-700">Order Summary</h2>
          <p className="text-sm text-gray-600">2 items</p>
          <p className="font-bold mt-2">₹170.90</p>
        </div>

        <button
          onClick={onSuccess}
          className="mt-6 w-full bg-teal-600 text-white py-3 rounded-lg hover:bg-teal-700 transition"
        >
          Place Order
        </button>
      </div>
    </div>
  );
};

export default Checkout;
</file>

<file path="src/screens/Dashboard.jsx">
import React from "react";
import {
  Stethoscope,
  HeartPulse,
  ShieldCheck,
  UserCheck,
  HeartHandshake,
  Droplet,
  UserPlus,
  Activity,
  Heart,
  Mail,
  Phone,
  MapPin
} from "lucide-react";

/* ================= CONTENT ================= */

const content = {
  hero: {
    badge: "Elevating Patient Care Through Clinical Expertise",
    title: "Expert PharmD Care for Superior Patient Outcomes",
    description:
      "Experience the difference of a healthcare platform built on PharmD principles. We bridge the gap between diagnosis and recovery with precise medication therapy management and dedicated patient advocacy.",
    ctaPrimary: "Consult a PharmD",
    ctaSecondary: "Our Care Model",
    image: "https://images.unsplash.com/photo-1631815589968-fdb09a223b1e"
  },
  features: {
    title: "Advanced Clinical Care for Every Patient",
    description:
      "Our PharmD-led approach redefines healthcare delivery, prioritizing safety, efficacy, and compassionate support.",
    items: [
      {
        title: "Patient-First Medication Review",
        description:
          "Every prescription is clinically reviewed to prevent interactions."
      },
      {
        title: "Therapeutic Outcome Monitoring",
        description:
          "Continuous tracking and optimization of therapy outcomes."
      },
      {
        title: "Collaborative Care Ecosystem",
        description:
          "Pharmacists, doctors, and caregivers working together."
      },
      {
        title: "Donor Assurance Program",
        description:
          "Guaranteed priority access to blood units for donors."
      }
    ]
  },
  about: {
    title: "Founded on Clinical Excellence",
    description1:
      "Svasthya Hubis a PharmD-led initiative focused on patient-first healthcare.",
    description2:
      "We ensure every medication decision is evidence-based and personalized.",
    image: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d",
    items: [
      { title: "Patient Advocacy", description: "Your health comes first." },
      { title: "Optimized Outcomes", description: "Better recovery, fewer risks." },
      { title: "Life-Saving Assurance", description: "Care when it matters most." }
    ]
  },
  footer: {
    brandName: "Svasthya Hub",
    description:
      "India’s pioneering PharmD-led clinical pharmacy network.",
    quickLinks: ["Privacy Policy", "FAQs", "Partner Login", "Terms of Service"],
    services: [
      "Clinical Pharmacy",
      "Medication Therapy",
      "Health Consultations",
      "Partner Programs"
    ],
    copyright:
      `© ${new Date().getFullYear()} Svasthya Hub. All rights reserved.`
  }
};

/* ================= PAGE ================= */

export default function Dashboard() {
  return (
    <div className="min-h-screen bg-white">
      {/* <Header/> */}
      <Hero />
      <Features />
      <About />
       <Trust />
      <Footer />
    </div>
  );
}

/* ================= HEADER ================= */

const Header = () => (
  <header className="sticky top-0 z-50 bg-white border-b">
    <div className="max-w-7xl mx-auto h-20 px-6 flex items-center justify-between">
      
      {/* Logo */}
      <div className="flex items-center gap-3">
        <div className="w-11 h-11 bg-[#0369a1] rounded-xl flex items-center justify-center">
          <Stethoscope className="text-white" />
        </div>
        <span className="text-xl font-bold text-[#0369a1]">
          Svasthya Hub
        </span>
      </div>

      {/* Navigation */}
      <nav className="hidden md:flex items-center gap-8">
        <a
          href="#features"
          className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
        >
          Features
        </a>
        <a
          href="#about"
          className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
        >
          About Us
        </a>
        <a
          href="#partners"
          className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
        >
          Partners
        </a>
        <a
          href="#contact"
          className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
        >
          Contact
        </a>
      </nav>

      {/* CTA */}
      <div className="hidden md:block">
        <button className="bg-[#0369a1] text-white px-6 py-2 rounded-md font-medium hover:bg-[#035f8f] transition">
          Consult a PharmD
        </button>
      </div>

    </div>
  </header>
);


/* ================= HERO ================= */

const Hero = () => (
  <section className="bg-gradient-to-br from-indigo-50 to-blue-50 py-28">
    <div className="max-w-7xl mx-auto grid lg:grid-cols-2 gap-12 px-6 items-center">
      <div>
        <span className="inline-flex gap-2 bg-indigo-100 px-4 py-2 rounded-full text-sm font-semibold text-[#0369a1]">
          <HeartPulse className="w-4 h-4" />
          {content.hero.badge}
        </span>

        <h1 className="mt-6 text-5xl font-bold text-gray-900">
          {content.hero.title}
        </h1>

        <p className="mt-6 text-lg text-gray-600">
          {content.hero.description}
        </p>

        <div className="mt-8 flex gap-4">
          <button className="px-8 py-3 bg-[#0369a1] text-white rounded-lg font-semibold">
            {content.hero.ctaPrimary}
          </button>
          <button className="px-8 py-3 border border-[#0369a1] text-[#0369a1] rounded-lg font-semibold">
            {content.hero.ctaSecondary}
          </button>
        </div>
      </div>

      <img
        src={content.hero.image}
        className="rounded-2xl shadow-xl"
      />
    </div>
  </section>
);

/* ================= FEATURES ================= */

const FEATURE_ICONS = [UserCheck, ShieldCheck, HeartHandshake, Droplet];

const Features = () => (
  <section className="py-24 bg-white">
    <div className="max-w-7xl mx-auto px-6">
      <h2 className="text-4xl font-bold text-center">
        {content.features.title}
      </h2>
      <p className="mt-4 text-gray-600 text-center max-w-2xl mx-auto">
        {content.features.description}
      </p>

      <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mt-16">
        {content.features.items.map((item, i) => {
          const Icon = FEATURE_ICONS[i];
          return (
            <div key={i} className="p-6 rounded-2xl border shadow hover:shadow-xl">
              <Icon className="w-7 h-7 text-[#0369a1]" />
              <h3 className="mt-4 text-xl font-semibold">{item.title}</h3>
              <p className="mt-2 text-gray-600">{item.description}</p>
            </div>
          );
        })}
      </div>
    </div>
  </section>
);

/* ================= ABOUT ================= */

const ABOUT_ICONS = [UserPlus, Activity, Heart];

const About = () => (
  <section className="py-24 bg-gradient-to-br from-indigo-50 to-blue-50">
    <div className="max-w-7xl mx-auto grid lg:grid-cols-2 gap-16 px-6">
      <img src={content.about.image} className="rounded-2xl shadow-xl" />

      <div>
        <h2 className="text-4xl font-bold">{content.about.title}</h2>
        <p className="mt-4 text-gray-600">{content.about.description1}</p>
        <p className="mt-4 text-gray-600">{content.about.description2}</p>

        <div className="mt-8 space-y-4">
          {content.about.items.map((item, i) => {
            const Icon = ABOUT_ICONS[i];
            return (
              <div key={i} className="flex gap-4">
                <Icon className="text-[#0369a1]" />
                <div>
                  <h4 className="font-semibold">{item.title}</h4>
                  <p className="text-gray-600">{item.description}</p>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  </section>
);
/* ================= PARTNERS / TRUST ================= */

const Trust = () => (
  <section className="py-24 bg-white">
    <div className="max-w-7xl mx-auto px-6 text-center">
      
      <h2 className="text-5xl font-bold text-gray-900">
        Trusted by Leaders in Healthcare
      </h2>

      <p className="mt-4 text-gray-600 max-w-2xl mx-auto">
        Our commitment to patient safety and clinical excellence is recognized
        by premier institutions and regulatory bodies.
      </p>

      <div className="grid md:grid-cols-3 gap-8 mt-16">
        <div className="p-6 border rounded-2xl shadow hover:shadow-xl transition  bg-gradient-to-br from-indigo-50 to-blue-50">
          <h4 className="text-2xl font-semibold">NIMS University</h4>
          <p className="mt-2 text-gray-600">Clinical Research & Education</p>
        </div>

        <div className="p-6 border rounded-2xl shadow hover:shadow-xl transition bg-gradient-to-br from-indigo-50 to-blue-50">
          <h4 className="text-2xl font-semibold">Startup India</h4>
          <p className="mt-2 text-gray-600">Recognized Healthcare Innovation</p>
        </div>

        <div className="p-6 border rounded-2xl shadow hover:shadow-xl transition bg-gradient-to-br from-indigo-50 to-blue-50">
          <h4 className="text-2xl font-semibold">WHO-GMP Standard</h4>
          <p className="mt-2 text-gray-600">Ensuring Therapeutic Quality</p>
        </div>
      </div>

      {/* CTA BANNER */}
      <div className="mt-20 bg-gradient-to-r from-[#0369a1] to-indigo-600 rounded-2xl p-12 text-white">
        <h3 className="text-3xl font-bold">
          Join Our Patient-Centric Care Network
        </h3>
        <p className="mt-4 max-w-2xl mx-auto opacity-90">
          Whether you are a patient seeking better outcomes or a healthcare
          professional dedicated to clinical excellence, Svasthya hub is your
          partner in health.
        </p>

        <div className="mt-8 flex justify-center gap-4">
          <button className="bg-white text-[#0369a1] px-8 py-3 rounded-lg font-semibold">
            Find a Specialist
          </button>
          <button className="border border-white px-8 py-3 rounded-lg font-semibold">
            For Healthcare Providers
          </button>
        </div>
      </div>
    </div>
  </section>
);


/* ================= FOOTER (FIXED) ================= */

const Footer = () => (
  <footer className="bg-gray-900 text-white pt-16 pb-8">
    <div className="max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-12">
      
      {/* BRAND */}
      <div>
        <h3 className="text-xl font-bold">{content.footer.brandName}</h3>
        <p className="mt-4 text-gray-400">{content.footer.description}</p>
      </div>

      {/* QUICK LINKS */}
      <div>
        <h4 className="font-semibold mb-4">Quick Links</h4>
        <ul className="space-y-2 text-gray-400">
          {content.footer.quickLinks.map((link, i) => (
            <li key={i} className="hover:text-white cursor-pointer">
              {link}
            </li>
          ))}
        </ul>
      </div>

      {/* SERVICES */}
      <div>
        <h4 className="font-semibold mb-4">Services</h4>
        <ul className="space-y-2 text-gray-400">
          {content.footer.services.map((service, i) => (
            <li key={i} className="hover:text-white cursor-pointer">
              {service}
            </li>
          ))}
        </ul>
      </div>

      {/* CONTACT */}
      <div className="space-y-3 text-gray-400">
        <div className="flex gap-2"><Mail /> <a href="mailto:hudsvasthya@gmail.com">hubsvasthya@gmail.com</a></div>
        <div className="flex gap-2"><Phone /> <a href="tel:+91 9523443854">+91 9523443854</a></div>
        <div className="flex gap-2"><MapPin />Jaipur, Rajasthan, India</div>
      </div>

    </div>

    <p className="mt-12 text-center text-gray-500">
      {content.footer.copyright}
    </p>
  </footer>
);
</file>

<file path="src/screens/Doctor.jsx">
// src/screens/Doctor.jsx
import React, { useState } from "react";

const Doctor = () => {
  // Sample doctors data
  const doctors = [
    { name: "Dr. Ramesh Kumar", specialization: "Cardiologist", experience: "10 years" },
    { name: "Dr. Priya Sharma", specialization: "Dermatologist", experience: "7 years" },
    { name: "Dr. Anil Verma", specialization: "Pediatrician", experience: "12 years" },
    { name: "Dr. Kavita Singh", specialization: "Gynecologist", experience: "9 years" },
    { name: "Dr. Arjun Mehta", specialization: "Orthopedic", experience: "8 years" },
    { name: "Dr. Neha Gupta", specialization: "Neurologist", experience: "6 years" },
  ];

  const [searchTerm, setSearchTerm] = useState("");

  // Filter by name or specialization
  const filteredDoctors = doctors.filter(
    (doctor) =>
      doctor.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      doctor.specialization.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-gray-50 p-6">
      <h1 className="text-4xl font-extrabold text-gray-900 mb-8 text-center">
        Find Your <span className="text-indigo-600">Doctor</span>
      </h1>

      {/* Search Bar */}
      <div className="mb-10 max-w-lg mx-auto">
        <input
          type="text"
          placeholder="🔍 Search by name or specialization..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* Doctors Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
        {filteredDoctors.length > 0 ? (
          filteredDoctors.map((doctor, index) => (
            <div
              key={index}
              className="bg-white shadow-md rounded-xl p-6 hover:shadow-2xl hover:scale-105 transform transition duration-200 cursor-pointer"
            >
              <h2 className="text-xl font-bold text-indigo-700">{doctor.name}</h2>
              <p className="text-sm text-gray-600 mt-1">Specialization: {doctor.specialization}</p>
              <p className="text-sm text-gray-600 mt-1">Experience: {doctor.experience}</p>
            </div>
          ))
        ) : (
          <p className="text-gray-500 text-center text-lg col-span-full">
            ❌ No doctors found.
          </p>
        )}
      </div>
    </div>
  );
};

export default Doctor;
</file>

<file path="src/screens/Lab.jsx">
// src/screens/Labtest.jsx
import React, { useState } from "react";

const Labtest = () => {
  // Sample lab tests data
  const labTests = [
    { name: "Blood Sugar Test", category: "Pathology", price: "₹300" },
    { name: "Lipid Profile", category: "Biochemistry", price: "₹800" },
    { name: "Complete Blood Count (CBC)", category: "Hematology", price: "₹500" },
    { name: "Thyroid Profile", category: "Endocrinology", price: "₹700" },
    { name: "X-Ray Chest", category: "Radiology", price: "₹1000" },
    { name: "MRI Brain", category: "Radiology", price: "₹5000" },
  ];

  const [searchTerm, setSearchTerm] = useState("");

  // Filter by name or category
  const filteredTests = labTests.filter(
    (test) =>
      test.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      test.category.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-pink-50 to-gray-50 p-6">
      <h1 className="text-4xl font-extrabold text-gray-900 mb-8 text-center">
        Book Your <span className="text-pink-600">Lab Test</span>
      </h1>

      {/* Search Bar */}
      <div className="mb-10 max-w-lg mx-auto">
        <input
          type="text"
          placeholder="🔍 Search by test name or category..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* Lab Tests Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
        {filteredTests.length > 0 ? (
          filteredTests.map((test, index) => (
            <div
              key={index}
              className="bg-white shadow-md rounded-xl p-6 hover:shadow-2xl hover:scale-105 transform transition duration-200 cursor-pointer"
            >
              <h2 className="text-xl font-bold text-pink-700">{test.name}</h2>
              <p className="text-sm text-gray-600 mt-1">Category: {test.category}</p>
              <p className="text-sm text-gray-600 mt-1">Price: {test.price}</p>
            </div>
          ))
        ) : (
          <p className="text-gray-500 text-center text-lg col-span-full">
            ❌ No lab tests found.
          </p>
        )}
      </div>
    </div>
  );
};

export default Labtest;
</file>

<file path="src/screens/Login.jsx">
import React, { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import logo from "../assets/nlogo.jpg";
import { useAuth } from "../context/AuthContext";
import { Eye, EyeOff } from "lucide-react";

const Login = () => {
  const { loginUser } = useAuth(); // ✅ NEW CONTEXT METHOD
  const navigate = useNavigate();

  const [form, setForm] = useState({
    name: "",
    email: "",
    phone: "",
    password: "",
    bloodGroup: "",
    age: "",
  });

  const [isLogin, setIsLogin] = useState(true);
  const [selectedRole, setSelectedRole] = useState("user");
  const [showPassword, setShowPassword] = useState(true); // 👁️ FIXED
  const [loading, setLoading] = useState(false);

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    if (!form.password || (!form.email && !form.phone)) {
      alert("Please provide email/phone and password");
      return;
    }

    if (!isLogin && (!form.name || !form.bloodGroup || !form.age)) {
      alert("Please fill all required fields");
      return;
    }

    const payload = isLogin
      ? {
          email: form.email || null,
          phone: form.phone || null,
          password: form.password,
        }
      : {
          name: form.name,
          email: form.email || null,
          phone: form.phone || null,
          password: form.password,
          bloodGroup: form.bloodGroup,
          age: form.age,
        };

    const url = isLogin
      ? `${import.meta.env.VITE_BACKEND_URL}/api/auth/login`
      : `${import.meta.env.VITE_BACKEND_URL}/api/auth/register`;

    try {
      const res = await axios.post(url, payload);

      if (isLogin) {
        // ✅ CORRECT METHOD
        loginUser(res.data.user, res.data.token);

        // ✅ CORRECT REDIRECT
        navigate("/userdashboard", { replace: true });
      } else {
        alert("Registration successful! Please log in.");
        setIsLogin(true);
      }
    } catch (err) {
      console.error("Axios error:", err);
      alert(err.response?.data?.error || "Login/Register failed");
    } finally {
      setLoading(false);
    }
  };

  const handleRoleSelect = (role) => {
    setSelectedRole(role);
    if (role === "pharmacist") navigate("/pharmacist-login");
    if (role === "admin") navigate("/admin/login");
  };

  return (
    <div className="flex justify-center items-center min-h-screen bg-gradient-to-br from-blue-50 to-blue-100">
      <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md">
        <div className="flex justify-center mb-4">
          <img src={logo} alt="Logo" className="w-20 h-20 rounded-full" />
        </div>

        {/* ROLE BUTTONS */}
        <div className="flex justify-center gap-3 mb-6">
          {["user", "pharmacist", "admin"].map((role) => (
            <button
              key={role}
              onClick={() => handleRoleSelect(role)}
              className={`px-4 py-2 rounded-lg font-semibold transition ${
                selectedRole === role
                  ? "bg-blue-600 text-white"
                  : "bg-gray-100 hover:bg-blue-100"
              }`}
            >
              {role === "user" && "👤 User"}
              {role === "pharmacist" && "💊 Pharmacist"}
              {role === "admin" && "🧑‍💼 Admin"}
            </button>
          ))}
        </div>

        {/* USER FORM */}
        {selectedRole === "user" && (
          <>
            <h1 className="text-2xl font-bold mb-4 text-center">
              {isLogin ? "User Login" : "User Registration"}
            </h1>

            <form onSubmit={handleSubmit} className="space-y-4">
              {!isLogin && (
                <>
                  <input
                    name="name"
                    placeholder="Full Name"
                    value={form.name}
                    onChange={handleChange}
                    className="w-full border p-2 rounded"
                    required
                  />
                  <input
                    name="bloodGroup"
                    placeholder="Blood Group"
                    value={form.bloodGroup}
                    onChange={handleChange}
                    className="w-full border p-2 rounded"
                    required
                  />
                  <input
                    name="age"
                    type="number"
                    placeholder="Age"
                    value={form.age}
                    onChange={handleChange}
                    className="w-full border p-2 rounded"
                    required
                  />
                </>
              )}

              <input
                name="email"
                placeholder="Email"
                value={form.email}
                onChange={handleChange}
                className="w-full border p-2 rounded"
              />

              <input
                name="phone"
                placeholder="Phone"
                value={form.phone}
                onChange={handleChange}
                className="w-full border p-2 rounded"
              />

              {/* PASSWORD WITH EYE */}
              <div className="relative">
                <input
                  type={showPassword ? "password" : "text"}
                  name="password"
                  placeholder="Password"
                  value={form.password}
                  onChange={handleChange}
                  className="w-full border p-2 rounded pr-10"
                  required
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-2.5 text-gray-500"
                >
                  {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
                </button>
              </div>

              <button
                disabled={loading}
                className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 disabled:opacity-50"
              >
                {loading ? "Logging in..." : isLogin ? "Login" : "Register"}
              </button>
            </form>

            <p
              className="text-sm text-center mt-4 text-blue-600 cursor-pointer"
              onClick={() => setIsLogin(!isLogin)}
            >
              {isLogin
                ? "Don't have an account? Register"
                : "Already have an account? Login"}
            </p>
          </>
        )}
      </div>
    </div>
  );
};

export default Login;
</file>

<file path="src/screens/PharmacistLogin.jsx">
import React, { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../context/AuthContext";
import { Eye, EyeOff } from "lucide-react";

const PharmacistLogin = () => {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(true);

  const navigate = useNavigate();
  const { loginPharmacist } = useAuth();

  const handleLogin = async (e) => {
     e.preventDefault();
    setLoading(true);
    try {
      const res = await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/pharmacist-auth/login`,
        { email, password }
      );

      loginPharmacist(res.data.token); // ✅ updates React state

      navigate("/pharmacy-admin", { replace: true });
    } catch {
      setError("Invalid credentials");
    }finally {
      setLoading(false);
    }
  };

  return (
    <div className="max-w-md mx-auto mt-20 p-6 border rounded shadow">
  <h2 className="text-xl mb-4 font-semibold">Pharmacist Login</h2>

  <input
    type="email"
    className="w-full p-2 mb-3 border rounded"
    placeholder="Email"
    value={email}
    onChange={(e) => setEmail(e.target.value)}
  />

  {/* 🔐 Password Field */}
  <div className="relative mb-3">
    <input
      type={showPassword ? "password" : "text"}
      placeholder="Password"
      value={password}
      onChange={(e) => setPassword(e.target.value)}
      className="w-full p-2 pr-10 border rounded"
    />

    <button
      type="button"
      onClick={() => setShowPassword((p) => !p)}
      className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
    >
      {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
    </button>
  </div>

  <button
    onClick={handleLogin}
    disabled={loading}
    className="w-full bg-teal-600 text-white py-2 rounded disabled:opacity-50"
  >
    {loading ? "Logging in..." : "Login"}
  </button>

  {error && <p className="text-red-600 mt-2">{error}</p>}
</div>

  );
};

export default PharmacistLogin;
</file>

<file path="src/screens/PharmacyAdmin.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";

const PharmacyAdmin = () => {
  const [prescriptions, setPrescriptions] = useState([]);
  const [pharmacistName, setPharmacistName] = useState("");
  const [showConfirmModal, setShowConfirmModal] = useState(false);
  const [selectedPrescription, setSelectedPrescription] = useState(null);
  const [allPresent, setAllPresent] = useState(true);
  const [manualMedicines, setManualMedicines] = useState([""]);

  const navigate = useNavigate();

  /* ================= AUTH ================= */
  const getHeaders = () => {
    const token = localStorage.getItem("pharmacistToken");
    if (!token) {
      navigate("/pharmacist-login");
      return null;
    }
    return { Authorization: `Bearer ${token}` };
  };

  /* ================= FETCH ================= */
  useEffect(() => {
    fetchPharmacistInfo();
    fetchPrescriptions();
    // eslint-disable-next-line
  }, []);

  const fetchPharmacistInfo = async () => {
    const headers = getHeaders();
    if (!headers) return;

    try {
      const res = await axios.get(
        `${import.meta.env.VITE_BACKEND_URL}/api/pharmacist/me`,
        { headers }
      );
      setPharmacistName(res.data.name);
    } catch {
      navigate("/pharmacist-login");
    }
  };

  const fetchPrescriptions = async () => {
    const headers = getHeaders();
    if (!headers) return;

    try {
      const res = await axios.get(
        `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/all`,
        { headers }
      );
      setPrescriptions(res.data);
    } catch (err) {
      console.error(err);
    }
  };

  /* ================= MODAL ================= */
  const openConfirmModal = (p) => {
    setSelectedPrescription(p);
    setShowConfirmModal(true);
    setAllPresent(true);
    setManualMedicines([""]);
  };

  const closeConfirmModal = () => {
    setShowConfirmModal(false);
    setSelectedPrescription(null);
    setManualMedicines([""]);
  };

  const handleMedicineInputChange = (i, v) => {
    const updated = [...manualMedicines];
    updated[i] = v;
    setManualMedicines(updated);
  };

  const addMedicineField = () => {
    setManualMedicines([...manualMedicines, ""]);
  };

  /* ================= CONFIRM ================= */
  const handleConfirmMedicines = async () => {
    if (!selectedPrescription) return;
    const headers = getHeaders();
    if (!headers) return;

    await axios.put(
      `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/${selectedPrescription._id}/confirm`,
      {
        allPresent,
        medicines: allPresent
          ? []
          : manualMedicines.filter((m) => m.trim()),
      },
      { headers }
    );

    setPrescriptions((prev) =>
      prev.map((p) =>
        p._id === selectedPrescription._id
          ? { ...p, status: "confirmed" }
          : p
      )
    );

    closeConfirmModal();
  };

  /* ================= REJECT ================= */
  const handleReject = async (id) => {
    const headers = getHeaders();
    if (!headers) return;

    await axios.put(
      `${import.meta.env.VITE_BACKEND_URL}/api/pharmacist/prescriptions/${id}/reject`,
      {},
      { headers }
    );

    setPrescriptions((prev) =>
      prev.map((p) =>
        p._id === id ? { ...p, status: "rejected" } : p
      )
    );
  };

  /* ================= UI ================= */
  return (
    <div className="min-h-screen p-4 bg-gray-50">
      <h1 className="text-3xl font-bold text-center mb-6">
        Welcome, {pharmacistName}
      </h1>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {prescriptions.map((p) => (
          <div key={p._id} className="bg-white p-4 rounded shadow">
            <span className="text-xs text-gray-500">
              {p.type === "manual"
                ? "Manual Request"
                : "Uploaded Prescription"}
            </span>

            {/* 👁️ VIEW PRESCRIPTION (RESTORED) */}
            {p.type === "upload" && p.filename && (
              <p className="mt-2">
                <a
                  href={`${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/image/${p.filename}`}
                  target="_blank"
                  rel="noreferrer"
                  className="text-blue-600 underline text-sm"
                >
                  View Prescription
                </a>
              </p>
            )}

            {/* 💊 MANUAL MEDICINES */}
            {p.type === "manual" && (
              <>
                <p className="font-semibold mt-2 text-sm">
                  Medicines:
                </p>
                <ul className="list-disc ml-4 text-sm">
                  {p.medicines?.map((m, i) => (
                    <li key={i}>{m}</li>
                  ))}
                </ul>
              </>
            )}

            <p className="text-sm mt-2">
              <b>User:</b> {p.userEmail}
            </p>

            <p className="text-sm">
              <b>Status:</b>{" "}
              <span
                className={
                  p.status === "confirmed"
                    ? "text-green-600"
                    : p.status === "rejected"
                    ? "text-red-600"
                    : "text-yellow-600"
                }
              >
                {p.status || "pending"}
              </span>
            </p>

            <div className="flex gap-2 mt-4">
              <button
                onClick={() => openConfirmModal(p)}
                disabled={p.status === "confirmed"}
                className="bg-green-600 text-white px-3 py-1 rounded disabled:opacity-50"
              >
                Accept
              </button>
              <button
                onClick={() => handleReject(p._id)}
                disabled={p.status === "rejected"}
                className="bg-red-600 text-white px-3 py-1 rounded disabled:opacity-50"
              >
                Reject
              </button>
            </div>
          </div>
        ))}
      </div>

      {/* ================= CONFIRM MODAL ================= */}
      {showConfirmModal && (
        <div className="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
          <div className="bg-white p-4 rounded w-80">
            <h2 className="font-bold mb-2">Confirm Medicines</h2>

            <label>
              <input
                type="radio"
                checked={allPresent}
                onChange={() => setAllPresent(true)}
              />{" "}
              All medicines present
            </label>

            <label className="block mt-2">
              <input
                type="radio"
                checked={!allPresent}
                onChange={() => setAllPresent(false)}
              />{" "}
              Not all present
            </label>

            {!allPresent && (
              <div className="mt-2">
                {manualMedicines.map((m, i) => (
                  <input
                    key={i}
                    value={m}
                    onChange={(e) =>
                      handleMedicineInputChange(i, e.target.value)
                    }
                    className="border w-full mb-1 px-2 py-1"
                    placeholder={`Medicine ${i + 1}`}
                  />
                ))}
                <button
                  onClick={addMedicineField}
                  className="text-blue-600 text-sm"
                >
                  + Add Medicine
                </button>
              </div>
            )}

            <div className="flex gap-2 mt-4">
              <button
                onClick={handleConfirmMedicines}
                className="bg-green-600 text-white px-3 py-1 rounded"
              >
                Confirm
              </button>
              <button
                onClick={closeConfirmModal}
                className="bg-gray-400 text-white px-3 py-1 rounded"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default PharmacyAdmin;
</file>

<file path="src/screens/Profile.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import bgImage from "../assets/pbgc.avif";
import { useAuth } from "../context/AuthContext";

const Profile = () => {
  const { user } = useAuth();
  const userEmail = user?.email;

  const [userData, setUserData] = useState({
    name: "",
    age: "",
    gender: "",
    bloodGroup: "",
    height: "",
    weight: "",
    allergies: "",
    medicalConditions: "",
    medications: "",
    fathername: "",
    mothername: "",
    emergencyContact: { name: "", phone: "", relation: "" },
    achievements: [],
  });

  const [editMode, setEditMode] = useState(false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [userName, setUserName] = useState("");
  

  // Fetch profile data
  useEffect(() => {
    if (!userEmail) {
      setError("User not logged in. Please log in again.");
      return;
    }
    fetchProfile();
  }, [userEmail]);

   useEffect(() => {
      if (user && user.name) {
        setUserName(user.name); // Use user from parent state if available
      } else {
        const storedUser = localStorage.getItem("user");
        if (storedUser) {
          const parsedUser = JSON.parse(storedUser);
          setUserName(parsedUser.name);
        }
      }
    }, [user]);

  const fetchProfile = async () => {
    setLoading(true);
    setError("");
    try {
      const res = await axios.get(
        `${import.meta.env.VITE_BACKEND_URL}/api/profile/${encodeURIComponent(userEmail)}`
      );
      const data = res.data || {};

      // Ensure emergencyContact is always an object
      setUserData({
        ...userData,
        ...data,
        emergencyContact: data.emergencyContact || {
          name: "",
          phone: "",
          relation: "",
        },
        achievements: data.achievements || [],
      });
    } catch (err) {
      console.error("Profile fetch error:", err);
      setError("Error fetching profile: " + (err.response?.data?.msg || err.message));
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    if (name.startsWith("emergencyContact.")) {
      const field = name.split(".")[1];
      setUserData((prev) => ({
        ...prev,
        emergencyContact: {
          ...prev.emergencyContact,
          [field]: value,
        },
      }));
    } else {
      setUserData((prev) => ({ ...prev, [name]: value }));
    }
  };

  const handleSave = async () => {
    if (!userEmail) {
      setError("User email unavailable.");
      return;
    }
    setLoading(true);
    setError("");
    try {
      const res = await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/profile/${encodeURIComponent(userEmail)}`,
        userData
      );
      setUserData(res.data);
      setEditMode(false);
      alert("Profile updated successfully!");
    } catch (err) {
      console.error("Profile save error:", err);
      setError("Failed to save profile. " + (err.response?.data?.msg || err.message));
    } finally {
      setLoading(false);
    }
  };

  const renderInput = (field, label, type = "text") => (
    <div key={field}>
      <p className="text-gray-500 font-medium">{label}</p>
      {editMode ? (
        <input
          type={type}
          name={field}
          value={userData[field] || ""}
          onChange={handleChange}
          className="border rounded p-2 w-full mt-1 placeholder:text-gray-400"
          placeholder={`Enter ${label.toLowerCase()}`}
        />
      ) : (
        <p className="text-gray-900 font-semibold">
          {userData[field] || "Not provided"}
        </p>
      )}
    </div>
  );

  const renderEmergencyInput = (field, label) => (
    <div key={field}>
      <p className="text-gray-500 font-medium">{label}</p>
      {editMode ? (
        <input
          type="text"
          name={`emergencyContact.${field}`}
          value={userData?.emergencyContact?.[field] || ""}
          onChange={handleChange}
          className="border rounded p-2 w-full mt-1 placeholder:text-gray-400"
          placeholder={`Enter ${label.toLowerCase()}`}
        />
      ) : (
        <p className="text-gray-900 font-semibold">
          {userData?.emergencyContact?.[field] || "Not provided"}
        </p>
      )}
    </div>
  );

  if (loading && !editMode)
    return (
      <div className="min-h-screen bg-gray-100 flex items-center justify-center">
        <p className="text-xl text-gray-700">Loading profile...</p>
      </div>
    );

  return (
    <div
      className="min-h-screen bg-gray-100 p-6 bg-cover bg-center"
      style={{ backgroundImage: `url(${bgImage})` }}
    >
      <h1 className="text-4xl font-bold text-gray-800 mb-8 text-center"> Hello, <span className="text-teal-600">{userName || "Guest"}</span></h1>

      {error && (
        <div className="max-w-4xl mx-auto mb-4 p-4 bg-red-100 border border-red-400 rounded">
          <p className="text-red-700">{error}</p>
        </div>
      )}

      <div className="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-8 space-y-8">
        {/* Toggle Edit */}
        <h1 className="text-2xl font-bold text-gray-800 mb-8 text-center"><u>MEDICAL REPORT</u></h1>
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-2xl font-semibold text-gray-700">Profile Information</h2>
          <button
            onClick={() => setEditMode(!editMode)}
            disabled={loading}
            className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400"
          >
            {editMode ? "Cancel Edit" : "Edit Profile"}
          </button>
        </div>

        {/* Personal Info */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {renderInput("name", "Full Name")}
          {renderInput("age", "Age", "number")}
          {renderInput("gender", "Gender")}
          {renderInput("bloodGroup", "Blood Group")}
          {renderInput("height", "Height")}
          {renderInput("weight", "Weight")}
          {renderInput("allergies", "Allergies")}
          {renderInput("medicalConditions", "Medical Conditions")}
          {renderInput("medications", "Medications")}
        </div>

        {/* Emergency Contact */}
        <div>
          <h2 className="text-2xl font-semibold text-gray-700 mb-4">Emergency Contact</h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {renderEmergencyInput("name", "Contact Name")}
            {renderEmergencyInput("relation", "Relation")}
            {renderEmergencyInput("phone", "Phone")}
          </div>
        </div>

        {/* Achievements */}
        <div>
          <h2 className="text-2xl font-bold text-gray-800 text-center mb-4"><u>Achievements</u></h2>
          <ul className="space-y-2">
            {userData.achievements?.length > 0 ? (
              userData.achievements.map((ach, idx) => (
                <li
                  key={idx}
                  className="bg-gradient-to-br from-red-50 to-pink-100 border border-red-200 rounded-xl p-4 shadow-sm"
                >
                  <p className="font-semibold text-gray-800">{ach.title}</p>
                  <p className="text-sm text-gray-600">
                    {new Date(ach.date).toLocaleDateString()} –{" "}
                    {ach.location || "Unknown location"}
                  </p>
                  {ach.donorCode && (
                    <p className="text-sm text-green-700 font-medium mt-1">
                      Donor Code: {ach.donorCode}
                    </p>
                  )}
                </li>
              ))
            ) : (
              <p className="text-gray-600">No achievements yet.</p>
            )}
          </ul>
        </div>

        {/* Save Button */}
        {editMode && (
          <div className="flex justify-center mt-6">
            <button
              onClick={handleSave}
              disabled={loading}
              className="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 disabled:bg-gray-400"
            >
              {loading ? "Saving..." : "Save Profile"}
            </button>
          </div>
        )}
      </div>
    </div>
  );
};

export default Profile;
</file>

<file path="src/screens/Raksha.jsx">
// src/screens/Raksha.jsx
import React, { useState, useEffect } from "react";
import axios from "axios";
import Confetti from "react-confetti";
import { useAuth } from "../context/AuthContext";

const Raksha = () => {
  const { user } = useAuth();
  const [requests, setRequests] = useState([]);
  const [formData, setFormData] = useState({ group: "", units: "", locationName: "" });
  const [loading, setLoading] = useState(false);
  const [showDonorCode, setShowDonorCode] = useState(false);
  const [donorCode, setDonorCode] = useState("");
  const [error, setError] = useState("");
  const [serverStatus, setServerStatus] = useState("checking");
  const [thankYou, setThankYou] = useState(false);
  const [showConfetti, setShowConfetti] = useState(false);
  const [windowSize, setWindowSize] = useState({ width: window.innerWidth, height: window.innerHeight });

  // Check backend status
  const checkServerStatus = async () => {
    try {
      await axios.get(`${import.meta.env.VITE_BACKEND_URL}`);
      setServerStatus("online");
      setError("");
    } catch {
      setServerStatus("offline");
      setError("Backend server is not running. Please start it.");
    }
  };

  // Fetch all requests
  const fetchRequests = async () => {
    if (serverStatus !== "online") return;
    try {
      const res = await axios.get(`${import.meta.env.VITE_BACKEND_URL}/api/requests`);
      const filtered = res.data.filter(req => req.status === "open" || req.status === "accepted");
      setRequests(filtered);
      setError("");
    } catch (err) {
      console.error("Fetch error:", err);
      if (err.code === "ERR_NETWORK") {
        setServerStatus("offline");
        setError("Cannot connect to backend server.");
      } else setError("Error fetching requests: " + (err.response?.data?.message || err.message));
    }
  };

  useEffect(() => {
    checkServerStatus();
    const handleResize = () => setWindowSize({ width: window.innerWidth, height: window.innerHeight });
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, []);

  useEffect(() => {
    if (serverStatus === "online") fetchRequests();
  }, [serverStatus]);

  const handleChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });

  // 🩸 Submit new request
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!user || !user.email) return alert("User not logged in!");
    if (!formData.group || !formData.units || !formData.locationName) return alert("Fill all fields!");
    setLoading(true);
    try {
      const res = await axios.post(`${import.meta.env.VITE_BACKEND_URL}/api/requests/request`, {
        ...formData,
        units: Number(formData.units),
        requesterEmail: user.email,
        lat: null,
        lng: null,
      });
      setRequests([...requests, res.data]);
      setFormData({ group: "", units: "", locationName: "" });
      alert("Request submitted successfully!");
    } catch (err) {
      console.error("Request error:", err);
      alert("Error: " + (err.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  // 🩸 Donor accepts request
  const handleAccept = async (requestId) => {
    if (serverStatus !== "online") return setError("Backend server is offline.");
    if (!user || !user.email) return alert("User not logged in!");
    setLoading(true);
    try {
      const randomCode = Math.floor(100000 + Math.random() * 900000).toString();
      await axios.put(`${import.meta.env.VITE_BACKEND_URL}/api/requests/${requestId}/accept`, {
        donorEmail: user.email,
        donorCode: randomCode,
        donorName: user.name,
        donorPhone: user.phone,
      });
      setDonorCode(randomCode);
      setShowDonorCode(true);
      fetchRequests();
    } catch (err) {
      console.error("Accept error:", err);
      alert("Error: " + (err.response?.data?.message || err.message));
    } finally {
      setLoading(false);
    }
  };

  // 🩸 Requester confirms donation
  const handleConfirmDonation = async (requestId) => {
    try {
      const res = await axios.post(`${import.meta.env.VITE_BACKEND_URL}/api/requests/confirmDonation/${requestId}`);
      setDonorCode(res.data.donorCode);
      setThankYou(true);
      setShowConfetti(true);
      setTimeout(() => setShowConfetti(false), 5000);
      fetchRequests();
    } catch (err) {
      console.error("Confirm donation error:", err);
      alert("Error confirming donation.");
    }
  };

  const closeDonorPopup = () => {
    setShowDonorCode(false);
    setDonorCode("");
  };

  const retryConnection = () => {
    setServerStatus("checking");
    checkServerStatus();
  };

  return (
    <div className="min-h-screen p-6 bg-gray-100 relative">
      <h1 className="text-3xl font-bold mb-6 text-center">🩸 Blood Requests</h1>

      {showConfetti && <Confetti width={windowSize.width} height={windowSize.height} />}

      {/* Backend offline */}
      {serverStatus === "offline" && (
        <div className="max-w-4xl mx-auto mb-4 p-4 bg-red-100 border border-red-400 rounded">
          <p className="text-red-700 font-semibold">⚠️ Backend Server Offline</p>
          <p className="text-red-600 mb-2">{error}</p>
          <button onClick={retryConnection} className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
            Retry
          </button>
        </div>
      )}

      {/* Form for requester */}
      {serverStatus === "online" && (
        <div className="max-w-md mx-auto bg-white p-6 rounded shadow mb-8">
          <h2 className="text-xl font-semibold mb-4">Create a Request</h2>
          <form onSubmit={handleSubmit} className="space-y-4">
            <input type="text" name="group" placeholder="Blood Group (e.g., A+)" className="border p-2 w-full rounded"
              value={formData.group} onChange={handleChange} />
            <input type="number" name="units" placeholder="Units" className="border p-2 w-full rounded"
              value={formData.units} onChange={handleChange} />
            <input type="text" name="locationName" placeholder="Location (e.g., City Hospital)"
              className="border p-2 w-full rounded" value={formData.locationName} onChange={handleChange} />
            <button type="submit" disabled={loading}
              className="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 disabled:bg-gray-400">
              {loading ? "Submitting..." : "Submit Request"}
            </button>
          </form>
        </div>
      )}

      {/* Donor Thank You Popup */}
      {showDonorCode && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 animate-fadeIn">
          <div className="bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto animate-bounceIn text-center">
            <h2 className="text-2xl font-bold text-green-600 mb-4">Thank You! 🙏</h2>
            <p className="text-lg mb-2">You’ve accepted this request.</p>
            <div className="bg-yellow-100 p-4 rounded mb-4">
              <p className="font-semibold">Your Donor Code:</p>
              <p className="text-2xl font-bold text-red-600 my-2">{donorCode}</p>
              <p className="text-sm text-gray-600">Please share this code after donating.</p>
            </div>
            <button onClick={closeDonorPopup} className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 w-full">
              OK
            </button>
          </div>
        </div>
      )}

      {/* Thank You Confirmation Modal (Requester side) */}
      {thankYou && (
        <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 animate-fadeIn">
          <div className="bg-white rounded-2xl p-8 shadow-xl text-center w-80 animate-bounceIn">
            <h2 className="text-2xl font-bold text-green-700 mb-2">Donation Confirmed! 🎉</h2>
            <p className="mb-2">The donor successfully donated blood.</p>
            <p className="font-semibold text-red-600 text-lg mb-2">Code: {donorCode}</p>
            <p className="text-gray-600 text-sm mb-4">A new achievement has been added to donor’s profile 🏅</p>
            <button onClick={() => setThankYou(false)} className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
              Close
            </button>
          </div>
        </div>
      )}

      {/* Requests */}
      {serverStatus === "online" && (
        <div className="max-w-4xl mx-auto">
          <h2 className="text-2xl font-semibold mb-4">Existing Requests</h2>
          {requests.length === 0 ? (
            <p className="text-center text-gray-500">No active blood requests.</p>
          ) : (
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {requests.map((req) => (
                <div key={req._id} className="bg-white p-4 rounded shadow relative">
                  <div className={`absolute top-0 left-0 w-2 h-full ${req.status === "accepted" ? "bg-green-500" : "bg-red-500"}`}></div>
                  <div className="ml-3">
                    <p><strong>Blood Group:</strong> {req.group}</p>
                    <p><strong>Units:</strong> {req.units}</p>
                    <p><strong>Location:</strong> {req.location.name}</p>
                    <p><strong>Requester:</strong> {req.requester}</p>
                    <p><strong>Status:</strong>
                      <span className={`font-semibold ${req.status === "accepted" ? "text-green-600" : "text-red-600"}`}>
                        {req.status.toUpperCase()}
                      </span>
                    </p>

                    {req.status === "accepted" && req.donor && (
                      <div className="mt-2 p-2 bg-green-50 rounded">
                        <p><strong>Accepted by:</strong> {req.donorName || req.donor}</p>
                        {req.donorPhone && <p><strong>Donor Phone:</strong> {req.donorPhone}</p>}
                        {req.donorCode && <p><strong>Donor Code:</strong> {req.donorCode}</p>}
                      </div>
                    )}

                    {/* Donor buttons */}
                    {req.status === "open" && req.requester !== user?.email && (
                      <div className="flex space-x-2 mt-3">
                        <button onClick={() => handleAccept(req._id)} disabled={loading}
                          className="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 disabled:bg-gray-400">
                          Accept
                        </button>
                        <button onClick={() => setRequests(requests.filter(r => r._id !== req._id))}
                          className="bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600">
                          Reject
                        </button>
                      </div>
                    )}

                    {/* Requester: Confirm Donation */}
                    {req.status === "accepted" && req.requester === user?.email && !req.donationConfirmed && (
                      <div className="mt-3">
                        <p className="text-sm text-gray-700 mb-1">Has the donor successfully donated blood?</p>
                        <button onClick={() => handleConfirmDonation(req._id)}
                          className="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                          ✅ Yes, Donated
                        </button>
                      </div>
                    )}

                    {req.requester === user?.email && (
                      <p className="text-sm text-blue-600 mt-2">
                        This is your request {req.status === "accepted" && "- It has been accepted!"}
                      </p>
                    )}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      )}

      <style>
        {`
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 0.3s ease-in-out; }
        @keyframes bounceIn {
          0% { transform: scale(0.8); opacity: 0; }
          50% { transform: scale(1.05); opacity: 1; }
          100% { transform: scale(1); }
        }
        .animate-bounceIn { animation: bounceIn 0.5s ease-in-out; }
        `}
      </style>
    </div>
  );
};

export default Raksha;
</file>

<file path="src/screens/Suraksha.jsx">
import React, { useState } from "react";

const paymentOptions = [
  { id: "upi", label: "UPI / QR Code" },
  { id: "card", label: "Credit/Debit Card" },
  { id: "netbanking", label: "Net Banking" },
  { id: "wallet", label: "Wallets" }
];

const Suraksha = () => {
  const plans = [
    {
      name: "Free / Always",
      price: 0,
      duration: "per Year",
      features: [
        "Digital Health Locker",
        "Medication Reminder",
        "Standarad 10% Pharmacy Discount",
        "Standarad Discount on Lab test"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-xl hover:-translate-y-1",
      popular: false,
    },
    {
      name: "Basic",
      price: 999,
      duration: "per Year",
      features: [
        "Digital Health Locker",
        "Medication Reminder",
        "Standarad 10% Pharmacy Discount",
        "Standarad Discount on Lab test"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-xl hover:-translate-y-1",
      popular: false,
    },
    {
      name: "Standard",
      price: 1999,
      duration: "per Year",
      features: [
        "Basic coverage",
        "Priority support",
        "Discounted medicines"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-2xl hover:-translate-y-2",
      popular: true,
    },
    {
      name: "Premium",
      price: 3599,
      duration: "per Year",
      features: [
        "All Standard features",
        "Full coverage",
        "Dedicated health advisor"
      ],
      color: "bg-gradient-to-br from-cyan-50 to-cyan-100",
      hover: "hover:shadow-xl hover:-translate-y-1",
      popular: false,
    },
  ];

  const [showPaymentModal, setShowPaymentModal] = useState(false);
  const [selectedPlan, setSelectedPlan] = useState(null);

  const handleSubscribe = (plan) => {
    setSelectedPlan(plan);
    setShowPaymentModal(true);
  };

  const closeModal = () => {
    setShowPaymentModal(false);
    setSelectedPlan(null);
  };

  return (
    <div className="min-h-screen bg-slate-50 p-6 sm:p-8 md:p-12 overflow-y-auto bg-cover bg-center">
      <h1 className="text-6xl font-bold text-gray-700 mt-2 mb-4 text-center">
        Donors Who Deserves Care.
      </h1>
      <h1 className="text-4xl font-extrabold text-gray-900 mb-12 text-center">
        Svasthya <span className="text-teal-600">Suraksha</span>
      </h1>

      <div className="flex flex-row flex-wrap justify-center max-w-6xl mx-auto gap-16">
        {plans.map((plan, index) => (
          <div
            key={index}
            className={`relative rounded-3xl p-8 flex flex-col items-center justify-between transform transition duration-300 ${plan.color} ${plan.hover} shadow-md w-72`}
          >
            {/* Popular Badge */}
            {plan.popular && (
              <span className="absolute top-2.5 right-3 bg-teal-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                Most Popular
              </span>
            )}

            <h2 className="text-2xl font-bold text-gray-800 mb-4">{plan.name}</h2>

            <p className="text-5xl font-extrabold text-teal-700 mb-1">₹{plan.price}</p>
            <p className="text-gray-600 mb-6">{plan.duration}</p>

            <ul className="text-gray-700 mb-6 list-disc list-inside space-y-2 self-start">
              {plan.features.map((feature, i) => (
                <li key={i} className="leading-relaxed">{feature}</li>
              ))}
            </ul>

            <button
              className={`w-full py-4 rounded-xl font-semibold text-white transition ${
                plan.popular ? "bg-teal-600 hover:bg-teal-700" : "bg-teal-600 hover:bg-teal-700"
              }`}
              onClick={() => handleSubscribe(plan)}
            >
              Subscribe
            </button>
          </div>
        ))}
      </div>
      <h1 className="text-5xl font-bold text-gray-700 mt-6 text-center">
        The Gift of Health is the Greatest Reward.
      </h1>

      {/* Payment Modal */}
      {showPaymentModal && (
        <div className="fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-50 animate-fadeIn">
          <div className="bg-white rounded-xl p-8 shadow-xl w-[90vw] max-w-md relative">
            <button
              className="absolute top-2 right-2 text-lg text-gray-500 hover:text-gray-800"
              onClick={closeModal}
              aria-label="Close payment options"
            >&times;</button>
            <h2 className="text-2xl font-bold mb-4 text-center">Choose Payment Method</h2>
            <ul className="space-y-4 my-6">
              {paymentOptions.map(opt => (
                <li key={opt.id}>
                  <button
                    className="w-full bg-teal-100 hover:bg-teal-200 text-teal-800 py-3 px-4 rounded-lg font-semibold transition"
                    onClick={() => alert(`You selected: ${opt.label}`)}
                  >
                    {opt.label}
                  </button>
                </li>
              ))}
            </ul>
            <button className="w-full mt-2 text-gray-600 underline" onClick={closeModal}>Cancel</button>
          </div>
        </div>
      )}
    </div>
  );
};

export default Suraksha;
</file>

<file path="src/screens/UserDashboard.jsx">
import React, { useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";
import bgImage from "../assets/bgc.avif";
import logo from "../assets/nlogo.jpg";

const UserDashboard = ({ user }) => {
  const navigate = useNavigate();
  const [userName, setUserName] = useState("");

  useEffect(() => {
    if (user && user.name) {
      setUserName(user.name); // Use user from parent state if available
    } else {
      const storedUser = localStorage.getItem("user");
      if (storedUser) {
        const parsedUser = JSON.parse(storedUser);
        setUserName(parsedUser.name);
      }
    }
  }, [user]);

  const cards = [
    { name: "Aushadhi", route: "/aushadhi", color: "bg-teal-100", hover: "hover:shadow-lg hover:-translate-y-1" },
    { name: "Suraksha", route: "/suraksha", color: "bg-orange-200", hover: "hover:shadow-lg hover:-translate-y-1" },
    { name: "Raksha", route: "/raksha", color: "bg-white", hover: "hover:shadow-lg hover:-translate-y-1" },
    // { name: "Doctor", route: "/doctor", color: "bg-lime-100", hover: "hover:shadow-lg hover:-translate-y-1" },
    // { name: "Lab Test", route: "/labtest", color: "bg-blue-200", hover: "hover:shadow-lg hover:-translate-y-1" },
    { name: "AI Health Assist", route: "/healthassist", color: "bg-green-200", hover: "hover:shadow-lg hover:-translate-y-1" },
  ];

  return (
    <div
      className="relative min-h-screen w-full flex flex-col items-center justify-start p-4 sm:p-6 bg-no-repeat bg-center bg-cover md:bg-fixed"
      style={{ backgroundImage: `url(${bgImage})` }}
    >
      {/* Overlay for readability */}
      <div className="absolute inset-0 bg-white/40 sm:bg-white/30 md:bg-white/20"></div>

      {/* Content above overlay */}
      <div className="relative z-10 w-full flex flex-col items-center">
        {/* Logo */}
        <img
          src={logo}
          alt="Logo"
          className="absolute top-1 left-1 w-14 h-14 sm:w-20 sm:h-20 md:w-28 md:h-28 lg:w-36 lg:h-36 object-contain drop-shadow-md rounded-full"
        />

        <h1 className="text-2xl sm:text-4xl md:text-5xl font-bold mb-8 text-gray-800 text-center bg-white/70 px-3 sm:px-6 py-2 rounded-xl shadow-md mt-20">
          Welcome, <span className="text-teal-600">{userName || "Guest"}</span>
        </h1>

        {/* Cards */}
        <div className="flex flex-wrap justify-center gap-4 sm:gap-6 lg:gap-8 w-full max-w-6xl">
          {cards.map((item, idx) => (
            <div
              key={idx}
              onClick={() => navigate(item.route)}
              className={`w-40 h-40 sm:w-52 sm:h-52 md:w-64 md:h-64 lg:w-72 lg:h-72 ${item.color} rounded-xl p-3 sm:p-5 flex flex-col items-center justify-center cursor-pointer transform transition duration-300 ${item.hover}`}
            >
              <h2 className="text-base sm:text-lg md:text-xl font-semibold mb-1">{item.name}</h2>
              <p className="text-gray-600 text-xs sm:text-sm md:text-base">Go to {item.name} module</p>
            </div>
          ))}
        </div>

        <h1 className="text-xl sm:text-3xl md:text-5xl lg:text-6xl font-bold text-gray-700 mt-8 text-center px-4">
          Your Companion in Crisis. Your Partner in Care.
        </h1>
      </div>
    </div>
  );
};

export default UserDashboard;
</file>

<file path="src/services/api.js">
import axios from 'axios';
const api = axios.create({ baseURL: import.meta.env.VITE_API_URL || 'http://localhost:5000/api' });
export default api;
</file>

<file path="tailwind.config.js">
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{js,jsx,ts,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};
</file>

<file path="vercel.json">
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
</file>

<file path="vite.config.js">
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
  plugins: [react()],
});
</file>

</files>
</file>

<file path="frontend/src/screens/UserDashboard.jsx">
import React, { useEffect, useState } from "react";
import { useNavigate } from "react-router-dom";
// import bgImage from "../assets/bgc.avif";
import logo from "../assets/nlogo.jpg";

const UserDashboard = ({ user }) => {
  const navigate = useNavigate();
  const [userName, setUserName] = useState("");

  useEffect(() => {
    if (user && user.name) {
      setUserName(user.name); // Use user from parent state if available
    } else {
      const storedUser = localStorage.getItem("user");
      if (storedUser) {
        const parsedUser = JSON.parse(storedUser);
        setUserName(parsedUser.name);
      }
    }
  }, [user]);

  const cards = [
    { name: "Aushadhi", route: "/aushadhi", color: "bg-teal-100", hover: "hover:shadow-lg hover:-translate-y-1" },
    { name: "Suraksha", route: "/suraksha", color: "bg-orange-200", hover: "hover:shadow-lg hover:-translate-y-1" },
    { name: "Raksha", route: "/raksha", color: "bg-gray-200", hover: "hover:shadow-lg hover:-translate-y-1" },
    // { name: "Doctor", route: "/doctor", color: "bg-lime-100", hover: "hover:shadow-lg hover:-translate-y-1" },
    // { name: "Lab Test", route: "/labtest", color: "bg-blue-200", hover: "hover:shadow-lg hover:-translate-y-1" },
    { name: "AI Health Assist", route: "/healthassist", color: "bg-green-200", hover: "hover:shadow-lg hover:-translate-y-1" },
  ];

  return (
    <div
      className="relative min-h-screen w-full flex flex-col items-center justify-start p-4 sm:p-6 bg-no-repeat bg-center bg-cover md:bg-fixed bg-[radial-gradient(#bae6fd_1px,transparent_1px)] "
      // style={{ backgroundImage: `url(${bgImage})` }}
    >
      {/* Overlay for readability */}
      <div className="absolute inset-0 bg-white/40 sm:bg-white/30 md:bg-white/20"></div>

      {/* Content above overlay */}
      <div className="relative z-10 w-full flex flex-col items-center">
        {/* Logo */}
        <img
          src={logo}
          alt="Logo"
          className="absolute top-1 left-1 w-14 h-14 sm:w-20 sm:h-20 md:w-28 md:h-28 lg:w-36 lg:h-36 object-contain drop-shadow-md rounded-full"
        />

        <h1 className="text-2xl sm:text-4xl md:text-5xl font-bold mb-8 text-gray-800 text-center bg-white/70 px-3 sm:px-6 py-2 rounded-xl shadow-md mt-20">
          Welcome, <span className="text-teal-600">{userName || "Guest"}</span>
        </h1>

        {/* Cards */}
        <div className="flex flex-wrap justify-center gap-4 sm:gap-6 lg:gap-8 w-full max-w-6xl">
          {cards.map((item, idx) => (
            <div
              key={idx}
              onClick={() => navigate(item.route)}
              className={`w-40 h-40 sm:w-52 sm:h-52 md:w-64 md:h-64 lg:w-72 lg:h-72 ${item.color} rounded-xl p-3 sm:p-5 flex flex-col items-center justify-center cursor-pointer transform transition duration-300 ${item.hover}`}
            >
              <h2 className="text-base sm:text-lg md:text-xl font-semibold mb-1">{item.name}</h2>
              <p className="text-gray-600 text-xs sm:text-sm md:text-base">Go to {item.name} module</p>
            </div>
          ))}
        </div>

        <h1 className="text-xl sm:text-3xl md:text-5xl lg:text-6xl font-bold text-gray-700 mt-8 text-center px-4">
          Your Companion in Crisis. Your Partner in Care.
        </h1>
      </div>
    </div>
  );
};

export default UserDashboard;
</file>

<file path="frontend/src/screens/AdminLogin.jsx">
import { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../context/AuthContext";
import { Eye, EyeOff } from "lucide-react";

export default function AdminLogin() {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [loading, setLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(true);

  const navigate = useNavigate();
  const { loginAdmin } = useAuth();

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      const res = await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/admin/login`,
        { email, password }
      );

      loginAdmin(res.data.token); // ✅ React state updated

      navigate("/admin/dashboard", { replace: true });
    } catch {
      alert("Invalid credentials");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex h-screen justify-center items-center bg-gray-100">
  <form
    onSubmit={handleLogin}
    className="bg-white p-8 rounded-2xl shadow-md w-96"
  >
    <h2 className="text-2xl font-bold mb-6 text-center">Admin Login</h2>

    <input
      type="email"
      className="border w-full p-2 mb-4 rounded"
      placeholder="Email"
      onChange={(e) => setEmail(e.target.value)}
      required
    />

    {/* ✅ PASSWORD + EYE WRAPPER */}
    <div className="relative mb-4">
      <input
        type={showPassword ? "password" : "text"}
        className="w-full p-2 pr-10 border rounded"
        placeholder="Password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        required
      />

      <button
        type="button"
        onClick={() => setShowPassword((p) => !p)}
        className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
      >
        {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
      </button>
    </div>

    <button
      type="submit"
      disabled={loading}
      className="bg-blue-500 text-white w-full py-2 rounded disabled:opacity-50"
    >
      {loading ? "Logging in..." : "Login"}
    </button>
  </form>
</div>

  );
}
</file>

<file path="frontend/src/screens/Aushadhi.jsx">
import React, { useState, useEffect } from "react";
import axios from "axios";
import { useAuth } from "../context/AuthContext";
import useSocket from "../hooks/useSocket";

const Aushadhi = () => {
  const { user } = useAuth();
  const token = localStorage.getItem("token");

  const [prescription, setPrescription] = useState(null);
  const [uploadStatus, setUploadStatus] = useState("");
  const [searchTerm, setSearchTerm] = useState("");
  const [prescriptions, setPrescriptions] = useState([]);
  const [selectedMedicines, setSelectedMedicines] = useState([]); // ✅ new state
  const [isUploading, setIsUploading] = useState(false);

  // Setup real-time socket connection for user notifications
  const socket = useSocket(user?.email);

  // Fetch prescriptions on mount and whenever user changes
  useEffect(() => {
    if (!user || !user.token) return;
    axios
      .get(`${import.meta.env.VITE_BACKEND_URL}/api/prescriptions`, {
        headers: { Authorization: `Bearer ${localStorage.getItem("token")}` },
      })
      .then((res) => {
        setPrescriptions(res.data);
      })
      .catch((err) => {
        console.error(err);
      });
  }, [user]);

  useEffect(() => {
    if (!socket?.current) return;

    const currentSocket = socket.current;

    currentSocket.on("prescriptionConfirmed", (data) => {
      alert(data.message);
      setPrescriptions((prev) =>
        prev.map((p) =>
          p._id === data.prescriptionId
            ? {
                ...p,
                status: "confirmed",
                confirmation: {
                  allPresent: data.allPresent,
                  medicines: data.medicines || [],
                },
              }
            : p
        )
      );
    });

    return () => {
      if (currentSocket) {
        currentSocket.off("prescriptionConfirmed");
      }
    };
  }, [socket, user]);

  // Upload prescription file
  const handleFileChange = (e) => {
    setPrescription(e.target.files[0]);
    setUploadStatus("");
  };

  const handleUpload = async () => {
    if (!prescription) return alert("Please select a prescription.");
    if (!user) return alert("User not logged in.");

    const formData = new FormData();
    formData.append("file", prescription);
    formData.append("userName", user.name);
    formData.append("userEmail", user.email);

    try {
      setIsUploading(true); //  disable button
      setUploadStatus("Uploading...");

      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions`,
        formData,
        {
          headers: {
            Authorization: `Bearer ${user.token}`, //  important for prod
          },
        }
      );

      setUploadStatus("Uploaded successfully!");
      setPrescription(null);
    } catch (err) {
      console.error(err);
      setUploadStatus("Upload failed.");
    } finally {
      setIsUploading(false); // 🔓 enable button again
    }
  };

  // Static medicines (for now)
  const medicines = [
    {
      name: "Paracetamol",
      dosage: "500mg",
      steps: "Take 1 tablet every 6 hours after food",
    },
    {
      name: "Amoxicillin",
      dosage: "250mg",
      steps: "Take 1 capsule every 8 hours for 5 days",
    },
    {
      name: "Vitamin C",
      dosage: "500mg",
      steps: "Take 1 tablet daily after breakfast",
    },
    {
      name: "Vitamin D",
      dosage: "400mg",
      steps: "Take 1 tablet every 8 hours if pain persists",
    },
    {
      name: "Combiflame",
      dosage: "400mg",
      steps: "Take 1 tablet every 8 hours if pain persists",
    },
    {
      name: "Ciplox eye drops",
      dosage: "Apply 2 drops",
      steps: "Apply 2 drops twice daily",
    },
  ];

  const filteredMedicines = medicines.filter((medicine) =>
    medicine.name.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // ✅ Handle selecting medicine
  const toggleSelectMedicine = (medicineName) => {
    setSelectedMedicines((prev) =>
      prev.includes(medicineName)
        ? prev.filter((m) => m !== medicineName)
        : [...prev, medicineName]
    );
  };

  // ✅ Handle submitting selected medicines
  const handleManualSubmit = async () => {
    if (selectedMedicines.length === 0) {
      return alert("Please select at least one medicine.");
    }

    try {
      await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/manual`,
        {
          medicines: selectedMedicines,
          userEmail: user.email,
          userName: user.name,
        },
        {
          headers: { Authorization: `Bearer ${user.token}` },
        }
      );
      console.log("🔑 Current user token:", user?.token);
      alert("✅ Medicine request submitted successfully!");
      setSelectedMedicines([]);
    } catch (err) {
      console.error(err);
      alert("❌ Failed to submit manual request.");
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-teal-50 to-gray-50 px-2 py-4 sm:px-6 md:px-10 lg:px-20 overflow-y-auto">
      {/* HEADER */}
      <div className="flex flex-col sm:flex-row justify-between items-center mb-5 gap-3 sm:gap-0">
        <h1 className="text-2xl sm:text-3xl md:text-4xl font-extrabold text-gray-900 text-center flex-1 break-words">
          Svasthya <span className="text-teal-600">Aushadhi</span>
        </h1>

        {/* Upload Section */}
        <div className="flex flex-col sm:flex-row items-center gap-2">
          <label
            htmlFor="prescription-upload"
            className="cursor-pointer bg-white border border-gray-300 rounded px-4 py-2 shadow-sm hover:bg-gray-100"
          >
            {prescription ? prescription.name : "Select Prescription"}
            <input
              id="prescription-upload"
              type="file"
              accept="image/*"
              onChange={handleFileChange}
              className="hidden"
            />
          </label>
          <button
            onClick={handleUpload}
            disabled={!prescription || isUploading}
            className={`bg-teal-500 text-white px-3 py-1 rounded 
    ${isUploading ? "opacity-50 cursor-not-allowed" : "hover:bg-teal-600"}
  `}
          >
            {isUploading ? "Uploading..." : "Upload"}
          </button>
        </div>
      </div>

      {/* Upload Status */}
      {uploadStatus && (
        <p
          className={`text-center mb-4 font-semibold ${
            uploadStatus.includes("success") ? "text-green-600" : "text-red-600"
          }`}
        >
          {uploadStatus}
        </p>
      )}

      {/* SEARCH BAR */}
      <div className="mb-6 max-w-lg mx-auto">
        <input
          type="text"
          aria-label="Search medicine"
          placeholder="Search medicine..."
          className="w-full p-3 rounded-xl border border-gray-300 shadow-sm"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />
      </div>

      {/* MEDICINE LIST */}
      <div className="grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
        {filteredMedicines.length > 0 ? (
          filteredMedicines.map((medicine, index) => {
            const selected = selectedMedicines.includes(medicine.name);
            return (
              <div
                key={index}
                onClick={() => toggleSelectMedicine(medicine.name)}
                className={`cursor-pointer bg-white shadow-md rounded-xl p-4 sm:p-6 flex flex-col justify-between hover:shadow-2xl h-full transition-all ${
                  selected ? "ring-4 ring-teal-500" : ""
                }`}
              >
                <h2 className="text-lg sm:text-xl md:text-2xl font-bold text-teal-700">
                  {medicine.name}
                </h2>
                <p className="text-xs sm:text-sm text-gray-500 mt-2">
                  {medicine.dosage}
                </p>
                <p className="text-xs sm:text-sm text-gray-700 mt-3">
                  {medicine.steps}
                </p>
              </div>
            );
          })
        ) : (
          <p className="col-span-full text-center text-gray-500">
            No medicines found.
          </p>
        )}
      </div>

      {/* ✅ Submit Selected Medicines */}
      {selectedMedicines.length > 0 && (
        <div className="mt-6 text-center">
          <p className="text-gray-700 mb-3">
            Selected Medicines:{" "}
            <span className="font-semibold text-teal-700">
              {selectedMedicines.join(", ")}
            </span>
          </p>
          <button
            onClick={handleManualSubmit}
            className="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700"
          >
            Submit Selected Medicines
          </button>
        </div>
      )}

      {/* CONFIRMATION SECTION */}
      <div className="mt-10 max-w-3xl mx-auto">
  <h2 className="text-xl font-semibold mb-3">
    Prescription Confirmations
  </h2>

  {prescriptions.length === 0 && <p>No prescriptions found.</p>}

  {prescriptions.map((p) =>
    p.confirmation ? (
      <div key={p._id} className="bg-green-100 p-4 rounded mb-4">
        <p>
          <strong>Status:</strong> Confirmed
        </p>

        {p.confirmation.allPresent ? (
          <p>
            <strong>All Medicines Present:</strong> Yes
          </p>
        ) : (
          <>
            <p>
              <strong>All Medicines Present:</strong> No
            </p>

            {p.confirmation.medicines &&
              p.confirmation.medicines.length > 0 && (
                <ul className="list-disc list-inside ml-4">
                  {p.confirmation.medicines.map((m, idx) => (
                    <li key={idx}>{m}</li>
                  ))}
                </ul>
              )}
          </>
        )}
      </div>
    ) : null
  )}
</div>

    </div>
  );
};

export default Aushadhi;
</file>

<file path="frontend/src/screens/Dashboard.jsx">
import React from "react";
import {
  Stethoscope,
  HeartPulse,
  ShieldCheck,
  UserCheck,
  HeartHandshake,
  Droplet,
  UserPlus,
  Activity,
  Heart,
  Mail,
  Phone,
  MapPin,
} from "lucide-react";

/* ================= CONTENT ================= */

const content = {
  hero: {
    badge: "Elevating Patient Care Through Clinical Expertise",
    title: "Expert PharmD Care for Superior Patient Outcomes",
    description:
      "Experience the difference of a healthcare platform built on PharmD principles. We bridge the gap between diagnosis and recovery with precise medication therapy management and dedicated patient advocacy.",
    ctaPrimary: <a href="/login">Consult a PharmD</a>,
    ctaSecondary: "Our Care Model",
    image: "https://images.unsplash.com/photo-1631815589968-fdb09a223b1e",
  },
  features: {
    title: "Advanced Clinical Care for Every Patient",
    description:
      "Our PharmD-led approach redefines healthcare delivery, prioritizing safety, efficacy, and compassionate support.",
    items: [
      {
        title: "Patient-First Medication Review",
        description:
          "Every prescription is clinically reviewed to prevent interactions.",
      },
      {
        title: "Therapeutic Outcome Monitoring",
        description:
          "Continuous tracking and optimization of therapy outcomes.",
      },
      {
        title: "Collaborative Care Ecosystem",
        description: "Pharmacists, doctors, and caregivers working together.",
      },
      {
        title: "Donor Assurance Program",
        description: "Guaranteed priority access to blood units for donors.",
      },
    ],
  },
  about: {
    title: "Founded on Clinical Excellence",
    description1:
      "Svasthya Hubis a PharmD-led initiative focused on patient-first healthcare.",
    description2:
      "We ensure every medication decision is evidence-based and personalized.",
    image: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1d",
    items: [
      { title: "Patient Advocacy", description: "Your health comes first." },
      {
        title: "Optimized Outcomes",
        description: "Better recovery, fewer risks.",
      },
      {
        title: "Life-Saving Assurance",
        description: "Care when it matters most.",
      },
    ],
  },
  footer: {
    brandName: "Svasthya Hub",
    description: "India’s pioneering PharmD-led clinical pharmacy network.",
    quickLinks: ["Privacy Policy", "FAQs", <a href="/pharmacist-login">Partner Login</a>, "Terms of Service"],
    services: [
      "Clinical Pharmacy",
      "Medication Therapy",
      "Health Consultations",
      "Partner Programs",
    ],
    copyright: `© ${new Date().getFullYear()} Svasthya Hub. All rights reserved.`,
  },
};

/* ================= PAGE ================= */

export default function Dashboard() {
  return (
    <div className="min-h-screen bg-white">
      {/* <Header/> */}
      <Hero />
      <Features />
      <About />
      <PatientVision />
      <Trust />
      <Footer />
    </div>
  );
}

/* ================= HEADER ================= */

// const Header = () => (
//   <header className="sticky top-0 z-50 bg-white border-b">
//     <div className="max-w-7xl mx-auto h-20 px-6 flex items-center justify-between">

//       {/* Logo */}
//       <div className="flex items-center gap-3">
//         <div className="w-11 h-11 bg-[#0369a1] rounded-xl flex items-center justify-center">
//           <Stethoscope className="text-white" />
//         </div>
//         <span className="text-xl font-bold text-[#0369a1]">
//           Svasthya Hub
//         </span>
//       </div>

//       {/* Navigation */}
//       <nav className="hidden md:flex items-center gap-8">
//         <a
//           href="#features"
//           className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
//         >
//           Features
//         </a>
//         <a
//           href="#about"
//           className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
//         >
//           About Us
//         </a>
//         <a
//           href="#partners"
//           className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
//         >
//           Partners
//         </a>
//         <a
//           href="#contact"
//           className="text-gray-600 hover:text-[#0369a1] transition-colors font-medium"
//         >
//           Contact
//         </a>
//       </nav>

//       {/* CTA */}
//       <div className="hidden md:block">
//         <button className="bg-[#0369a1] text-white px-6 py-2 rounded-md font-medium hover:bg-[#035f8f] transition">
//           Consult a PharmD
//         </button>
//       </div>

//     </div>
//   </header>
// );

/* ================= HERO ================= */

const Hero = () => (
  <section className="bg-gradient-to-br from-indigo-50 to-blue-50 py-28">
    <div className="max-w-7xl mx-auto grid lg:grid-cols-2 gap-12 px-6 items-center">
      <div>
        <span className="inline-flex gap-2 bg-indigo-100 px-4 py-2 rounded-full text-sm font-semibold text-[#0369a1]">
          <HeartPulse className="w-4 h-4" />
          {content.hero.badge}
        </span>

        <h1 className="mt-6 text-5xl font-bold text-gray-900">
          {content.hero.title}
        </h1>

        <p className="mt-6 text-lg text-gray-600">{content.hero.description}</p>

        <div className="mt-8 flex gap-4">
          <button className="px-8 py-3 bg-[#0369a1] text-white rounded-lg font-semibold">
            {content.hero.ctaPrimary}
          </button>
          <button className="px-8 py-3 border border-[#0369a1] text-[#0369a1] rounded-lg font-semibold">
            {content.hero.ctaSecondary}
          </button>
        </div>
      </div>

      <img src={content.hero.image} className="rounded-2xl shadow-xl" />
    </div>
  </section>
);

/* ================= FEATURES ================= */

const FEATURE_ICONS = [UserCheck, ShieldCheck, HeartHandshake, Droplet];

const Features = () => (
  <section className="py-24 bg-white">
    <div className="max-w-7xl mx-auto px-6">
      <h2 className="text-4xl font-bold text-center">
        {content.features.title}
      </h2>
      <p className="mt-4 text-gray-600 text-center max-w-2xl mx-auto">
        {content.features.description}
      </p>

      <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8 mt-16">
        {content.features.items.map((item, i) => {
          const Icon = FEATURE_ICONS[i];
          return (
            <div
              key={i}
              className="p-6 rounded-2xl border shadow hover:shadow-xl"
            >
              <Icon className="w-7 h-7 text-[#0369a1]" />
              <h3 className="mt-4 text-xl font-semibold">{item.title}</h3>
              <p className="mt-2 text-gray-600">{item.description}</p>
            </div>
          );
        })}
      </div>
    </div>
  </section>
);

/* ================= ABOUT ================= */

const ABOUT_ICONS = [UserPlus, Activity, Heart];

const About = () => (
  <section className="py-24 bg-gradient-to-br from-indigo-50 to-blue-50">
    <div className="max-w-7xl mx-auto grid lg:grid-cols-2 gap-16 px-6">
      <img src={content.about.image} className="rounded-2xl shadow-xl" />

      <div>
        <h2 className="text-4xl font-bold">{content.about.title}</h2>
        <p className="mt-4 text-gray-600">{content.about.description1}</p>
        <p className="mt-4 text-gray-600">{content.about.description2}</p>

        <div className="mt-8 space-y-4">
          {content.about.items.map((item, i) => {
            const Icon = ABOUT_ICONS[i];
            return (
              <div key={i} className="flex gap-4">
                <Icon className="text-[#0369a1]" />
                <div>
                  <h4 className="font-semibold">{item.title}</h4>
                  <p className="text-gray-600">{item.description}</p>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  </section>
);

/* ================= Patient Visions================= */
const PatientVision = () => (
  <section className="w-full max-w-4xl mx-auto mt-10">
    <div className="relative overflow-hidden rounded-3xl bg-white border border-slate-200 shadow-sm hover:shadow-lg transition">

      {/* Subtle Accent */}
      <div className="absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-blue-500 via-sky-400 to-teal-400" />

      <div className="p-8 sm:p-10">
         <h2 className="text-xl font-extrabold text-slate-900 mb-4">
          <u>Founder's Vision</u>
        </h2>
        {/* Heading */}
        <h2 className="text-2xl sm:text-3xl  text-slate-900 mb-4">
          World-Class Safety in Every Neighborhood
        </h2>

        {/* Divider */}
        <div className="w-16 h-1 bg-blue-600 rounded-full mb-6" />

        {/* Content */}
        <p className="text-slate-600 leading-relaxed text-base sm:text-lg">
          We are on a mission to ensure you never have to second-guess your healthcare.
          <span className="font-semibold text-slate-800"> SvasthyaHub</span> is bringing
          hospital-grade safety checks to your local pharmacy—so every prescription
          is verified, every interaction is checked, and every patient is protected.
        </p>

        <p className="text-slate-600 leading-relaxed text-base sm:text-lg mt-4">
          We promise
          <span className="font-semibold text-blue-600"> Verified Quality</span>,
          <span className="font-semibold text-green-600"> Expert Guidance</span>, and
          <span className="font-semibold text-teal-600"> Fair Prices</span>
          {" "}for every family in Bharat. Because your health deserves nothing less.
        </p>
        <h2 className="font-semibold  text-slate-900">
          <u>Dr. Ankit Rana</u>
        </h2>
      <h2 className="font-semibold text-slate-900">
          <u>Doctor of Pharmacy</u>
        </h2>
      </div>
    </div>
  </section>
);

/* ================= PARTNERS / TRUST ================= */

const Trust = () => (
  <section className="py-24 bg-white">
    <div className="max-w-7xl mx-auto px-6 text-center">
      <h2 className="text-5xl font-bold text-gray-900">
        Trusted by Leaders in Healthcare
      </h2>

      <p className="mt-4 text-gray-600 max-w-2xl mx-auto">
        Our commitment to patient safety and clinical excellence is recognized
        by premier institutions and regulatory bodies.
      </p>

      <div className="grid md:grid-cols-3 gap-8 mt-16">
        <div className="p-6 border rounded-2xl shadow hover:shadow-xl transition  bg-gradient-to-br from-indigo-50 to-blue-50">
          <h4 className="text-2xl font-semibold">NIMS University</h4>
          <p className="mt-2 text-gray-600">Clinical Research & Education</p>
        </div>

        <div className="p-6 border rounded-2xl shadow hover:shadow-xl transition bg-gradient-to-br from-indigo-50 to-blue-50">
          <h4 className="text-2xl font-semibold">Startup India</h4>
          <p className="mt-2 text-gray-600">Recognized Healthcare Innovation</p>
        </div>

        <div className="p-6 border rounded-2xl shadow hover:shadow-xl transition bg-gradient-to-br from-indigo-50 to-blue-50">
          <h4 className="text-2xl font-semibold">WHO-GMP Standard</h4>
          <p className="mt-2 text-gray-600">Ensuring Therapeutic Quality</p>
        </div>
      </div>

      {/* CTA BANNER */}
      <div className="mt-20 bg-gradient-to-r from-[#0369a1] to-indigo-600 rounded-2xl p-12 text-white">
        <h3 className="text-3xl font-bold">
          Join Our Patient-Centric Care Network
        </h3>
        <p className="mt-4 max-w-2xl mx-auto opacity-90">
          Whether you are a patient seeking better outcomes or a healthcare
          professional dedicated to clinical excellence, Svasthya hub is your
          partner in health.
        </p>

        <div className="mt-8 flex justify-center gap-4">
          <button className="bg-white text-[#0369a1] px-8 py-3 rounded-lg font-semibold">
            <a href="/login">Find a Specialist</a>
          </button>
          <button className="border border-white px-8 py-3 rounded-lg font-semibold">
            For Healthcare Providers
          </button>
        </div>
      </div>
    </div>
  </section>
);


/* ================= FOOTER (FIXED) ================= */

const Footer = () => (
  <footer className="bg-gray-900 text-white pt-16 pb-8">
    <div className="max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-12">
      {/* BRAND */}
      <div>
        <h3 className="text-xl font-bold">{content.footer.brandName}</h3>
        <p className="mt-4 text-gray-400">{content.footer.description}</p>
      </div>

      {/* QUICK LINKS */}
      <div>
        <h4 className="font-semibold mb-4">Quick Links</h4>
        <ul className="space-y-2 text-gray-400">
          {content.footer.quickLinks.map((link, i) => (
            <li key={i} className="hover:text-white cursor-pointer">
              {link}
            </li>
          ))}
        </ul>
      </div>

      {/* SERVICES */}
      <div>
        <h4 className="font-semibold mb-4">Services</h4>
        <ul className="space-y-2 text-gray-400">
          {content.footer.services.map((service, i) => (
            <li key={i} className="hover:text-white cursor-pointer">
              {service}
            </li>
          ))}
        </ul>
      </div>

      {/* CONTACT */}
      <div className="space-y-3 text-gray-400">
        <div className="flex gap-2">
          <Mail />{" "}
          <a href="mailto:hudsvasthya@gmail.com">hubsvasthya@gmail.com</a>
        </div>
        <div className="flex gap-2">
          <Phone /> <a href="tel:+91 9523443854">+91 9523443854</a>
        </div>
        <div className="flex gap-2">
          <MapPin />
          Jaipur, Rajasthan, India
        </div>
      </div>
    </div>

    <p className="mt-12 text-center text-gray-500">
      {content.footer.copyright}
    </p>
  </footer>
);
</file>

<file path="frontend/src/screens/PharmacyAdmin.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";

const PharmacyAdmin = () => {
  const [prescriptions, setPrescriptions] = useState([]);
  const [pharmacistName, setPharmacistName] = useState("");
  const [showConfirmModal, setShowConfirmModal] = useState(false);
  const [selectedPrescription, setSelectedPrescription] = useState(null);
  const [allPresent, setAllPresent] = useState(true);
  const [manualMedicines, setManualMedicines] = useState([""]);

  const navigate = useNavigate();

  /* ================= AUTH ================= */
  const getHeaders = () => {
    const token = localStorage.getItem("pharmacistToken");
    if (!token) {
      navigate("/pharmacist-login");
      return null;
    }
    return { Authorization: `Bearer ${token}` };
  };

  /* ================= FETCH ================= */
  useEffect(() => {
    fetchPharmacistInfo();
    fetchPrescriptions();
    // eslint-disable-next-line
  }, []);

  const fetchPharmacistInfo = async () => {
    const headers = getHeaders();
    if (!headers) return;

    try {
      const res = await axios.get(
        `${import.meta.env.VITE_BACKEND_URL}/api/pharmacist/me`,
        { headers }
      );
      setPharmacistName(res.data.name);
    } catch {
      navigate("/pharmacist-login");
    }
  };

  const fetchPrescriptions = async () => {
    const headers = getHeaders();
    if (!headers) return;

    try {
      const res = await axios.get(
        `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/all`,
        { headers }
      );
      setPrescriptions(res.data);
    } catch (err) {
      console.error(err);
    }
  };

  /* ================= MODAL ================= */
  const openConfirmModal = (p) => {
    setSelectedPrescription(p);
    setShowConfirmModal(true);
    setAllPresent(true);
    setManualMedicines([""]);
  };

  const closeConfirmModal = () => {
    setShowConfirmModal(false);
    setSelectedPrescription(null);
    setManualMedicines([""]);
  };

  const handleMedicineInputChange = (i, v) => {
    const updated = [...manualMedicines];
    updated[i] = v;
    setManualMedicines(updated);
  };

  const addMedicineField = () => {
    setManualMedicines([...manualMedicines, ""]);
  };

  /* ================= CONFIRM ================= */
  const handleConfirmMedicines = async () => {
    if (!selectedPrescription) return;
    const headers = getHeaders();
    if (!headers) return;

    await axios.put(
      `${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/${selectedPrescription._id}/confirm`,
      {
        allPresent,
        medicines: allPresent
          ? []
          : manualMedicines.filter((m) => m.trim()),
      },
      { headers }
    );

    setPrescriptions((prev) =>
      prev.map((p) =>
        p._id === selectedPrescription._id
          ? { ...p, status: "confirmed" }
          : p
      )
    );

    closeConfirmModal();
  };

  /* ================= REJECT ================= */
  const handleReject = async (id) => {
    const headers = getHeaders();
    if (!headers) return;

    await axios.put(
      `${import.meta.env.VITE_BACKEND_URL}/api/pharmacist/prescriptions/${id}/reject`,
      {},
      { headers }
    );

    setPrescriptions((prev) =>
      prev.map((p) =>
        p._id === id ? { ...p, status: "rejected" } : p
      )
    );
  };

  /* ================= UI ================= */
  return (
    <div className="min-h-screen p-4 bg-gray-50">
      <h1 className="text-3xl font-bold text-center mb-6">
        Welcome, {pharmacistName}
      </h1>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        {prescriptions.map((p) => (
          <div key={p._id} className="bg-white p-4 rounded shadow">
            <span className="text-xs text-gray-500">
              {p.type === "manual"
                ? "Manual Request"
                : "Uploaded Prescription"}
            </span>

            {/* 👁️ VIEW PRESCRIPTION (RESTORED) */}
            {p.type === "upload" && p.filename && (
              <p className="mt-2">
                <a
                  href={`${import.meta.env.VITE_BACKEND_URL}/api/prescriptions/image/${p.filename}`}
                  target="_blank"
                  rel="noreferrer"
                  className="text-blue-600 underline text-sm"
                >
                  View Prescription
                </a>
              </p>
            )}

            {/* 💊 MANUAL MEDICINES */}
            {p.type === "manual" && (
              <>
                <p className="font-semibold mt-2 text-sm">
                  Medicines:
                </p>
                <ul className="list-disc ml-4 text-sm">
                  {p.medicines?.map((m, i) => (
                    <li key={i}>{m}</li>
                  ))}
                </ul>
              </>
            )}

            <p className="text-sm mt-2">
              <b>User:</b> {p.userEmail}
            </p>

            <p className="text-sm">
              <b>Status:</b>{" "}
              <span
                className={
                  p.status === "confirmed"
                    ? "text-green-600"
                    : p.status === "rejected"
                    ? "text-red-600"
                    : "text-yellow-600"
                }
              >
                {p.status || "pending"}
              </span>
            </p>

            <div className="flex gap-2 mt-4">
              <button
                onClick={() => openConfirmModal(p)}
                disabled={p.status === "confirmed"}
                className="bg-green-600 text-white px-3 py-1 rounded disabled:opacity-50"
              >
                Accept
              </button>
              <button
                onClick={() => handleReject(p._id)}
                disabled={p.status === "rejected"}
                className="bg-red-600 text-white px-3 py-1 rounded disabled:opacity-50"
              >
                Reject
              </button>
            </div>
          </div>
        ))}
      </div>

      {/* ================= CONFIRM MODAL ================= */}
      {showConfirmModal && (
        <div className="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
          <div className="bg-white p-4 rounded w-80">
            <h2 className="font-bold mb-2">Confirm Medicines</h2>

            <label>
              <input
                type="radio"
                checked={allPresent}
                onChange={() => setAllPresent(true)}
              />{" "}
              All medicines present
            </label>

            <label className="block mt-2">
              <input
                type="radio"
                checked={!allPresent}
                onChange={() => setAllPresent(false)}
              />{" "}
              Not all present
            </label>

            {!allPresent && (
              <div className="mt-2">
                {manualMedicines.map((m, i) => (
                  <input
                    key={i}
                    value={m}
                    onChange={(e) =>
                      handleMedicineInputChange(i, e.target.value)
                    }
                    className="border w-full mb-1 px-2 py-1"
                    placeholder={`Medicine ${i + 1}`}
                  />
                ))}
                <button
                  onClick={addMedicineField}
                  className="text-blue-600 text-sm"
                >
                  + Add Medicine
                </button>
              </div>
            )}

            <div className="flex gap-2 mt-4">
              <button
                onClick={handleConfirmMedicines}
                className="bg-green-600 text-white px-3 py-1 rounded"
              >
                Confirm
              </button>
              <button
                onClick={closeConfirmModal}
                className="bg-gray-400 text-white px-3 py-1 rounded"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default PharmacyAdmin;
</file>

<file path="frontend/src/App.jsx">
import React from "react";
import {
  BrowserRouter as Router,
  Routes,
  Route,
  Navigate,
} from "react-router-dom";

import Navbar from "./components/Navbar";

import Dashboard from "./screens/Dashboard";
import UserDashboard from "./screens/UserDashboard";
import Suraksha from "./screens/Suraksha";
import Aushadhi from "./screens/Aushadhi";
import Raksha from "./screens/Raksha";
import Profile from "./screens/Profile";
import Doctor from "./screens/Doctor";
import Labtest from "./screens/Lab";
import Healthassist from "./screens/AI";
import Login from "./screens/Login";
import PharmacyAdmin from "./screens/PharmacyAdmin";
import PharmacistLogin from "./screens/PharmacistLogin";
import AdminLogin from "./screens/AdminLogin";
import AdminDashboard from "./screens/AdminDashboard";

import { useAuth } from "./context/AuthContext";

const App = () => {
  const { user, role } = useAuth(); // ✅ single source of truth

  return (
    <Router>
      <div className="min-h-screen bg-slate-50">
        {/* Navbar always visible */}
        <Navbar />

        <Routes>
          {/* ---------- HOME ---------- */}
          <Route
            path="/"
            element={
              role === "admin" ? (
                <Navigate to="/admin/dashboard" replace />
              ) : role === "pharmacist" ? (
                <Navigate to="/pharmacy-admin" replace />
              ) : role === "user" ? (
                <Navigate to="/userdashboard" replace />
              ) : (
                <Dashboard />
              )
            }
          />

          {/* ---------- PUBLIC ---------- */}
          <Route
            path="/login"
            element={role === "guest" ? <Login /> : <Navigate to="/" replace />}
          />

          {/* ---------- USER ---------- */}
          <Route
            path="/userdashboard"
            element={role === "user" ? <UserDashboard /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/profile"
            element={role === "user" ? <Profile /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/suraksha"
            element={role === "user" ? <Suraksha /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/raksha"
            element={role === "user" ? <Raksha /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/aushadhi"
            element={role === "user" ? <Aushadhi /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/doctor"
            element={role === "user" ? <Doctor /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/labtest"
            element={role === "user" ? <Labtest /> : <Navigate to="/login" replace />}
          />
          <Route
            path="/healthassist"
            element={role === "user" ? <Healthassist /> : <Navigate to="/login" replace />}
          />

          {/* ---------- PHARMACIST ---------- */}
          <Route
            path="/pharmacist-login"
            element={role === "guest" ? <PharmacistLogin /> : <Navigate to="/" replace />}
          />
          <Route
            path="/pharmacy-admin"
            element={role === "pharmacist" ? <PharmacyAdmin /> : <Navigate to="/pharmacist-login" replace />}
          />

          {/* ---------- ADMIN ---------- */}
          <Route
            path="/admin/login"
            element={role === "guest" ? <AdminLogin /> : <Navigate to="/" replace />}
          />
          <Route
            path="/admin/dashboard"
            element={role === "admin" ? <AdminDashboard /> : <Navigate to="/admin/login" replace />}
          />

          {/* ---------- FALLBACK ---------- */}
          <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>
      </div>
    </Router>
  );
};

export default App;
</file>

<file path="frontend/src/components/Navbar.jsx">
import React, { useState } from "react";
import { Link, useNavigate } from "react-router-dom";
import { Menu, X } from "lucide-react";
import { useAuth } from "../context/AuthContext";
import { useEffect, useRef } from "react";

const Navbar = () => {
  const [isOpen, setIsOpen] = useState(false);
  const navigate = useNavigate();
  const { user, pharmacist, admin, logout } = useAuth();
 const [isDesktop, setIsDesktop] = useState(false);
 const menuRef = useRef(null);


  const isAdmin = !!localStorage.getItem("adminToken");
  const isPharmacist = !!localStorage.getItem("pharmacistToken");

  const handleLogout = () => {
    logout?.();

    navigate("/", { replace: true }); // 🔥 IMPORTANT
  };

  // useEffect(() => {
  //   const checkScreen = () => {
  //     setIsDesktop(window.innerWidth >= 768); // md breakpoint
  //   };

  //   checkScreen();
  //   window.addEventListener("resize", checkScreen);
  //   return () => window.removeEventListener("resize", checkScreen);
  // }, []);

  useEffect(() => {
  const handleClickOutside = (event) => {
    if (menuRef.current && !menuRef.current.contains(event.target)) {
      setIsOpen(false);
    }
  };

  if (isOpen) {
    document.addEventListener("mousedown", handleClickOutside);
  }

  return () => {
    document.removeEventListener("mousedown", handleClickOutside);
  };
}, [isOpen]);


  // Common links based on role
const guestLinks = (
  <div className="flex flex-col gap-3">
    <Link to="/" className="hover:text-teal-700">
      Dashboard
    </Link>

    <div className="border-t pt-2">
      <p className="text-sm font-semibold text-gray-600 mb-1">
        Login as:
      </p>

      <div className="flex flex-col gap-1 pl-2">
        <Link
          to="/login"
          className="text-sm hover:text-teal-700"
        >
          User
        </Link>

        <Link
          to="/admin/login"
          className="text-sm hover:text-teal-700"
        >
          Admin
        </Link>

        <Link
          to="/pharmacist-login"
          className="text-sm hover:text-teal-700"
        >
          Pharmacist
        </Link>
      </div>
    </div>
  </div>
);


  const userLinks = (
    <>
      <Link to="/userdashboard" className="block py-2">
        Dashboard
      </Link>
      <Link to="/profile" className="block py-2">
        Profile
      </Link>
      <Link to="/aushadhi" className="block py-2">
        Aushadhi
      </Link>
      <Link to="/suraksha" className="block py-2">
        Suraksha
      </Link>
      <Link to="/raksha" className="block py-2">
        Raksha
      </Link>
      <button onClick={handleLogout} className="block py-2 text-left">
        Logout
      </button>
    </>
  );

  const pharmacistLinks = (
    <>
      {pharmacist && <Link to="/pharmacy-admin">Pharmacy Dashboard</Link>}

      <button onClick={handleLogout} className="block py-2 text-left">
        Logout
      </button>
    </>
  );

  const adminLinks = (
    <>
      {admin && <Link to="/admin/dashboard">Admin Dashboard</Link>}
      <button onClick={handleLogout} className="block py-2 text-left">
        Logout
      </button>
    </>
  );

  return (
    <nav className="bg-indigo-100 p-4 shadow-md">
      <div className="max-w-7xl mx-auto flex justify-between items-center">
        <Link to="/" className="text-xl font-bold">
          SvasthyaHub
        </Link>

        {/* Menu Icon */}
        <div
  ref={menuRef}
  className="relative"
  onMouseEnter={isDesktop ? () => setIsOpen(true) : undefined}
  onMouseLeave={isDesktop ? () => setIsOpen(false) : undefined}
>

          <button onClick={!isDesktop ? () => setIsOpen(!isOpen) : undefined}>
            {isOpen ? <X /> : <Menu />}
          </button>

          {/* Dropdown Menu */}
          {isOpen && (
            <div className="absolute right-0 mt-2 w-48 bg-teal-100 rounded shadow-lg p-4 z-50">
              {!user && !isAdmin && !isPharmacist && guestLinks}
              {user && userLinks}
              {isPharmacist && pharmacistLinks}
              {isAdmin && adminLinks}
            </div>
          )}
        </div>
      </div>
    </nav>
  );
};

export default Navbar;
</file>

<file path="frontend/src/screens/Login.jsx">
import React, { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import logo from "../assets/nlogo.jpg";
import { useAuth } from "../context/AuthContext";
import { Eye, EyeOff } from "lucide-react";

const Login = () => {
  const { loginUser } = useAuth(); // ✅ NEW CONTEXT METHOD
  const navigate = useNavigate();

  const [form, setForm] = useState({
    name: "",
    email: "",
    phone: "",
    password: "",
    bloodGroup: "",
    age: "",
  });

  const [isLogin, setIsLogin] = useState(true);
  const [selectedRole, setSelectedRole] = useState("user");
  const [showPassword, setShowPassword] = useState(true); // 👁️ FIXED
  const [loading, setLoading] = useState(false);

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);

    if (!form.password || (!form.email && !form.phone)) {
      alert("Please provide email/phone and password");
      return;
    }

    if (!isLogin && (!form.name || !form.bloodGroup || !form.age)) {
      alert("Please fill all required fields");
      return;
    }

    const payload = isLogin
      ? {
          email: form.email || null,
          phone: form.phone || null,
          password: form.password,
        }
      : {
          name: form.name,
          email: form.email || null,
          phone: form.phone || null,
          password: form.password,
          bloodGroup: form.bloodGroup,
          age: form.age,
        };

    const url = isLogin
      ? `${import.meta.env.VITE_BACKEND_URL}/api/auth/login`
      : `${import.meta.env.VITE_BACKEND_URL}/api/auth/register`;

    try {
      const res = await axios.post(url, payload);

      if (isLogin) {
        // ✅ CORRECT METHOD
        loginUser(res.data.user, res.data.token);

        // ✅ CORRECT REDIRECT
        navigate("/userdashboard", { replace: true });
      } else {
        alert("Registration successful! Please log in.");
        setIsLogin(true);
      }
    } catch (err) {
      console.error("Axios error:", err);
      alert(err.response?.data?.error || "Login/Register failed");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="bg-slate-50 text-slate-900 font-sans">

      {/* HERO */}
      <header
        className="text-white py-20 px-6"
        style={{
          background: "linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",
        }}
      >
        <div className="max-w-7xl mx-auto grid md:grid-cols-2 gap-12 items-center">
          <div>
            <span className="bg-sky-500/20 text-sky-300 px-4 py-1 rounded-full text-sm font-semibold border border-sky-500/30">
              India's First Pharm.D-Led Clinical Network
            </span>

            <h1 className="text-5xl md:text-6xl font-bold mt-6 leading-tight">
              Beyond Supply. <br />
              <span className="text-sky-400">Clinical Partnership.</span>
            </h1>

            <p className="text-slate-300 text-lg mt-6 max-w-lg">
              Stop just buying medicine. Start managing your health with expert
              oversight from Pharm.D professionals. We ensure every dose is
              safe, effective, and tailored to you.
            </p>

            <div className="flex gap-4 mt-10 flex-wrap">
              <button className="bg-sky-500 hover:bg-sky-400 px-8 py-4 rounded-xl font-bold text-lg transition">
                Get Your Safety Audit
              </button>
              <button className="border border-slate-500 hover:bg-white/10 px-8 py-4 rounded-xl font-bold text-lg transition">
                Meet the Doctor
              </button>
            </div>
          </div>

          {/* DOCTOR CARD */}
          <div className="relative">
            <div className="absolute -inset-4 bg-sky-500/20 blur-3xl rounded-full" />
            <div className="relative bg-slate-800 border border-slate-700 p-8 rounded-3xl shadow-[0_0_20px_rgba(14,165,233,0.2)]">
              <div className="flex items-center gap-4 mb-6">
                <div className="w-12 h-12 bg-sky-500 rounded-full flex items-center justify-center text-xl">
                  🩺
                </div>
                <div>
                  <p className="font-bold text-xl">Dr. Shivang Mishra</p>
                  <p className="text-sky-400 text-sm italic">
                    Doctor of Pharmacy (Pharm.D)
                  </p>
                  <p className="text-sky-400 text-sm italic">
                     HelathCare Consultant
                  </p>
                </div>
              </div>

              <div className="space-y-4">
                <div className="bg-slate-900/50 p-4 rounded-lg flex justify-between">
                  <span>Clinical Audits</span>
                  <span className="text-sky-400 font-bold">500+</span>
                </div>
                <div className="bg-slate-900/50 p-4 rounded-lg flex justify-between">
                  <span>Med-Safety Rating</span>
                  <span className="text-sky-400 font-bold">99.9%</span>
                </div>
              </div>
            </div>
          </div>
          <div className="relative">
            <div className="absolute -inset-4 bg-sky-500/20 blur-3xl rounded-full" />
            <div className="relative bg-slate-800 border border-slate-700 p-8 rounded-3xl shadow-[0_0_20px_rgba(14,165,233,0.2)]">
              <div className="flex items-center gap-4 mb-6">
                <div className="w-12 h-12 bg-sky-500 rounded-full flex items-center justify-center text-xl">
                  🩺
                </div>
                <div>
                  <p className="font-bold text-xl">Dr. Sachin Kumar</p>
                  <p className="text-sky-400 text-sm italic">
                    Doctor of Pharmacy (Pharm.D)
                  </p>
                  <p className="text-sky-400 text-sm italic">
                    HelathCare Consultant
                  </p>
                </div>
              </div>

              <div className="space-y-4">
                <div className="bg-slate-900/50 p-4 rounded-lg flex justify-between">
                  <span>Clinical Audits</span>
                  <span className="text-sky-400 font-bold">500+</span>
                </div>
                <div className="bg-slate-900/50 p-4 rounded-lg flex justify-between">
                  <span>Med-Safety Rating</span>
                  <span className="text-sky-400 font-bold">99.9%</span>
                </div>
              </div>
            </div>
          </div>
          <div className="relative">
            <div className="absolute -inset-4 bg-sky-500/20 blur-3xl rounded-full" />
            <div className="relative bg-slate-800 border border-slate-700 p-8 rounded-3xl shadow-[0_0_20px_rgba(14,165,233,0.2)]">
              <div className="flex items-center gap-4 mb-6">
                <div className="w-12 h-12 bg-sky-500 rounded-full flex items-center justify-center text-xl">
                  🩺
                </div>
                <div>
                  <p className="font-bold text-xl">Dr. Anurag Singh</p>
                  <p className="text-sky-400 text-sm italic">
                    Doctor of Pharmacy (Pharm.D)
                  </p>
                  <p className="text-sky-400 text-sm italic">
                    HelathCare Consultant
                  </p>
                </div>
              </div>

              <div className="space-y-4">
                <div className="bg-slate-900/50 p-4 rounded-lg flex justify-between">
                  <span>Clinical Audits</span>
                  <span className="text-sky-400 font-bold">500+</span>
                </div>
                <div className="bg-slate-900/50 p-4 rounded-lg flex justify-between">
                  <span>Med-Safety Rating</span>
                  <span className="text-sky-400 font-bold">99.9%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* FEATURES */}
      <section className="py-20 px-6 max-w-7xl mx-auto">
        <div className="text-center mb-16">
          <h2 className="text-3xl font-bold text-slate-800">
            Why SvasthyaHub is Different
          </h2>
          <p className="text-slate-500 mt-4">
            We solve the risks that standard pharmacies ignore.
          </p>
        </div>

        <div className="grid md:grid-cols-3 gap-8">
          {[
            {
              icon: "⚠️",
              color: "red",
              text: "Standard pharmacies just deliver a box. They don't check if your medications clash or if they are right for you.",
              solution: "Clinical Safety Audits",
            },
            {
              icon: "💊",
              color: "blue",
              text: "Patients often miss doses or take them incorrectly, leading to slow recovery or complications.",
              solution: "Adherence Coaching",
            },
            {
              icon: "🛡️",
              color: "green",
              text: "Side effects go unreported. Patients suffer in silence without knowing if it's the drug or the disease.",
              solution: "Pharmacovigilance",
            },
          ].map((item, i) => (
            <div
              key={i}
              className="bg-white p-8 rounded-2xl border border-slate-200 hover:shadow-xl transition group"
            >
              <div
                className={`w-14 h-14 bg-${item.color}-100 text-${item.color}-600 rounded-full flex items-center justify-center mb-6 text-2xl group-hover:scale-110 transition`}
              >
                {item.icon}
              </div>
              <h3 className="text-xl font-bold mb-3">The Problem</h3>
              <p className="text-slate-500 mb-6">{item.text}</p>
              <div className="pt-6 border-t border-slate-100 text-sky-600 font-semibold">
                Our Solution: {item.solution}
              </div>
            </div>
          ))}
        </div>
      </section>
      
      {/*User Form */}
      <div className="flex justify-center items-center p-4  bg-gradient-to-br from-blue-50 to-blue-100 mb-2">
      <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md">

        {/* USER FORM */}
        {selectedRole === "user" && (
          <>
            <h1 className="text-2xl font-bold mb-4 text-center">
              {isLogin ? "User Can Login Here 👇" : "User Can Register Here 👇"}
            </h1>

            <form onSubmit={handleSubmit} className="space-y-4">
              {!isLogin && (
                <>
                  <input
                    name="name"
                    placeholder="Full Name"
                    value={form.name}
                    onChange={handleChange}
                    className="w-full border p-2 rounded"
                    required
                  />
                  <input
                    name="bloodGroup"
                    placeholder="Blood Group"
                    value={form.bloodGroup}
                    onChange={handleChange}
                    className="w-full border p-2 rounded"
                    required
                  />
                  <input
                    name="age"
                    type="number"
                    placeholder="Age"
                    value={form.age}
                    onChange={handleChange}
                    className="w-full border p-2 rounded"
                    required
                  />
                </>
              )}

              <input
                name="email"
                placeholder="Email"
                value={form.email}
                onChange={handleChange}
                className="w-full border p-2 rounded"
              />

              <input
                name="phone"
                placeholder="Phone"
                value={form.phone}
                onChange={handleChange}
                className="w-full border p-2 rounded"
              />

              {/* PASSWORD WITH EYE */}
              <div className="relative">
                <input
                  type={showPassword ? "password" : "text"}
                  name="password"
                  placeholder="Password"
                  value={form.password}
                  onChange={handleChange}
                  className="w-full border p-2 rounded pr-10"
                  required
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-2.5 text-gray-500"
                >
                  {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
                </button>
              </div>

              <button
                disabled={loading}
                className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 disabled:opacity-50"
              >
                {loading ? "Logging in..." : isLogin ? "Login" : "Register"}
              </button>
            </form>

            <p
              className="text-sm text-center mt-4 text-blue-600 cursor-pointer"
              onClick={() => setIsLogin(!isLogin)}
            >
              {isLogin
                ? "Don't have an account? Register"
                : "Already have an account? Login"}
            </p>
          </>
        )}
      </div>
    </div>

      {/* CTA */}
      <section className="bg-sky-600 py-16 px-6 text-center text-white">
        <h2 className="text-4xl font-bold mb-6">
          Ready for a safer healthcare journey?
        </h2>
        <p className="text-sky-100 text-xl mb-10 max-w-2xl mx-auto">
          Upload your prescription for a complimentary Clinical Safety Audit by
          our Pharm.D team.
        </p>
        <button className="bg-white text-sky-600 px-10 py-4 rounded-full font-bold text-xl hover:bg-slate-100 transition shadow-lg">
          Upload Prescription
        </button>
      </section>

      {/* FOOTER */}
      <footer className="py-10 text-center text-slate-500 text-sm">
        © 2025 SvasthyaHub. Founded by Dr. Ankit Rana.
      </footer>
    </div>
  );
};

export default Login;
</file>

<file path="frontend/src/screens/PharmacistLogin.jsx">
import React, { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../context/AuthContext";
import { Eye, EyeOff } from "lucide-react";

const PharmacistLogin = () => {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);
  const [showPassword, setShowPassword] = useState(true);

  const [partnerOpen, setPartnerOpen] = useState(false);
  const [downloadOpen, setDownloadOpen] = useState(false);

  const navigate = useNavigate();
  const { loginPharmacist } = useAuth();

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const res = await axios.post(
        `${import.meta.env.VITE_BACKEND_URL}/api/pharmacist-auth/login`,
        { email, password }
      );

      loginPharmacist(res.data.token); // ✅ updates React state

      navigate("/pharmacy-admin", { replace: true });
    } catch {
      setError("Invalid credentials");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="text-slate-800 antialiased scroll-smooth">
      {/* HERO */}
      <header className="pt-32 pb-20 border-b border-blue-100 bg-[radial-gradient(#bae6fd_1px,transparent_1px)] bg-[size:32px_32px] bg-[#f0f9ff]">
        <div className="max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
          <div>
            <span className="inline-block bg-blue-100 text-blue-700 px-4 py-1.5 rounded-full text-sm font-bold mb-6">
              🚀 Incubated at NIMS University
            </span>

            <h1 className="text-4xl md:text-6xl font-extrabold text-slate-900 leading-tight mb-6">
              India’s First <span className="text-blue-600">PharmD-Led</span>
              <br />
              Clinical Pharmacy Network.
            </h1>

            <p className="text-lg text-slate-600 mb-8 leading-relaxed">
              Transforming local medical stores into trusted centers for
              <strong> Affordable Quality Medicines</strong> & expert guidance.
            </p>

            <div className="flex flex-col sm:flex-row gap-4">
              <button
                onClick={() => setPartnerOpen(true)}
                className="bg-blue-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-blue-700 shadow-lg shadow-blue-200 transition"
              >
                Become a Partner
              </button>
              <button
                onClick={() => setDownloadOpen(true)}
                className="bg-white border border-slate-300 px-8 py-4 rounded-xl font-bold text-lg hover:bg-slate-50 transition"
              >
                Download App
              </button>
            </div>
          </div>

          {/* MOCK CARD */}
          <div className="relative">
            <div className="absolute inset-0 bg-blue-600 rounded-3xl rotate-3 opacity-10" />
            <div className="relative bg-white p-8 rounded-3xl shadow-2xl border">
              <div className="flex items-center gap-4 mb-6 border-b pb-6">
                <div className="h-12 w-12 bg-green-100 rounded-full flex items-center justify-center">
                  ✅
                </div>
                <div>
                  <h3 className="font-bold text-lg">PharmD Verified Safe</h3>
                  <p className="text-sm text-slate-500">
                    Interaction Check Passed
                  </p>
                </div>
              </div>

              <Medicine
                name="SvasthyaHub Metformin 500"
                mrp="₹45"
                price="₹18.00"
              />
              <Medicine
                name="SvasthyaHub Telmisartan 40"
                mrp="₹55"
                price="₹22.00"
              />

              <div className="mt-6 text-center">
                <span className="bg-red-50 text-red-600 text-xs font-bold px-3 py-1 rounded-full">
                  ❤️ 500+ Hero Points Earned
                </span>
              </div>
            </div>
          </div>
        </div>
      </header>

      {/* FEATURES */}
      <section id="features" className="py-10 bg-slate-50">
        <div className="max-w-7xl mx-auto px-6 text-center">
          <h2 className="text-3xl font-bold mb-4">Why SvasthyaHub?</h2>
          <p className="text-slate-600 max-w-2xl mx-auto mb-16">
            Clinical expertise meets supply-chain efficiency.
          </p>

          <div className="grid md:grid-cols-3 gap-8">
            <Feature
              title="Clinical Safety First"
              desc="Every prescription is checked for interactions."
            />
            <Feature
              title="Affordable Quality"
              desc="WHO-GMP medicines at 60% lower cost."
            />
            <Feature
              title="Community Loyalty"
              desc="Blood donor network with real rewards."
            />
          </div>
        </div>
      </section>

      {/*Pharmacist Form*/}
      <div className="max-w-md mx-auto m-2  p-6 border rounded shadow ">
        <h2 className="flex justify-center text-xl mb-4 font-semibold">
          Pharmacist Can Login Here 👇
        </h2>

        <input
          type="email"
          className="w-full p-2 mb-3 border rounded"
          placeholder="Email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
        />

        {/* 🔐 Password Field */}
        <div className="relative mb-3">
          <input
            type={showPassword ? "password" : "text"}
            placeholder="Password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full p-2 pr-10 border rounded"
          />

          <button
            type="button"
            onClick={() => setShowPassword((p) => !p)}
            className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"
          >
            {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}
          </button>
        </div>

        <button
          onClick={handleLogin}
          disabled={loading}
          className="w-full bg-teal-600 text-white py-2 rounded disabled:opacity-50"
        >
          {loading ? "Logging in..." : "Login"}
        </button>

        {error && <p className="text-red-600 mt-2">{error}</p>}
      </div>

      {/* Pharmacist Vision */}
      <section className="w-full max-w-4xl mx-auto m-10">
    <div className="relative overflow-hidden rounded-3xl bg-white border border-slate-200 shadow-sm hover:shadow-lg transition">

      {/* Accent Line */}
      <div className="absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-purple-500 via-indigo-500 to-blue-500" />

      <div className="p-8 sm:p-10">

        {/* Heading */}
        <h2 className="text-xl  font-extrabold text-slate-900 mb-4">
          <u>Founder's Vision</u>
        </h2>
        <h2 className="text-2xl sm:text-3xl  text-slate-900 mb-4">
          Lead the Future of Pharmacy
        </h2>

        {/* Divider */}
        <div className="w-16 h-1 bg-indigo-600 rounded-full mb-6" />

        {/* Content */}
        <p className="text-slate-600 leading-relaxed text-base sm:text-lg">
          Don’t just survive the competition—<span className="font-semibold text-slate-800">lead it</span>.
          SvasthyaHub is empowering forward-thinking pharmacists to become the most trusted
          clinical authority in their communities.
        </p>

        <p className="text-slate-600 leading-relaxed text-base sm:text-lg mt-4">
          With our
          <span className="font-semibold text-indigo-600"> Pharm.D-led clinical technology</span> and
          <span className="font-semibold text-green-600"> high-margin supply chain</span>,
          we give you the power to protect patients, elevate your professional role,
          and grow your business with confidence.
        </p>

        <p className="text-slate-700 font-semibold text-lg mt-6 mb-4">
          Save lives. Build trust. Grow stronger.
          <span className="text-indigo-600"> Join the revolution.</span>
        </p>
      <h2 className="font-semibold  text-slate-900">
          <u>Dr. Ankit Rana</u>
        </h2>
      <h2 className="font-semibold text-slate-900">
          <u>Doctor of Pharmacy</u>
        </h2>
        
      </div>
    </div>
  </section>

      {/* FOOTER */}
      <footer className="bg-slate-900 text-slate-300 py-12">
        <div className="max-w-7xl mx-auto px-6 grid md:grid-cols-4 gap-8">
          <div className="md:col-span-2">
            <h3 className="text-2xl font-bold text-white">SvasthyaHub</h3>
            <p className="mt-4 text-sm max-w-xs">
              India’s safest and most affordable pharmacy network.
            </p>
          </div>
          <FooterCol
            title="Company"
            items={["About Us", "Careers", "Contact"]}
          />
          <FooterCol title="Legal" items={["Privacy Policy", "Terms of Use"]} />
        </div>

        <div className="text-center text-xs mt-12 border-t border-slate-800 pt-6">
          © 2025 SvasthyaHub. All rights reserved.
        </div>
      </footer>

      {/* {partnerOpen && (
        <Modal title="Partner Login" onClose={() => setPartnerOpen(false)}>
          <a
            href=""
            className="block w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-center"
          >
            Continue to Dashboard
          </a>
        </Modal>
      )}

      {downloadOpen && (
        <Modal title="Get the App" onClose={() => setDownloadOpen(false)}>
          <button className="w-full bg-slate-900 text-white py-3 rounded-xl font-bold">
            Download APK
          </button>
        </Modal>
      )} */}
    </div>
  );
};

/* ---------- COMPONENTS ---------- */

const Medicine = ({ name, mrp, price }) => (
  <div className="flex justify-between bg-slate-50 p-4 rounded-xl mb-3">
    <div>
      <p className="text-xs text-slate-500 uppercase font-bold">Medicine</p>
      <p className="font-bold">{name}</p>
    </div>
    <div className="text-right">
      <p className="text-xs line-through">{mrp}</p>
      <p className="font-bold text-green-600">{price}</p>
    </div>
  </div>
);

const Feature = ({ title, desc }) => (
  <div className="bg-white p-8 rounded-2xl border hover:shadow-xl transition">
    <h3 className="text-xl font-bold mb-3">{title}</h3>
    <p className="text-slate-600">{desc}</p>
  </div>
);

const FooterCol = ({ title, items }) => (
  <div>
    <h4 className="text-white font-bold mb-4">{title}</h4>
    <ul className="space-y-2 text-sm">
      {items.map((i) => (
        <li key={i} className="hover:text-white cursor-pointer">
          {i}
        </li>
      ))}
    </ul>
  </div>
);

// const Modal = ({ title, children, onClose }) => (
//   <div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm">
//     <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6">
//       <div className="flex justify-between items-center mb-4">
//         <h3 className="text-xl font-bold">{title}</h3>
//         <button onClick={onClose}>✕</button>
//       </div>
//       {children}
//     </div>
//   </div>
// );

export default PharmacistLogin;
</file>

</files>
